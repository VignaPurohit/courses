---
title: "Creating Publication Quality Charts with GEE (Full Workshop Material)"
subtitle: "A comprehesive guide on creating high-quality data visualizations with Google Earth Engine and Google Charts."
author: "Ujaval Gandhi"
fontsize: 12pt
output:
  # pdf_document:
  #   latex_engine: xelatex
  #   toc: yes
  #   toc_depth: 3
  #   fig_caption: false
  # word_document:
  #   toc: false
  #   fig_caption: false
  html_document:
    df_print: paged
    highlight: pygments
    toc: yes
    toc_depth: 3
header-includes:
- \usepackage{fancyhdr}
- \pagestyle{fancy}
- \renewcommand{\footrulewidth}{0.4pt}
- \fancyhead[LE,RO]{\thepage}
- \geometry{left=1in,top=0.75in,bottom=0.75in}
- \fancyfoot[CE,CO]{{\includegraphics[height=0.5cm]{images/cc-by-nc.png}} Ujaval Gandhi http://www.spatialthoughts.com}
---
\newpage

> **This workshop is under active development and is not complete.**

***

```{r echo=FALSE, fig.align='center', out.width='75%', out.width='250pt'}
knitr::include_graphics('images/spatial_thoughts_logo.png')
```

***

\newpage

# Introduction 

Google Earth Engine is a cloud-based platform that enables large-scale processing of satellite imagery to detect changes, map trends, and quantify differences on the Earthâ€™s surface. This course covers the full range of topics in Earth Engine to give the participants practical skills to master the platform and implement their remote sensing projects.

[![View Presentation](images/gee_charts/introduction.png){width="400px"}](https://docs.google.com/presentation/d/1q8HRDTqgQEp3Hmi8IG0T7djPLTC1wRig3jXrwFTmoVE/edit?usp=sharing){target="_blank"}

[View the Presentation &#8599;](https://docs.google.com/presentation/d/1q8HRDTqgQEp3Hmi8IG0T7djPLTC1wRig3jXrwFTmoVE/edit?usp=sharing){target="_blank"}


# Get the Workshop Materials

The course material and exercises are in the form of Earth Engine scripts shared via a code repository.

1. [Click this link](https://code.earthengine.google.co.in/?accept_repo=users/ujavalgandhi/GEE-Charts) to open Google Earth Engine code editor and add the repository to your account.
2. If successful, you will have a new repository named `users/ujavalgandhi/GEE-Charts` in the *Scripts* tab in the *Reader* section.
3. Verify that your code editor looks like below

<!-- TODO - Add image -->

If you do not see the repository in the *Reader* section, click *Refresh repository cache* button in your *Scripts* tab and it will show up.

```{r echo=FALSE, fig.align='center', out.width='50%', fig.cap='Refresh repository cache'}
knitr::include_graphics('images/common/repository_cache.png')
```


# 1. Time-Series Charts

In this section, we will explore various built-in functions to create time-series charts from ImageCollections. We will also explore the customization options provided by Google Charts to make high-quality functional graphics.

## 1.1 Simple Time-Series

We start by using the time-series charting function `ui.Chart.image.series()` that allows you to create a time-series plot from an ImageCollection at a single location. You get one time-series per band of the input dataset. We take the TerraClimate dataset and select the bands for monthly maximum and minimum temperatures. The resulting chart is a [Line Chart](https://developers.google.com/chart/interactive/docs/gallery/linechart) that can be further customized using the `.setOptions()` method.

Here are the customizations applied to the default time-series chart:

- `lineWidth`: Sets the thickness of the line
- `pointSize`: Sets the size of the data point
- `title`: Sets the chart title
- `vAxis`: Sets the options for Y-Axis. Axis label is specified using the `title` option.
- `hAxis`: Sets the options for X-Axis. Gridlines are specified using the `gridlines` option. Dateformat for tick labels is specified with `format` option.
- `series`: Sets the options for each individual time-series. Series count starts from 0.

```{r echo=FALSE, fig.align='center', out.width='75%', fig.cap='Time-Series Chart'}
knitr::include_graphics('images/gee_charts/time_series.png')
```

[Open in Code Editor &#8599;](https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FGEE-Charts%3A01-Time_Series_Charts%2F01b_Time_Series_(complete)){target="_blank"}

```{js eval=FALSE, code=readLines('code/gee_charts/01-Time_Series_Charts/01b_Time_Series_(complete)')}
```

## Exercise

[Open in Code Editor &#8599;](https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FGEE-Charts%3A01-Time_Series_Charts%2F01c_Time_Series_(exercise)){target="_blank"}

```
// Exercise

// a) Delete the 'geometry' and add a new point at your chosen location
// b) Modify the chart options display the series with dashed lines
// c) Print the chart.

// See reference:
// https://developers.google.com/chart/interactive/docs/lines#dashed 
```

## 1.2 Time-Series with Trendlines

Google Charts can dynamically compute and display [Trendlines](https://developers.google.com/chart/interactive/docs/gallery/trendlines) on the chart. You can choose from linear, polynomial or exponential trendlines. The linear trendline fit a least-square regression model on the dataset. Here we take a time-series of precipitation data, aggregate it to yearly precipitation and then display a linear trendline to indicate whether we see an increasing or decreasing rainfall in the region.

Here are the styling options applied to the time-series chart:

- `vAxis.ticks`: Sets the tick positions for Y-Axis. We manually specify the exact tick marks we want.
- `gridlines.color`: Sets the color of the gridlines.
- `legend`: Sets the position of the legend. The `in` options makes the legend appear inside the chart.
- `series.visibleInLegend`: Sets whether a particular series label is visible in the legend.
- `trendlines`: Sets the option for trendlines. We override the default label using `labelInLegend` option.


```{r echo=FALSE, fig.align='center', out.width='75%', fig.cap='Time-Series Chart with Trendline'}
knitr::include_graphics('images/gee_charts/time_series_trend.png')
```

[Open in Code Editor &#8599;](https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FGEE-Charts%3A01-Time_Series_Charts%2F02b_Time_Series_With_Trend_(complete)){target="_blank"}

```{js eval=FALSE, code=readLines('code/gee_charts/01-Time_Series_Charts/02b_Time_Series_With_Trend_(complete)')}
```
## Exercise

[Open in Code Editor &#8599;](https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FGEE-Charts%3A01-Time_Series_Charts%2F02c_Time_Series_With_Trend_(exercise)){target="_blank"}

```
// Exercise

// a) Delete the 'geometry' and add a new point at your chosen location
// b) Modify the chart options to remove the legend from the chart.
// c) Print the chart.

// Hint: Use legend 'position' option
// See reference:
// https://developers.google.com/chart/interactive/docs/gallery/linechart
```


## 1.3 Time-Series at Multiple Locations

So far, we have learnt how to display time-series of one or more variables at a single location using the `ui.Chart.image.series()` function. If you wanted to plot time-series of multiple locations in a single chart, you can use the `ui.Chart.image.series.byRegion()` function. This function takes a FeatureCollection with one or more locations and extract the time-series at each geometry.

Here we take the Global Forecast System (GFS) dataset and create a chart of 16-day temperature-forecasts at 2 cities.


```{r echo=FALSE, fig.align='center', out.width='75%', fig.cap='Time-Series Chart at Multiple Locations'}
knitr::include_graphics('images/gee_charts/time_series_by_region.png')
```

[Open in Code Editor &#8599;](https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FGEE-Charts%3A01-Time_Series_Charts%2F03b_Time_Series_By_Region_(complete)){target="_blank"}

```{js eval=FALSE, code=readLines('code/gee_charts/01-Time_Series_Charts/03b_Time_Series_By_Region_(complete)')}
```

## Exercise

[Open in Code Editor &#8599;](https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FGEE-Charts%3A01-Time_Series_Charts%2F03c_Time_Series_By_Region_(exercise)){target="_blank"}

```
// Exercise

// a) Replace the 'geometry1' and 'geometry2' points with your chosen locations.
// b) Modify the chart options to limit the Y-Axis range to the 
//    actual range of temperatures at your chosen locations (i.e. between 20-45 degrees)
// c) Print the chart.
```


## 1.4 Multi-Year Time-Series

Another useful function to plot time-series is ``ui.Chart.image.doySeriesByYear()` that extracts and plots values from an image band at different Day-Of-Year (DOY) over many years. This type of chart is helpful visualize both inter-annial and inter-annual variations in a single chart.

Here we take the MODIS 16-day Vegetation Indicies (VI) dataset and create a chart of NDVI Time-Series over 4 years.

Here are the styling options applied to the time-series chart:

- `interpolateNulls`: Sets whether to fill missing (i.e masked) time-series values
- `curveType`: Apply smoothing on the time-series by [fitting a function](https://developers.google.com/chart/interactive/docs/gallery/linechart#curving-the-lines).

```{r echo=FALSE, fig.align='center', out.width='75%', fig.cap='DOY Time-Series Chart'}
knitr::include_graphics('images/gee_charts/time_series_by_year.png')
```

[Open in Code Editor &#8599;](https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FGEE-Charts%3A01-Time_Series_Charts%2F04b_Time_Series_By_Year_(complete)){target="_blank"}

```{js eval=FALSE, code=readLines('code/gee_charts/01-Time_Series_Charts/04b_Time_Series_By_Year_(complete)')}
```

## Exercise

```{r echo=FALSE, fig.align='center', out.width='100%', fig.cap='Exercise 04c'}
knitr::include_graphics('images/gee_charts/time_series_by_year_exercise.png')
```

[Open in Code Editor &#8599;](https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FGEE-Charts%3A01-Time_Series_Charts%2F04c_Time_Series_By_Year_(exercise)){target="_blank"}

```
// Exercise

// a) Replace the 'geometry' with your chosen location.
// b) Modify the chart to specify custom colors for each year.
//    Use color codes from https://colorbrewer2.org/
// c) Modify the chart to plot only the time-series
//    with lines without any points.
// c) Print the chart.
```


# 2. Image Charts

This section covers charting functions and techniques to plot values from an image. We will also learn how to deal with limitations of the charting API and create plots by extracting data from large regions.

## 2.1 Image Histogram

A histogram plot is a bar chart showing count of pixel values. Typically the pixel values are grouped into range of values called *buckets* on the X-Axis and the total count of pixels is shown on the Y-Axis.

Here we take the Harmonized Night Time Lights dataset that contains images from both DMSP and VIIRS sensors. 

Below is the list of styling options applied to the histogram:

- `hAxis.ticks`: Sets the tick labels on the X-Axis.
- `bar.gap`: Sets the gap between each histogram bar


```{r echo=FALSE, fig.align='center', out.width='75%', fig.cap='Image Histogram'}
knitr::include_graphics('images/gee_charts/image_histogram.png')
```

[Open in Code Editor &#8599;](https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FGEE-Charts%3A02-Image_Charts%2F01b_Image_Histogram_(complete)){target="_blank"}

```{js eval=FALSE, code=readLines('code/gee_charts/02-Image_Charts/01b_Image_Histogram_(complete)')}
```

## Exercise

```{r echo=FALSE, fig.align='center', out.width='100%', fig.cap='Exercise 01c'}
knitr::include_graphics('images/gee_charts/image_histogram_exercise.png')
```

[Open in Code Editor &#8599;](https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FGEE-Charts%3A02-Image_Charts%2F01c_Image_Histogram_(exercise)){target="_blank"}

```
// Exercise

// The code now has a function createChart that creates a chart
// for the given year

// a) Change the name of the country to your chosen country
// b) Call the function to create histograms for the year 2010 and 2020
// c) Print the charts.
```

## 2.2 Image Scatter Chart

A scatter plot is useful to explore the relationship between 2 variables. In Earth Engine, you can extract the pixel values from an image using any of the sampling functions such as `sample()` or `stratifiedSample()` to get a FeatureCollection with pixel values for a random subset of the pixels. We can then plot the results using the built-in charting functions for FeatureCollections.

Here we use the Sentinel-2 Surface Reflectance dataset along with Global Surface Water Yearly Water History dataset to get reflectance values of water and non-water pixels within the chosen region. We then use the `ui.Chart.feature.groups()` function to plot the results. Note that you can explicitely set the desired chart type using the `setChartType()` function.

Below is the list of new styling options applied to the scatter plot:

- `titleTextStyle`: Sets the style of the title text.
- `dataOpacity`: Sets the transperancy for the data points. Useful when you have overlapping data points.
- `pointShape`: Sets the shape of the marker from the [available marker shapes](https://developers.google.com/chart/interactive/docs/points).

```{r echo=FALSE, fig.align='center', out.width='75%', fig.cap='Scatter Plot'}
knitr::include_graphics('images/gee_charts/image_scatterchart.png')
```

[Open in Code Editor &#8599;](https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FGEE-Charts%3A02-Image_Charts%2F02b_Image_Scatter_Chart_(complete)){target="_blank"}

```{js eval=FALSE, code=readLines('code/gee_charts/02-Image_Charts/02b_Image_Scatter_Chart_(complete)')}
```

## Exercise

[Open in Code Editor &#8599;](https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FGEE-Charts%3A02-Image_Charts%2F02c_Image_Scatter_Chart_(exercise)){target="_blank"}

```
// Exercise
// The code now contains a function createChart() that creates a scatter plot
// between the chosen bands

// a) Delete the 'geometry' and add a new polygon at your chosen location
// b) Create a chart for B3 and B11
// c) Print the chart.
```

# References

- Google Earth Engine Developer Guide: [Chart Documentation](https://developers.google.com/earth-engine/guides/charts_overview)

# License

The workshop material (text, images, presentation, videos) is licensed under a [Creative Commons Attribution 4.0 International License](https://creativecommons.org/licenses/by/4.0/).

The code (scripts, Jupyter notebooks) is licensed under the MIT License. For a copy, see https://opensource.org/licenses/MIT

You are free to re-use and adapt the material but are required to give appropriate credit to the original author as below:

Copyright &copy; 2023 Ujaval Gandhi [www.spatialthoughts.com](https://spatialthoughts.com)


# Citing and Referencing

You can cite the course materials as follows

* Gandhi, Ujaval, 2023. *Creating Publication Quality Charts with GEE* Workshop. Spatial Thoughts. https://courses.spatialthoughts.com/gee-charts.html

***
