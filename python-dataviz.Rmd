---
title: "Mapping and Data Visualization with Python (Full Course Material)"
author: "Ujaval Gandhi"
subtitle: A comprehensive guide for creating static and dynamic visualizations with spatial data.
output:
  # pdf_document:
  #   toc: yes
  #   toc_depth: '3'
  #   latex_engine: xelatex 
  html_document:
    df_print: paged
    highlight: pygments
    toc: yes
    toc_depth: 3
    includes:
      after_body: disqus.html
fontsize: 12pt
header-includes:
- \usepackage{fancyhdr}
- \pagestyle{fancy}
- \renewcommand{\footrulewidth}{0.4pt}
- \fancyhead[LE,RO]{\thepage}
- \geometry{left=1in,top=0.75in,bottom=0.75in}
- \fancyfoot[CE,CO]{{\includegraphics[height=0.5cm]{images/cc-by-nc.png}} Ujaval Gandhi
  http://www.spatialthoughts.com}
classoption: a4paper
---
\newpage

***

```{r echo=FALSE, fig.align='center', out.width='75%', out.width='250pt'}
knitr::include_graphics('images/spatial_thoughts_logo.png')
```

***

\newpage

# Introduction 

This is an intermediate-level course that teaches you how to use Python for creating charts, plots, animations, and maps.


[![View Presentation](images/python_dataviz/course_overview.png){width="400px"}](https://docs.google.com/presentation/d/1Mc8O7zXJt-0LwUocPjpfjvkqYj-0qRnUMUIFpftVZFw/edit?usp=sharing){target="_blank"}

[View the Presentation &#8599;](https://docs.google.com/presentation/d/1Mc8O7zXJt-0LwUocPjpfjvkqYj-0qRnUMUIFpftVZFw/edit?usp=sharing){target="_blank"}

# Notebooks and Datasets

This course uses Google Colab for all exercises. You do not need to install any packages or download any datasets. 

The notebooks can be accessed by clicking on the ![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg) buttons at the beginning of each section. Once you have opened the notebook in Colab, you can copy it to your own account by going to *File &rarr; Save a Copy in Drive*. 


```{r echo=FALSE, fig.align='center', out.width='75%'}
knitr::include_graphics('images/python_dataviz/colab1.png')
```

Once the notebooks are saved to your drive, you will be able to modify the code and save the updated copy. You can also click the *Share* button and share a link to the notebook with others.

```{r echo=FALSE, fig.align='center', out.width='75%'}
knitr::include_graphics('images/python_dataviz/colab2.png')
```


\newpage


# Hello Colab

[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/spatialthoughts/python-dataviz-web/blob/main/00_hello_colab.ipynb)


```{r child='python-dataviz-output/00_hello_colab.md'}
```

----

# Matplotlib Basics

[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/spatialthoughts/python-dataviz-web/blob/main/01_matplotlib_basics.ipynb)


```{r child='python-dataviz-output/01_matplotlib_basics.md'}
```

----

# Creating Charts

[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/spatialthoughts/python-dataviz-web/blob/main/02_creating_charts.ipynb)


```{r child='python-dataviz-output/02_creating_charts.md'}
```

----

# Creating Maps

[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/spatialthoughts/python-dataviz-web/blob/main/03_creating_maps.ipynb)

```{r child='python-dataviz-output/03_creating_maps.md'}
```

----

# Using Basemaps

[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/spatialthoughts/python-dataviz-web/blob/main/04_using_basemaps.ipynb)

```{r child='python-dataviz-output/04_using_basemaps.md'}
```

----

# XArray Basics

[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/spatialthoughts/python-dataviz-web/blob/main/05_xarray_basics.ipynb)

```{r child='python-dataviz-output/05_xarray_basics.md'}
```

----

# Mapping Gridded Datasets

[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/spatialthoughts/python-dataviz-web/blob/main/06_mapping_gridded_datasets.ipynb)

```{r child='python-dataviz-output/06_mapping_gridded_datasets.md'}
```

----

# Visualizing Rasters

[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/spatialthoughts/python-dataviz-web/blob/main/07_visualizing_rasters.ipynb)

```{r child='python-dataviz-output/07_visualizing_rasters.md'}
```

----

# Interactive Maps with Folium

[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/spatialthoughts/python-dataviz-web/blob/main/08_interactive_maps_folium.ipynb)


```{r child='python-dataviz-output/08_interactive_maps_folium.md'}
```

----

# Multi-layer Interactive Maps

[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/spatialthoughts/python-dataviz-web/blob/main/09_multilayer_maps.ipynb)

Open the notebook named ``09_multilayer_maps.ipynb``.

----

```{r child='python-dataviz-output/09_multilayer_maps.md'}
```

# Leafmap Basics

[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/spatialthoughts/python-dataviz-web/blob/main/10_leafmap_basics.ipynb)

----

```{r child='python-dataviz-output/10_leafmap_basics.md'}
```

\newpage

# Building Apps and Dashboards with Streamlit

Streamlit is a Python library that allows you to create web-apps and dashboard by just writing Python code. It provides you with a wide range of UI widgets and layouts that can be used to build user=interfaces. Your streamlit app is just a regular Python file with a `.py` extension. 

## Installation and Setting up the Environment 

You need to install the `streamlit` package to create the app. We will be using Anaconda to install ``streamlit`` and related packages on your machine. Please review the [Anaconda Installation Guide](https://courses.spatialthoughts.com/python-foundation.html#installation-and-setting-up-the-environment) for step-by-step instructions.

Once you have installed Anaconda, open *Anaconda Prompt* or a *Terminal* and run the following commands.

```
conda create --name streamlit -y
conda activate streamlit
conda install -c conda-forge streamlit leafmap geopandas streamlit-folium -y
```

After the installation is done, run the following command.

```
streamlit hello
```

```{r echo=FALSE, fig.align='center', out.width='75%'}
knitr::include_graphics('images/python_dataviz/streamlit1.png')
```

A new browser tab will open and display the streamlit Hello app.

```{r echo=FALSE, fig.align='center', out.width='75%'}
knitr::include_graphics('images/python_dataviz/streamlit2.png')
```

Your installation is now complete. You can close the terminal window to stop the streamlit server.

## Streamlit Basics 


## Create a Mapping Dashboard

The code below creates an interactive mapping dashboard that displays the statistics of the selected region.


```{python eval=FALSE, code=readLines('code/python_dataviz/streamlit/dashboard/app.py')}
```

## Publishing Apps with Streamlit Cloud

Streamlit provides free hosting for your streamlit apps. In this section, we will now learn how to deploy an app to Streamlit cloud and configure it correctly.

### Upload the app to Github

To run your app on Streamlit Cloud, you need to upload your app to GitHub. Streamlit supports both private and public repositories. In this example, we will be deploying a *Route Finder* app which has been uploaded to GitHub at `https://github.com/spatialthoughts/python-dataviz-web/blob/main/streamlit/route_finder/app.py`

### Add App dependencies

If your app needs a third-party Python package, you need to add it in a separate file called `requirements.txt`. The packages listed in the file will be installed on Streamlit Cloud before running the app.

For our app, we have created the `requirements.txt` file with the following content and uploaded it to GitHub in the same directory as the `app.py`

```
streamlit
folium
streamlit-folium
```

You may also specify other dependencies for your app. Learn more at [App dependencies](https://docs.streamlit.io/streamlit-cloud/get-started/deploy-an-app/app-dependencies) documentation.

### Deploy your App

Now you are ready to deploy your app to Streamlit Cloud.

1. Visit [Streamlit Cloud](https://streamlit.io/cloud) and sign-in. If you do not have an account, you can click *Sign-up* and create a new account. Once logged-in, click the *New app* button.

```{r echo=FALSE, fig.align='center', out.width='75%'}
knitr::include_graphics('images/python_dataviz/cloud1.png')
```

2. Click *Paste GitHub URL* and paste the URL to your streamlit `app.py` file. For this example, you may use  for the Route Finder app. Next, click *Advanced settings...*


```{r echo=FALSE, fig.align='center', out.width='75%'}
knitr::include_graphics('images/python_dataviz/cloud2.png')
```

3. This dialog allows you to store your private information required by your apps, such as API keys, username/password for your database, etc. For the **Route Finder** app, you need to enter the API Key for OpenRouteService. Visit [OpenRouteService Dashboard](https://openrouteservice.org/dev/#/signup) and copy your API Key. Enter your API key in the following format and replace <your key> with your  actual API key. Click *Save*.

```
'ORS_API_KEY' = '<your key>'
```

```{r echo=FALSE, fig.align='center', out.width='50%'}
knitr::include_graphics('images/python_dataviz/cloud3.png')
```

4. You are now ready to deploy the app. Click *Deploy!*.

```{r echo=FALSE, fig.align='center', out.width='75%'}
knitr::include_graphics('images/python_dataviz/cloud4.png')
```

5. Your app will now be deployed and will be accessible via the provided URL. You can visit your Dashboard to manage the app once it is deployed.


```{r echo=FALSE, fig.align='center', out.width='75%'}
knitr::include_graphics('images/python_dataviz/cloud5.png')
```

The app is now live! Visit the [Route Finder](https://spatialthoughts-python-dataviz--streamlitroute-finderapp-gqzg4q.streamlitapp.com/) app to see it in action.


# Supplement

## Contextily


[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/spatialthoughts/python-dataviz-web/blob/main/supplement_contextily.ipynb)

```{r child='python-dataviz-output/supplement_contextily.md'}
```

## Advanced Plotting


[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/spatialthoughts/python-dataviz-web/blob/main/supplement_elevation_profile_plot.ipynb)

```{r child='python-dataviz-output/supplement_elevation_profile_plot.md'}
```


[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/spatialthoughts/python-dataviz-web/blob/main/supplement_stacked_barcharts.ipynb)

```{r child='python-dataviz-output/supplement_stacked_barcharts.md'}
```

## Animation

[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/spatialthoughts/python-dataviz-web/blob/main/supplement_animating_maps.ipynb)

```{r child='python-dataviz-output/supplement_animating_maps.md'}
```

## Leafmap

[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/spatialthoughts/python-dataviz-web/blob/main/supplement_leafmap_osm.ipynb)

```{r child='python-dataviz-output/supplement_leafmap_osm.md'}
```


# Resources

- [Visualization with Matplotlib](https://jakevdp.github.io/PythonDataScienceHandbook/04.00-introduction-to-matplotlib.html). Python Data Science Handbook by Jake VanderPlas
- [Awesome Streamlit](https://github.com/MarcSkovMadsen/awesome-streamlit)

# Data Credits

- London Crime Statistics: ASB Incidents, Crime and Outcome - UK Home Office. Retrieved 2022-01-20. https://data.police.uk/about/
- California Census Data: U.S. Census Bureau, 2019 American Community Survey 5-Year Estimates and Cartographic Boundary Files - Shapefile: 2019
- Eclipse Shapefiles: NASA's Scientific Visualization Studio Downloaded from https://svs.gsfc.nasa.gov/4518
- NASA Shuttle Radar Topography Mission (SRTM) Elevation Dataset. Downloaded from [30m SRTM Tile Downloader](https://dwtkns.com/srtm30m/%5D).
- Temperature Anomalies: GISTEMP Team, 2022: GISS Surface Temperature Analysis (GISTEMP), version 4. NASA Goddard Institute for Space Studies. Dataset accessed 2022-01-26 at https://data.giss.nasa.gov/gistemp/.

# License


This course material is licensed under a [Creative Commons Attribution-NonCommercial 4.0 International License](https://creativecommons.org/licenses/by-nc/4.0/). You are free to use the material for any non-commercial purpose. Kindly give appropriate credit to the original author.

If you would like to utilize these materials as part of a commercial offering, you can purchase a *Trainer License* for a small fee. 

Please [contact us](https://spatialthoughts.com/contact/) for pricing and terms.
<!--
This material is part of the *Trainer's Package* and the buyer gets a non-exclusive, non-transferable, perpetual license to the material. You can fully customise and brand the materials to your requirements.
-->

&copy; 2022 Ujaval Gandhi [www.spatialthoughts.com](https://spatialthoughts.com)

***

**This course is offered as an instructor-led online class. Visit [Spatial Thoughts](https://spatialthoughts.com/events/) to know details of upcoming sessions.**
