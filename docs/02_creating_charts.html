<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>02_creating_charts</title>

<script src="site_libs/header-attrs-2.10/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-172372432-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-172372432-3');
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Courses</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="http://spatialthoughts.com">Back to Main Site</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="#">Back to Top</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">




</div>


<div id="creating-charts" class="section level1">
<h1>Creating Charts</h1>
<p>Pandas allows you to read structured datasets and visualize them using the <code>plot()</code> method. By default, Pandas uses <code>matplotlib</code> to create the plots.</p>
<p>In this notebook, we will take work with open dataset of crime in London.</p>
<pre class="python"><code>import pandas as pd
import os
import glob

%matplotlib inline
import matplotlib.pyplot as plt</code></pre>
<p>We have 12 different CSV files containing crime data for each month of 2020. We can use the <code>glob</code> module to find all files matching a pattern.</p>
<pre class="python"><code>data_pkg_path = &#39;data&#39;
folder = &#39;crime&#39;
file_pattern = &#39;2020-*.csv&#39;
file_path_pattern = os.path.join(data_pkg_path, folder, file_pattern)

file_list = []
for file in glob.glob(file_path_pattern):
    file_list.append(file)
file_list</code></pre>
<pre><code>[&#39;data/crime/2020-05-metropolitan-street.csv&#39;,
 &#39;data/crime/2020-12-metropolitan-street.csv&#39;,
 &#39;data/crime/2020-01-metropolitan-street.csv&#39;,
 &#39;data/crime/2020-02-metropolitan-street.csv&#39;,
 &#39;data/crime/2020-11-metropolitan-street.csv&#39;,
 &#39;data/crime/2020-06-metropolitan-street.csv&#39;,
 &#39;data/crime/2020-09-metropolitan-street.csv&#39;,
 &#39;data/crime/2020-04-metropolitan-street.csv&#39;,
 &#39;data/crime/2020-08-metropolitan-street.csv&#39;,
 &#39;data/crime/2020-07-metropolitan-street.csv&#39;,
 &#39;data/crime/2020-10-metropolitan-street.csv&#39;,
 &#39;data/crime/2020-03-metropolitan-street.csv&#39;]</code></pre>
<p>It will be helpful to merge all these files into a single dataframe. We can use <code>pd.concat()</code> to merge a list of dataframes.</p>
<pre class="python"><code>dataframe_list = []

for file in file_list:
    df = pd.read_csv(file)
    dataframe_list.append(df)

merged_df = pd.concat(dataframe_list)</code></pre>
<p>Let’s create a pie-chart showing the distribution of different types of crime. Pandas <code>groupby()</code> function allows us to calculate group statistics.</p>
<pre class="python"><code>type_counts = merged_df.groupby(&#39;Crime type&#39;).size()
type_counts</code></pre>
<pre><code>Crime type
Anti-social behaviour           415105
Bicycle theft                    23517
Burglary                         61044
Criminal damage and arson        50923
Drugs                            51629
Other crime                      10066
Other theft                      81924
Possession of weapons             5763
Public order                     53458
Robbery                          27269
Shoplifting                      34588
Theft from the person            31084
Vehicle crime                   108344
Violence and sexual offences    227208
dtype: int64</code></pre>
<p>We now uses the <code>plot()</code> method to create the chart. This method is a wrapper around <code>matplotlib</code> and can accept supported arguments from it.</p>
<p>Reference: <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.plot.html">pandas.DataFrame.plot</a></p>
<pre class="python"><code>fig, ax = plt.subplots(1, 1)
fig.set_size_inches(15,7)
type_counts.plot(kind=&#39;pie&#39;, ax=ax, wedgeprops={&#39;linewidth&#39;: 1.0, &#39;edgecolor&#39;: &#39;white&#39;}, label=&#39;&#39;)
plt.tight_layout()
plt.title(&#39;Crime Types&#39;, fontsize = 18)

plt.show()</code></pre>
<p><img src="02_creating_charts_files/02_creating_charts_9_0.png" /></p>
<p>We can also chart the trend of crime over the year. For this, let’s group the data by month.</p>
<pre class="python"><code>monthly_counts = merged_df.groupby(&#39;Month&#39;).size()
monthly_counts</code></pre>
<pre><code>Month
2020-01     90979
2020-02     86984
2020-03     87409
2020-04    109951
2020-05    114008
2020-06    100198
2020-07    103657
2020-08    104782
2020-09     99633
2020-10     99471
2020-11     96914
2020-12     87936
dtype: int64</code></pre>
<pre class="python"><code>fig, ax = plt.subplots(1, 1)
fig.set_size_inches(15,7)
monthly_counts.plot(kind=&#39;bar&#39;, ax=ax)
plt.show()</code></pre>
<p><img src="02_creating_charts_files/02_creating_charts_12_0.png" /></p>
<p>We can make the chart more informating by stacking the chart with information about crime type.</p>
<pre class="python"><code>counts_by_type = merged_df.groupby([&#39;Month&#39;, &#39;Crime type&#39;]).size()
counts_by_type</code></pre>
<pre><code>Month    Crime type                  
2020-01  Anti-social behaviour           17548
         Bicycle theft                    1172
         Burglary                         6889
         Criminal damage and arson        4374
         Drugs                            4282
                                         ...  
2020-12  Robbery                          2021
         Shoplifting                      2690
         Theft from the person            3075
         Vehicle crime                    7758
         Violence and sexual offences    17836
Length: 168, dtype: int64</code></pre>
<p>The result is not in a suitable format for plotting. We call <code>unstack()</code> to create a dataframe.</p>
<pre class="python"><code>counts_df = counts_by_type.unstack()
counts_df</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
Crime type
</th>
<th>
Anti-social behaviour
</th>
<th>
Bicycle theft
</th>
<th>
Burglary
</th>
<th>
Criminal damage and arson
</th>
<th>
Drugs
</th>
<th>
Other crime
</th>
<th>
Other theft
</th>
<th>
Possession of weapons
</th>
<th>
Public order
</th>
<th>
Robbery
</th>
<th>
Shoplifting
</th>
<th>
Theft from the person
</th>
<th>
Vehicle crime
</th>
<th>
Violence and sexual offences
</th>
</tr>
<tr>
<th>
Month
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
2020-01
</th>
<td>
17548
</td>
<td>
1172
</td>
<td>
6889
</td>
<td>
4374
</td>
<td>
4282
</td>
<td>
832
</td>
<td>
9497
</td>
<td>
562
</td>
<td>
4025
</td>
<td>
3263
</td>
<td>
3853
</td>
<td>
4256
</td>
<td>
11975
</td>
<td>
18451
</td>
</tr>
<tr>
<th>
2020-02
</th>
<td>
16975
</td>
<td>
1044
</td>
<td>
6216
</td>
<td>
4220
</td>
<td>
3818
</td>
<td>
757
</td>
<td>
9729
</td>
<td>
452
</td>
<td>
3842
</td>
<td>
3152
</td>
<td>
3845
</td>
<td>
4570
</td>
<td>
10405
</td>
<td>
17959
</td>
</tr>
<tr>
<th>
2020-03
</th>
<td>
23014
</td>
<td>
1078
</td>
<td>
5362
</td>
<td>
4392
</td>
<td>
3657
</td>
<td>
813
</td>
<td>
7531
</td>
<td>
483
</td>
<td>
3966
</td>
<td>
2711
</td>
<td>
2996
</td>
<td>
3414
</td>
<td>
9621
</td>
<td>
18371
</td>
</tr>
<tr>
<th>
2020-04
</th>
<td>
62763
</td>
<td>
1060
</td>
<td>
3661
</td>
<td>
3496
</td>
<td>
4978
</td>
<td>
751
</td>
<td>
3884
</td>
<td>
460
</td>
<td>
3464
</td>
<td>
1101
</td>
<td>
1691
</td>
<td>
677
</td>
<td>
6327
</td>
<td>
15638
</td>
</tr>
<tr>
<th>
2020-05
</th>
<td>
58502
</td>
<td>
1768
</td>
<td>
3886
</td>
<td>
3906
</td>
<td>
6427
</td>
<td>
823
</td>
<td>
4443
</td>
<td>
533
</td>
<td>
4250
</td>
<td>
1293
</td>
<td>
1956
</td>
<td>
795
</td>
<td>
7277
</td>
<td>
18149
</td>
</tr>
<tr>
<th>
2020-06
</th>
<td>
39584
</td>
<td>
2548
</td>
<td>
4320
</td>
<td>
4353
</td>
<td>
4665
</td>
<td>
882
</td>
<td>
5387
</td>
<td>
463
</td>
<td>
4966
</td>
<td>
1705
</td>
<td>
2400
</td>
<td>
1194
</td>
<td>
8102
</td>
<td>
19629
</td>
</tr>
<tr>
<th>
2020-07
</th>
<td>
35588
</td>
<td>
2833
</td>
<td>
4928
</td>
<td>
4692
</td>
<td>
4569
</td>
<td>
892
</td>
<td>
6977
</td>
<td>
453
</td>
<td>
5584
</td>
<td>
2168
</td>
<td>
3099
</td>
<td>
2072
</td>
<td>
8811
</td>
<td>
20991
</td>
</tr>
<tr>
<th>
2020-08
</th>
<td>
35842
</td>
<td>
3019
</td>
<td>
4995
</td>
<td>
4710
</td>
<td>
3534
</td>
<td>
780
</td>
<td>
7647
</td>
<td>
451
</td>
<td>
5490
</td>
<td>
2530
</td>
<td>
3006
</td>
<td>
2542
</td>
<td>
8919
</td>
<td>
21317
</td>
</tr>
<tr>
<th>
2020-09
</th>
<td>
30863
</td>
<td>
3078
</td>
<td>
5195
</td>
<td>
4274
</td>
<td>
3541
</td>
<td>
964
</td>
<td>
7516
</td>
<td>
503
</td>
<td>
5167
</td>
<td>
2599
</td>
<td>
3060
</td>
<td>
2696
</td>
<td>
9829
</td>
<td>
20348
</td>
</tr>
<tr>
<th>
2020-10
</th>
<td>
31186
</td>
<td>
2619
</td>
<td>
5618
</td>
<td>
4214
</td>
<td>
4124
</td>
<td>
812
</td>
<td>
7248
</td>
<td>
500
</td>
<td>
4577
</td>
<td>
2440
</td>
<td>
3222
</td>
<td>
3225
</td>
<td>
10148
</td>
<td>
19538
</td>
</tr>
<tr>
<th>
2020-11
</th>
<td>
33863
</td>
<td>
1985
</td>
<td>
5209
</td>
<td>
4205
</td>
<td>
4410
</td>
<td>
981
</td>
<td>
5734
</td>
<td>
511
</td>
<td>
4239
</td>
<td>
2286
</td>
<td>
2770
</td>
<td>
2568
</td>
<td>
9172
</td>
<td>
18981
</td>
</tr>
<tr>
<th>
2020-12
</th>
<td>
29377
</td>
<td>
1313
</td>
<td>
4765
</td>
<td>
4087
</td>
<td>
3624
</td>
<td>
779
</td>
<td>
6331
</td>
<td>
392
</td>
<td>
3888
</td>
<td>
2021
</td>
<td>
2690
</td>
<td>
3075
</td>
<td>
7758
</td>
<td>
17836
</td>
</tr>
</tbody>
</table>
</div>
<p>Now we can create the stacked bar chart. Instead of the default legend, we create a horizontal legend with a frame using the <code>legend()</code> function.</p>
<pre class="python"><code>fig, ax = plt.subplots(1, 1)
fig.set_size_inches(20,10)
counts_df.plot(kind=&#39;bar&#39;, stacked=True, ax=ax, colormap=&#39;tab20&#39;)
plt.legend(loc=&#39;upper center&#39;, ncol=5, frameon=True, bbox_to_anchor=(0.5, 1.1), fancybox=True, shadow=True)
ax.spines[&#39;right&#39;].set_visible(False)
ax.spines[&#39;top&#39;].set_visible(False)
plt.xlabel(&#39;Year&#39;, size = 15)
plt.ylabel(&#39;Number of Incidents&#39;, size = 15)
plt.title(&#39;Crime in London (2020)&#39;, size = 18, y=1.1)
output_folder = &#39;output&#39;
output_path = os.path.join(output_folder, &#39;stacked_chart.jpg&#39;)
plt.savefig(output_path)
plt.show()</code></pre>
<p><img src="02_creating_charts_files/02_creating_charts_18_0.png" /></p>
<div id="exercise" class="section level2">
<h2>Exercise</h2>
<p>Plot the trend of Bicycle thefts as a line chart.</p>
<p>Hint: Select the column ‘Bicycle theft’ from the <code>counts_df</code> dataframe and use the <code>plot()</code> function on the result.</p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
