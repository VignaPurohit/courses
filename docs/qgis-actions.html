<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Ujaval Gandhi" />


<title>QGIS Automation using Actions (Workshop Material)</title>

<script src="site_libs/header-attrs-2.10/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-172372432-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-172372432-3');
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Courses</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="http://spatialthoughts.com">Back to Main Site</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="#">Back to Top</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">QGIS Automation using Actions (Workshop Material)</h1>
<h3 class="subtitle">Learn how to build and apply PyQGIS Actions to automate tasks in QGIS.</h3>
<h4 class="author">Ujaval Gandhi</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#software">Software</a></li>
<li><a href="#get-the-data-package">Get the Data Package</a></li>
<li><a href="#hello-world">1. Hello World</a>
<ul>
<li><a href="#extract-a-feature-from-a-layer">1.1 Extract a Feature from a Layer</a></li>
<li><a href="#exercise">1.1 Exercise</a></li>
</ul></li>
<li><a href="#data-credits">Data Credits</a></li>
<li><a href="#license">License</a></li>
</ul>
</div>

<div style="page-break-after: always;"></div>
<hr />
<p><img src="images/spatial_thoughts_logo.png" width="250pt" style="display: block; margin: auto;" /></p>
<hr />
<div style="page-break-after: always;"></div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>QGIS allows you to define custom Actions on map layers. This action can run commands or python code when the user clicks on a feature. This workshop will cover QGIS Actions in detail along with demos on how you can harness its power to automate GIS workflows. We will focus on Python Actions and go through various examples of implementing new functionality and automating tasks with just a few lines of PyQGIS code.</p>
<p>This workshop requires prior knowledge of Python and familiarity with PyQGIS API.</p>
<p><a href="https://docs.google.com/presentation/d/16CiiFs3mLyQIrDXf4Uc50DFwRHsmCeMRpo1i25JNk-s/edit?usp=sharing" target="_blank"><img src="images/qgis_actions/introduction.png" width="400" alt="View Presentation" /></a></p>
<p><a href="https://docs.google.com/presentation/d/16CiiFs3mLyQIrDXf4Uc50DFwRHsmCeMRpo1i25JNk-s/edit?usp=sharing" target="_blank">View the Presentation ↗</a></p>
</div>
<div id="software" class="section level1">
<h1>Software</h1>
<p>This course requires QGIS LTR version 3.28.</p>
<p>Please review <a href="install-qgis-ltr.html">QGIS-LTR Installation Guide</a> for step-by-step instructions.</p>
</div>
<div id="get-the-data-package" class="section level1">
<h1>Get the Data Package</h1>
<p>The code examples in this workshop use a variety of datasets. All the required layers, project files etc. are supplied to you in the zip file <code>qgis-actions.zip</code>. Unzip this file to the <code>Downloads</code> directory.</p>
<p>Download <a href="">qgis-actions.zip</a></p>
</div>
<div id="hello-world" class="section level1">
<h1>1. Hello World</h1>
<p>Let’s get started by learning the basics of QGIS Actions.</p>
<div id="extract-a-feature-from-a-layer" class="section level2">
<h2>1.1 Extract a Feature from a Layer</h2>
<p>We will create an action that takes a layer of all countries in the world and allows you to extract any country polygon by clicking on it.</p>
<ol style="list-style-type: decimal">
<li>Open QGIS. QGIS comes with a bunch of built-in ‘Easter Egg’ features that can be triggered by typing a keyword in the <em>Coordinate</em> box at the bottom of the main window. While many of these are for fun, some provide useful functionality. Enter the keyword <strong>world</strong> into the coordinate box and click <em>Enter</em>.</li>
</ol>
<p><img src="images/qgis_actions/helloworld1.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>A new layer named <code>World Map</code> will be added to the <em>Layers</em> panel. This layer is the <a href="https://www.naturalearthdata.com/downloads/10m-cultural-vectors/">Admin0 - Countries</a> boundaries dataset from Natural Earth. Let’s define an action on this layer. Right-click the layer and select <em>Properties</em>.</li>
</ol>
<p><img src="images/qgis_actions/helloworld2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Switch to the <em>Actions</em> tab and click the <em>Add a new action</em> (<em>+</em>) button.</li>
</ol>
<p><img src="images/qgis_actions/helloworld3.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Select <strong>Python</strong> as the <em>Type</em>. Enter <strong>Hello World</strong> as the <em>Description</em>. This will be the name of the action as it appears in various menu items. Leave the <em>Action Scopes</em> to the default selected values of <strong>Feature</strong> and <strong>Canvas</strong>. Under the <em>Action Text</em> enter the following Python code and click <em>OK</em>.</li>
</ol>
<pre><code>print(&#39;Hello World&#39;)</code></pre>
<p><img src="images/qgis_actions/helloworld4.png" width="60%" style="display: block; margin: auto;" /></p>
<ol start="5" style="list-style-type: decimal">
<li>Click <em>OK</em> again to get back to the main QGIS Canvas. We now have an action that will print <code>Hello World</code> when we click on a feature. To see the output, open the <em>Python Console</em> from <strong>Plugins → Python Console</strong>. Locate the <em>Actions</em> button on the <em>Attributes Toolbar</em>. Click the dropdown menu next to it and select <em>Hello World</em>.</li>
</ol>
<p><img src="images/qgis_actions/helloworld5.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="6" style="list-style-type: decimal">
<li>Once the action is selected, click on any feature from the layer. You will see <em>Hello World</em> printed in the console.</li>
</ol>
<p><img src="images/qgis_actions/helloworld6.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="7" style="list-style-type: decimal">
<li>You now know how to define and trigger a Python action. Let’s make the action more useful. Instead of printing a static text, let’s modify the action to print the name of the country where we clicked. Open the <em>Attribute Table</em> of the <code>World Map</code> layer. You will notice that the <strong>NAME</strong> attribute contains the country names.</li>
</ol>
<p><img src="images/qgis_actions/helloworld7.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="8" style="list-style-type: decimal">
<li>Right click the <code>World Map</code> layer and select <em>Properties</em>. From the <em>Actions</em> tab, double click the already defined <em>Hello World</em> action.</li>
</ol>
<p><img src="images/qgis_actions/helloworld8.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="9" style="list-style-type: decimal">
<li>Our action is triggered by clicking on a feature and we can access the attributes of that feature. Select the <strong>NAME</strong> attribute and click <em>Insert</em>.</li>
</ol>
<p><img src="images/qgis_actions/helloworld9.png" width="60%" style="display: block; margin: auto;" /></p>
<ol start="10" style="list-style-type: decimal">
<li>You will see the value <code>[%NAME%]</code> entered in the <em>Action Text</em> text box. This is a special expression syntax which indicates that the value surrounded by <code>[%</code> and <code>%]</code> will be replaced with the value of the attribute from the feature when the action is triggered.</li>
</ol>
<p><img src="images/qgis_actions/helloworld10.png" width="60%" style="display: block; margin: auto;" /></p>
<ol start="11" style="list-style-type: decimal">
<li>Update the code to print the attribute value as below.</li>
</ol>
<pre><code>print(&#39;[%NAME%]&#39;)</code></pre>
<p><img src="images/qgis_actions/helloworld11.png" width="60%" style="display: block; margin: auto;" /></p>
<ol start="12" style="list-style-type: decimal">
<li>Click <em>OK</em> and get back to the main window. Select the action and click on any feature. You will now see the name of the country printed in the console.</li>
</ol>
<p><img src="images/qgis_actions/helloworld12.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="13" style="list-style-type: decimal">
<li>Along with all the attributes of the clicked feature, we also have access to other project and layer variables. Update the code as below to print the values of the feature id and layer id along with the value of the <code>NAME</code> attribute. Note that we are using the Python <a href="https://realpython.com/python-string-formatting/#3-string-interpolation-f-strings-python-36">f-strings</a> for formatting the output.</li>
</ol>
<pre><code>feature_name = &#39;[%NAME%]&#39;
feature_id = [%$id%]
layer_id = &#39;[%@layer_id%]&#39;
print(f&#39;feature name: {feature_name}&#39;)
print(f&#39;feature id: {feature_id}&#39;)
print(f&#39;layer id: {layer_id}&#39;)</code></pre>
<p><img src="images/qgis_actions/helloworld13.png" width="60%" style="display: block; margin: auto;" /></p>
<ol start="14" style="list-style-type: decimal">
<li>Click <em>OK</em> and try the action again. This time you will see the feature id and layer id printed along with the feature name.</li>
</ol>
<p><img src="images/qgis_actions/helloworld14.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="15" style="list-style-type: decimal">
<li>Now you know how to access the <code>@layer_id</code> and <code>$id</code> values of the current feature. We can now use it to extract the current feature and create a new layer from it. Replace the <em>Action Text</em> with the following code which uses <a href="https://qgis.org/pyqgis/3.0/core/Feature/QgsFeatureSource.html#qgis.core.QgsFeatureSource.materialize"><code>QgsFeatureSource.materialize()</code></a> method to create a new memory based vector layer with the query containing the feature id.</li>
</ol>
<pre><code>feature_name = &#39;[%NAME%]&#39;
feature_id = [%$id%]
layer_id = &#39;[%@layer_id%]&#39;

layer = QgsProject.instance().mapLayer(layer_id)
new_layer = layer.materialize(
    QgsFeatureRequest().setFilterFids([feature_id]))
new_layer.setName(feature_name)
QgsProject.instance().addMapLayer(new_layer)</code></pre>
<p><img src="images/qgis_actions/helloworld15.png" width="60%" style="display: block; margin: auto;" /></p>
<ol start="16" style="list-style-type: decimal">
<li>Go back to the main Canvas and close the <em>Python Console</em>. Select the <em>Hello World</em> action and click on any feature. You will see a new layer added to the <em>Layers</em> panel that contains the feature. Really useful!</li>
</ol>
<p><img src="images/qgis_actions/helloworld16.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="17" style="list-style-type: decimal">
<li>We have a small problem. As the new layer is created and added to the <em>Layers</em> panel, it becomes the active layer. To trigger the action again, we have to select the <code>World Map</code> layer again. To prevent this, we can use <a href="https://qgis.org/pyqgis/master/gui/QgisInterface.html#qgis.gui.QgisInterface.setActiveLayer"><code>QgisInterface.setActiveLayer()</code></a> method to set the current layer as the active layer. We import <code>iface</code> in the code to access the current instance of the <code>QgisInterface</code> class.</li>
</ol>
<pre><code>from qgis.utils import iface

feature_name = &#39;[%NAME%]&#39;
feature_id = [%$id%]
layer_id = &#39;[%@layer_id%]&#39;

layer = QgsProject.instance().mapLayer(layer_id)
new_layer = layer.materialize(
    QgsFeatureRequest().setFilterFids([feature_id]))
new_layer.setName(feature_name)
QgsProject.instance().addMapLayer(new_layer)
iface.setActiveLayer(layer)</code></pre>
<p><img src="images/qgis_actions/helloworld17.png" width="60%" style="display: block; margin: auto;" /></p>
<ol start="18" style="list-style-type: decimal">
<li>Now you are able to click around and extract multiple countries without having to manually switch layers.</li>
</ol>
<p><img src="images/qgis_actions/helloworld18.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
<div id="exercise" class="section level2">
<h2>1.1 Exercise</h2>
<p>Update the action to display an <em>Info</em> message on the QGIS message bar as shown below.</p>
<p>Hint: You can use <a href="https://qgis.org/pyqgis/3.0/gui/Message/QgsMessageBar.html#qgis.gui.QgsMessageBar.pushInfo">iface.messageBar().pushInfo()</a> method to display a message.</p>
<p><img src="images/qgis_actions/helloworld_exercise.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="data-credits" class="section level1">
<h1>Data Credits</h1>
</div>
<div id="license" class="section level1">
<h1>License</h1>
<p>This workshop material is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International (CC BY 4.0)</a>. You are free to re-use and adapt the material but are required to give appropriate credit to the original author as below:</p>
<p><em>QGIS Automation using Actions</em> by Ujaval Gandhi <a href="https://spatialthoughts.com">www.spatialthoughts.com</a></p>
<hr />
</div>

<div id="disqus_thread" class="standardPadding"></div>

<!-- disqus -->
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = 'https://courses.spatialthoughts.com' + location.pathname;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://spatialthoughts.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
