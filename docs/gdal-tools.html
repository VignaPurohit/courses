<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Ujaval Gandhi" />


<title>Mastering GDAL Tools (Full Course Material)</title>

<script src="site_libs/header-attrs-2.6/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-172372432-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-172372432-3');
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Courses</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="http://spatialthoughts.com">Back to Main Site</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Mastering GDAL Tools (Full Course Material)</h1>
<h3 class="subtitle">Satellite and aerial image processing using GDAL tools</h3>
<h4 class="author">Ujaval Gandhi</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#get-the-data-package">Get the Data Package</a></li>
<li><a href="#installation">Installation</a>
<ul>
<li><a href="#windows">Windows</a></li>
<li><a href="#maclinux">Mac/Linux</a></li>
</ul></li>
<li><a href="#running-the-commands">Running the Commands</a></li>
<li><a href="#gdal-tools">GDAL Tools</a>
<ul>
<li><a href="#working-with-elevation-data">Working with Elevation Data</a>
<ul>
<li><a href="#merging-tiles">Merging Tiles</a></li>
<li><a href="#converting-formats">Converting Formats</a></li>
<li><a href="#compressing-output">Compressing Output</a></li>
<li><a href="#setting-nodata-values">Setting NoData Values</a></li>
<li><a href="#wrting-cloud-optimized-geotiff">Wrting Cloud-Optimized GeoTiff</a></li>
<li><a href="#exercise-1">Exercise 1</a></li>
</ul></li>
<li><a href="#analyzing-and-visualizing-dems">Analyzing and Visualizing DEMs</a>
<ul>
<li><a href="#creating-hillshade">Creating Hillshade</a></li>
<li><a href="#exercise-2">Exercise 2</a></li>
<li><a href="#creating-contours">Creating Contours</a></li>
<li><a href="#exercise-3">Exercise 3</a></li>
</ul></li>
<li><a href="#processing-of-aerial-imagery">Processing of Aerial Imagery</a>
<ul>
<li><a href="#create-a-preview-image-from-source-tiles">Create a preview image from source tiles</a></li>
<li><a href="#mosaic-and-clip-to-aoi">Mosaic and clip to AOI</a></li>
</ul></li>
<li><a href="#processing-satellite-data">Processing Satellite Data</a>
<ul>
<li><a href="#merging-individual-bands-into-rgb-composite">Merging individual bands into RGB composite</a></li>
<li><a href="#apply-histogram-stretch-and-color-correction">Apply Histogram Stretch and Color Correction</a></li>
<li><a href="#pan-sharpening">Pan Sharpening</a></li>
<li><a href="#computing-ndvi">Computing NDVI</a></li>
</ul></li>
<li><a href="#georeferencing">Georeferencing</a>
<ul>
<li><a href="#georeferencing-images-with-corner-coordinates">Georeferencing images with corner coordinates</a></li>
<li><a href="#georeferencing-with-gcps">Georeferencing with GCPs</a></li>
</ul></li>
<li><a href="#downloading-wms-layers">Downloading WMS Layers</a></li>
</ul></li>
<li><a href="#ogr-tools">OGR Tools</a>
<ul>
<li><a href="#working-with-csv-files">Working with CSV files</a></li>
<li><a href="#working-with-virtual-files">Working with Virtual Files</a>
<ul>
<li><a href="#read-geonames-files">Read Geonames Files</a></li>
<li><a href="#applying-filters">Applying Filters</a></li>
<li><a href="#merging-files">Merging Files</a></li>
</ul></li>
<li><a href="#geoprocessing-spatial-queries">Geoprocessing Spatial Queries</a></li>
</ul></li>
<li><a href="#multi-criteria-weighted-overlay-analysis">Multi Criteria Weighted Overlay Analysis</a>
<ul>
<li><a href="#rasterize-vector-layers">Rasterize vector layers</a></li>
<li><a href="#generate-proximity-euclidean-distance-rasters">Generate proximity (Euclidean distance) rasters</a></li>
<li><a href="#re-classify-raster-values">Re-classify raster values</a></li>
<li><a href="#overlay-analysis">Overlay analysis</a></li>
</ul></li>
<li><a href="#running-commands-in-batch">Running commands in batch</a></li>
<li><a href="#resources">Resources</a></li>
<li><a href="#data-credits">Data Credits</a></li>
<li><a href="#license">License</a></li>
</ul>
</div>

<div style="page-break-after: always;"></div>
<hr />
<p><img src="images/spatial_thoughts_logo.png" width="250pt" style="display: block; margin: auto;" /></p>
<hr />
<div style="page-break-after: always;"></div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p><a href="https://gdal.org/">GDAL</a> is an open-source library for raster and vector geospatial data formats. The library comes with a vast collection of utility programs that can perform many geoprocessing tasks. This class introduces GDAL utilities with example workflows for processing satellite and aerial imagery.</p>
</div>
<div id="get-the-data-package" class="section level1">
<h1>Get the Data Package</h1>
<p>The code examples in this class use a variety of datasets. All the required datasets are supplied to you in the <code>gdal_tools.zip</code> file. Unzip this file to the <code>Downloads</code> directory. All commands below assume the data is available in the <code>&lt;home folder&gt;/Downloads/gdal_tools/</code> directory.</p>
<p><em>Not enrolled in our instructor-led class but want to work through the material on your own?</em> <a href="https://docs.google.com/forms/d/e/1FAIpQLScfS6sICXfbAfPr2MOAkfAIbpj8G6v3FR_YtMRGOoKrDnDBtw/viewform" target="_blank">Get free access to the data package</a></p>
</div>
<div id="installation" class="section level1">
<h1>Installation</h1>
<p>The preferred method for installing the GDAL Tools is via Anaconda. Follow these steps to install Anaconda and the GDAL library.</p>
<p><a href="https://www.anaconda.com/products/individual">Download the Anaconda Installer</a> for Python 3.7 (or a higher version) for your operating system. Once downloaded, double click the installer and install it into the default suggested directory.</p>
<p><em>Note: If your username has spaces, or non-English characters, it causes problems. In that case, you can install it to a path such as <code>C:\anaconda</code>.</em></p>
<p><img src="images/gdal/conda.png" width="75%" style="display: block; margin: auto;" /></p>
<div id="windows" class="section level2">
<h2>Windows</h2>
<p>Once Anaconda installed, search for <em>Anaconda Prompt</em> in the Start Menu and launch a new window.</p>
<ol style="list-style-type: decimal">
<li>Create a new environment named <code>gdal</code>. When prompted to confirm, type <code>y</code> and press <em>Enter</em>.</li>
</ol>
<pre><code>conda create --name gdal</code></pre>
<blockquote>
<p>Note: You can use the shortcut <em>Shift + Insert</em> to paste commands in Anaconda Prompt.</p>
</blockquote>
<ol start="2" style="list-style-type: decimal">
<li>Activate the environment and install the <code>gdal</code> package. When prompted to confirm, type <code>y</code> and press <em>Enter</em>.</li>
</ol>
<pre><code>conda activate gdal
conda install -c conda-forge gdal</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Once the installation finishes, check if the GDAL tools are available. Type <code>gdalinfo</code> and press <em>Enter</em>. If you an output showing usage help, the installation is successful.</li>
</ol>
</div>
<div id="maclinux" class="section level2">
<h2>Mac/Linux</h2>
<p>Once Anaconda is installed, launch a <em>Terminal</em> window.</p>
<ol style="list-style-type: decimal">
<li>Create a new environment named <code>gdal</code>. When prompted to confirm, type <code>y</code> and press <em>Enter</em>.</li>
</ol>
<pre><code>conda create --name gdal</code></pre>
<p><img src="images/gdal/condamac1.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Activate the environment and install the <code>gdal</code> package. When prompted to confirm, type <code>y</code> and press <em>Enter</em>.</li>
</ol>
<pre><code>conda activate gdal
conda install -c conda-forge gdal</code></pre>
<p><img src="images/gdal/condamac2.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Once the installation finishes, check if the GDAL tools are available. Type <code>gdalinfo</code> and press <em>Enter</em>. If you an output showing usage help, the installation is successful.</li>
</ol>
<p><img src="images/gdal/condamac3.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="running-the-commands" class="section level1">
<h1>Running the Commands</h1>
<p>All the commands in the exercises below are expected to be run from the <em>Anaconda Shell</em> on Windows or a <em>Terminal</em> on Mac/Linux. Before running the commands, you must activate the environment where you have installed the gdal library.</p>
<ol style="list-style-type: decimal">
<li><p>Launch a new window and activate the <code>gdal</code> environment.</p></li>
<li><p>Change the current directory to the data package directory.</p></li>
</ol>
<pre><code>cd Downloads\gdal-tools</code></pre>
<blockquote>
<blockquote>
<p><strong>Note:</strong> Many commandline examples are long and span multiple lines. To improve readability, they are separated by <strong>^</strong> character at the end if each line. This is a line continuation character that enables the shell to interpret it as a single command. If you are running these on Mac or Linux, replace the <strong>^</strong> character with <strong>\</strong></p>
</blockquote>
</blockquote>
</div>
<div id="gdal-tools" class="section level1">
<h1>GDAL Tools</h1>
<div id="working-with-elevation-data" class="section level2">
<h2>Working with Elevation Data</h2>
<pre><code>gdalinfo N27E086.hgt</code></pre>
<pre><code>gdalinfo -stats N27E086.hgt</code></pre>
<div id="merging-tiles" class="section level3">
<h3>Merging Tiles</h3>
<pre><code>gdalbuildvrt merged.vrt *.hgt</code></pre>
</div>
<div id="converting-formats" class="section level3">
<h3>Converting Formats</h3>
<pre><code>gdal_translate merged.vrt merged.tif</code></pre>
</div>
<div id="compressing-output" class="section level3">
<h3>Compressing Output</h3>
<pre><code>gdal_translate merged.vrt merged.tif -co COMPRESS=DEFLATE</code></pre>
<pre><code>gdal_translate merged.vrt merged.tif -co COMPRESS=DEFLATE -co TILED=YES</code></pre>
</div>
<div id="setting-nodata-values" class="section level3">
<h3>Setting NoData Values</h3>
<pre><code>gdal_translate merged.vrt merged.tif -co COMPRESS=DEFLATE -co TILED=YES -a_nodata -9999</code></pre>
</div>
<div id="wrting-cloud-optimized-geotiff" class="section level3">
<h3>Wrting Cloud-Optimized GeoTiff</h3>
<pre><code>gdal_translate -of COG merged.vrt merged.tif -co COMPRESS=DEFLATE</code></pre>
</div>
<div id="exercise-1" class="section level3">
<h3>Exercise 1</h3>
<p>What is the highest elevation value in the merged raster?</p>
</div>
</div>
<div id="analyzing-and-visualizing-dems" class="section level2">
<h2>Analyzing and Visualizing DEMs</h2>
<div id="creating-hillshade" class="section level3">
<h3>Creating Hillshade</h3>
<pre><code>gdaldem hillshade merged.tif hillshade.tif -s 111120</code></pre>
<pre><code>gdaldem hillshade merged.tif hillshade_combined.tif -s 111120 -combined</code></pre>
<pre><code>gdaldem color-relief merged.tif colormap.txt colorized.tif</code></pre>
</div>
<div id="exercise-2" class="section level3">
<h3>Exercise 2</h3>
<p>Save the color relief in the PNG format.</p>
</div>
<div id="creating-contours" class="section level3">
<h3>Creating Contours</h3>
<pre><code>gdal_contour merged.tif contours.gpkg -i 500</code></pre>
<pre><code>gdal_contour merged.tif contours.gpkg -i 500 -a elev</code></pre>
</div>
<div id="exercise-3" class="section level3">
<h3>Exercise 3</h3>
<p>Create polygon contours shapefile from <code>merged.tif</code> and name the attributes <code>MINELEV</code> and <code>MAXELEV</code> represented by each polygon.</p>
</div>
</div>
<div id="processing-of-aerial-imagery" class="section level2">
<h2>Processing of Aerial Imagery</h2>
<div id="create-a-preview-image-from-source-tiles" class="section level3">
<h3>Create a preview image from source tiles</h3>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gdalbuildvrt</span> naip.vrt naip/*.jp2</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="ex">gdal_translate</span> -of JPEG -outsize 2% 2% naip.vrt naip_preview.jpg </span></code></pre></div>
<p><img src="images/gdal/naip_preview.jpg" style="display: block; margin: auto;" /></p>
</div>
<div id="mosaic-and-clip-to-aoi" class="section level3">
<h3>Mosaic and clip to AOI</h3>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gdalwarp</span> -cutline naip/aoi.shp  -crop_to_cutline naip.vrt aoi.tif ^</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-co</span> PHOTOMETRIC=RGB -co COMPRESS=DEFLATE -dstnodata 0</span></code></pre></div>
<p><img src="images/gdal/mosaic.png" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="processing-satellite-data" class="section level2">
<h2>Processing Satellite Data</h2>
<p>This section shows how to take satellite data from Landsat-8 and create various derived products.</p>
<div id="merging-individual-bands-into-rgb-composite" class="section level3">
<h3>Merging individual bands into RGB composite</h3>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gdal_merge</span> -o rgb.tif -separate ^</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-co</span> PHOTOMETRIC=RGB -co COMPRESS=DEFLATE ^</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="ex">landsat8/RT_LC08_L1TP_137042_20190920_20190926_01_T1_2019-09-20_B4.TIF</span> ^</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="ex">landsat8/RT_LC08_L1TP_137042_20190920_20190926_01_T1_2019-09-20_B3.TIF</span> ^</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="ex">landsat8/RT_LC08_L1TP_137042_20190920_20190926_01_T1_2019-09-20_B2.TIF</span></span></code></pre></div>
<p><img src="images/gdal/rgb.png" style="display: block; margin: auto;" /></p>
</div>
<div id="apply-histogram-stretch-and-color-correction" class="section level3">
<h3>Apply Histogram Stretch and Color Correction</h3>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gdal_translate</span> -scale 0 0.3 0 255 -exponent 0.5 -ot Byte ^</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">rgb.tif</span> rgb_stretch.tif</span></code></pre></div>
<p><img src="images/gdal/rgb_stretch.png" style="display: block; margin: auto;" /></p>
</div>
<div id="pan-sharpening" class="section level3">
<h3>Pan Sharpening</h3>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gdal_pansharpen</span> ^</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">landsat8/RT_LC08_L1TP_137042_20190920_20190926_01_T1_2019-09-20_B8.TIF</span> ^</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="ex">rgb.tif</span> pansharpened.tif -r bilinear -co COMPRESS=DEFLATE -co PHOTOMETRIC=RGB</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="ex">gdal_translate</span> -scale 0 0.3 0 255 -exponent 0.5 -ot Byte -a_nodata 0 ^</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="ex">pansharpened.tif</span> pansharpened_stretch.tif</span></code></pre></div>
<p><img src="images/gdal/pansharpen_before.png" style="display: block; margin: auto;" /></p>
<p><img src="images/gdal/pansharpen_after.png" style="display: block; margin: auto;" /></p>
</div>
<div id="computing-ndvi" class="section level3">
<h3>Computing NDVI</h3>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gdalinfo</span> -stats ^</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">landsat8/RT_LC08_L1TP_137042_20190920_20190926_01_T1_2019-09-20_B4.TIF</span></span></code></pre></div>
<p>It is important to set nodata value. As seen from the output above, nodata is set to -9999.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gdal_calc</span> ^</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-A</span> landsat8/RT_LC08_L1TP_137042_20190920_20190926_01_T1_2019-09-20_B5.TIF ^</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-B</span> landsat8/RT_LC08_L1TP_137042_20190920_20190926_01_T1_2019-09-20_B4.TIF ^</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--outfile</span> ndvi.tif --calc=<span class="st">&quot;(A-B)/(A+B)&quot;</span> --NoDataValue=-9999</span></code></pre></div>
<p><img src="images/gdal/ndvi.png" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="georeferencing" class="section level2">
<h2>Georeferencing</h2>
<div id="georeferencing-images-with-corner-coordinates" class="section level3">
<h3>Georeferencing images with corner coordinates</h3>
<p>You can easily assign bounding box coordinates to any image using the <code>a_ullr</code> option.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gdalinfo</span> earth_at_night.jpg</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="ex">gdal_translate</span> -a_ullr -180 90 180 -90 -a_srs EPSG:4326 ^</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="ex">earth_at_night.jpg</span> earth_at_night.tif ^</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-co</span> PHOTOMETRIC=RGB -co COMPRESS=DEFLATE</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="ex">gdalinfo</span> earth_at_night.tif</span></code></pre></div>
<p><img src="images/gdal/earth_at_night.png" style="display: block; margin: auto;" /></p>
</div>
<div id="georeferencing-with-gcps" class="section level3">
<h3>Georeferencing with GCPs</h3>
<p>GCP format is [pixel line X Y]. You can use QGIS Georeferencer to obtain the GCPs. Ideally, this process is used with images that have known corner coordinates. In that case, if you know the image dimensions, pixel and line values can be obtained easily.</p>
<p>Let’s georeference this old scanned map.</p>
<p><img src="images/gdal/scanned_map.png" style="display: block; margin: auto;" /></p>
<p>First store the GCPs in the file</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gdal_translate</span> ^</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-gcp</span> 418 893 70 15 ^</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-gcp</span> 380 2432 70 5 ^</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-gcp</span> 3453 2434  90 5 ^</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-gcp</span> 3407 895 90 15 ^</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-gcp</span> 2662 911 85 15 ^</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="ex">1870_southern-india.jpg</span> india-with-gcp.tif</span></code></pre></div>
<p>Next, reproject the image using the GCPs</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gdalwarp</span> -t_srs EPSG:4042 -r bilinear -tr 0.005 0.005 -overwrite ^</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">india-with-gcp.tif</span> india-reprojected.tif</span></code></pre></div>
<p>Try a Thin-plate-spline transformation with some compression options.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gdalwarp</span> -t_srs EPSG:4042 -tps -r bilinear -tr 0.005 0.005 -overwrite ^</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">india-with-gcp.tif</span> india-reprojected.tif ^</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-co</span> COMPRESS=JPEG -co JPEG_QUALITY=50 -co PHOTOMETRIC=YCBCR</span></code></pre></div>
<p><img src="images/gdal/georeference_gcp.png" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="downloading-wms-layers" class="section level2">
<h2>Downloading WMS Layers</h2>
<pre><code>gdalinfo WMS:http://sedac.ciesin.columbia.edu/geoserver/wms</code></pre>
<p><a href="https://sedac.ciesin.columbia.edu/data/set/grand-v1-reservoirs-rev01">Global Reservoir and Dam (GRanD), v1</a></p>
<pre><code>gdalinfo &quot;WMS:https://sedac.ciesin.columbia.edu/geoserver/wms?SERVICE=WMS&amp;VERSION=1.1.1&amp;REQUEST=GetMap&amp;LAYERS=lulc%3Alulc-global-grid-prob-urban-expansion-2030&amp;SRS=EPSG:4326&amp;BBOX=-179.99997803468415,-55.922762245435266,180.02788233587063,83.97845284575614&quot;</code></pre>
<pre><code>gdal_translate -of WMS &quot;WMS:https://sedac.ciesin.columbia.edu/geoserver/wms?SERVICE=WMS&amp;VERSION=1.1.1&amp;REQUEST=GetMap&amp;LAYERS=grand-v1%3Agrand-v1-reservoirs-rev01&amp;SRS=EPSG:4326&amp;BBOX=-153.037,-45.881,176.825,70.398&quot; reservoirs.xml</code></pre>
<pre><code>gdal_translate -outsize 3600 1800 &quot;WMS:https://sedac.ciesin.columbia.edu/geoserver/wms?SERVICE=WMS&amp;VERSION=1.1.1&amp;REQUEST=GetMap&amp;LAYERS=grand-v1%3Agrand-v1-reservoirs-rev01&amp;SRS=EPSG:4326&amp;BBOX=-153.037,-45.881,176.825,70.398&quot; reservoirs.tif</code></pre>
<p>Specify a Bounding Box for India</p>
<pre><code>gdal_translate -outsize 10000 10000 &quot;WMS:https://sedac.ciesin.columbia.edu/geoserver/wms?SERVICE=WMS&amp;VERSION=1.1.1&amp;REQUEST=GetMap&amp;LAYERS=grand-v1%3Agrand-v1-reservoirs-rev01&amp;SRS=EPSG:4326&amp;BBOX=68.106,6.762,97.412,37.078&quot; reservoirs_india.tif</code></pre>
</div>
</div>
<div id="ogr-tools" class="section level1">
<h1>OGR Tools</h1>
<div id="working-with-csv-files" class="section level2">
<h2>Working with CSV files</h2>
<pre><code>ogrinfo worldcities.csv</code></pre>
<pre><code>ogrinfo -so -al worldcities.csv</code></pre>
<pre><code>ogrinfo -so -al worldcities.csv -oo X_POSSIBLE_NAMES=lng -oo Y_POSSIBLE_NAMES=lat</code></pre>
<pre><code>ogr2ogr -f GPKG worldcities.gpkg worldcities.csv -oo X_POSSIBLE_NAMES=lng -oo Y_POSSIBLE_NAMES=lat </code></pre>
<pre><code>ogr2ogr -f GPKG worldcities.gpkg worldcities.csv -oo X_POSSIBLE_NAMES=lng -oo Y_POSSIBLE_NAMES=lat -a_srs EPSG:4326</code></pre>
<pre><code>ogr2ogr -f GPKG mycities.gpkg worldcities.csv -oo X_POSSIBLE_NAMES=lng -oo Y_POSSIBLE_NAMES=lat -a_srs EPSG:4326  -where &quot;country = &#39;India&#39;&quot;</code></pre>
<p><a href="https://gdal.org/user/ogr_sql_dialect.html#ogr-sql-dialect">OGR SQL Syntax</a></p>
<pre><code>ogr2ogr -f GPKG mycities.gpkg worldcities.csv -oo X_POSSIBLE_NAMES=lng -oo Y_POSSIBLE_NAMES=lat -a_srs EPSG:4326 -sql &quot;SELECT city, country, CAST(population AS integer) as population from worldcities where country = &#39;India&#39;&quot;</code></pre>
<pre><code>ogr2ogr -f GPKG mycities.gpkg worldcities.csv -oo X_POSSIBLE_NAMES=lng -oo Y_POSSIBLE_NAMES=lat -a_srs EPSG:4326 -sql &quot;SELECT city, country, CAST(population AS integer) as population from worldcities where country = &#39;India&#39;&quot; -nln mycities</code></pre>
</div>
<div id="working-with-virtual-files" class="section level2">
<h2>Working with Virtual Files</h2>
<div id="read-geonames-files" class="section level3">
<h3>Read Geonames Files</h3>
<pre><code>&lt;OGRVRTDataSource&gt;
        &lt;OGRVRTLayer name=&quot;CA&quot;&gt;
            &lt;SrcDataSource&gt;CSV:CA.txt&lt;/SrcDataSource&gt;
            &lt;SrcLayer&gt;CA&lt;/SrcLayer&gt;
        &lt;/OGRVRTLayer&gt;
&lt;/OGRVRTDataSource&gt;</code></pre>
<pre><code>ogrinfo -al -so CA.vrt</code></pre>
</div>
<div id="applying-filters" class="section level3">
<h3>Applying Filters</h3>
<pre><code>&lt;OGRVRTDataSource&gt;
        &lt;OGRVRTLayer name=&quot;CA&quot;&gt;
            &lt;SrcDataSource&gt;CSV:CA.txt&lt;/SrcDataSource&gt;
            &lt;SrcLayer&gt;CA&lt;/SrcLayer&gt;
            &lt;SrcSQL&gt;select * from CA where &quot;FEATCLASS&quot; = &#39;T&#39;&lt;/SrcSQL&gt;
        &lt;/OGRVRTLayer&gt;
&lt;/OGRVRTDataSource&gt;</code></pre>
<pre><code>ogrinfo -al -so CA.vrt</code></pre>
</div>
<div id="merging-files" class="section level3">
<h3>Merging Files</h3>
<pre><code>
&lt;OGRVRTDataSource&gt;
    &lt;OGRVRTUnionLayer name=&quot;NA&quot;&gt;
    
        &lt;OGRVRTLayer name=&quot;CA&quot;&gt;
            &lt;SrcDataSource&gt;CSV:CA.txt&lt;/SrcDataSource&gt;
            &lt;SrcLayer&gt;CA&lt;/SrcLayer&gt;
            &lt;SrcSQL&gt;select * from CA where &quot;FEATCLASS&quot; = &#39;T&#39;&lt;/SrcSQL&gt;
        &lt;/OGRVRTLayer&gt;
    
        &lt;OGRVRTLayer name=&quot;MX&quot;&gt;
            &lt;SrcDataSource&gt;CSV:MX.txt&lt;/SrcDataSource&gt;
            &lt;SrcLayer&gt;MX&lt;/SrcLayer&gt;
            &lt;SrcSQL&gt;select * from MX where &quot;FEATCLASS&quot; = &#39;T&#39;&lt;/SrcSQL&gt;
        &lt;/OGRVRTLayer&gt;
    
        &lt;OGRVRTLayer name=&quot;US&quot;&gt;
            &lt;SrcDataSource&gt;CSV:US.txt&lt;/SrcDataSource&gt;
            &lt;SrcLayer&gt;US&lt;/SrcLayer&gt;
            &lt;SrcSQL&gt;select * from US where &quot;FEATCLASS&quot; = &#39;T&#39;&lt;/SrcSQL&gt;
        &lt;/OGRVRTLayer&gt;
    
    &lt;/OGRVRTUnionLayer&gt; 
&lt;/OGRVRTDataSource&gt;</code></pre>
<pre><code>ogr2ogr -f GPKG NA.gpkg NA.vrt</code></pre>
</div>
</div>
<div id="geoprocessing-spatial-queries" class="section level2">
<h2>Geoprocessing Spatial Queries</h2>
<pre><code>ogr2ogr -t_srs EPSG:7855 melbourne.gpkg melbourne.gpkg bars_and_pubs -update -nln bars_and_pubs_reprojected
ogr2ogr -t_srs EPSG:7855 melbourne.gpkg melbourne.gpkg metro_stations -update -nln metro_stations_reprojected</code></pre>
<pre><code>ogr2ogr melbourne.gpkg melbourne.gpkg -update -nln metro_stations_buffer -sql &quot;select m.station, buffer(m.geom, 500) as geom from metro_stations_reprojected m&quot; -dialect SQLITE </code></pre>
<p>You can dissolve the buffers using <code>ST_COLLECT</code></p>
<pre><code>ogr2ogr melbourne.gpkg melbourne.gpkg -update -nln metro_stations_buffer_dissolved -sql &quot;select st_union(d.geom) as geom from (select st_collect(buffer(m.geom, 500)) as geom from metro_stations_reprojected m) as d&quot; -dialect SQLITE</code></pre>
<pre><code>ogr2ogr -t_srs EPSG:4326 melbourne.gpkg melbourne.gpkg -update -nln selected -sql &quot;select  b.* from bars_and_pubs_reprojected as b join metro_stations_buffer_dissolved as m on ST_Within( b.geom, m.geom)&quot; -dialect SQLITE </code></pre>
</div>
</div>
<div id="multi-criteria-weighted-overlay-analysis" class="section level1">
<h1>Multi Criteria Weighted Overlay Analysis</h1>
<p>Multi-criteria analysis is the process of the allocation of land to suit a specific objective on the basis of a variety of attributes that the selected areas should possess.</p>
<p>Although this is a common GIS operation, it is best performed in the raster space. Below is the typical workflow to take source vector data, transform them to appropriate rasters, re-classify them and perform mathematical operations to do a suitability analysis.</p>
<p>The problem statement is <strong>Locate the suitable areas for development</strong>, that are</p>
<ul>
<li>Close to roads</li>
<li>Away from waterbodies</li>
<li>Not in protected areas</li>
</ul>
<div id="rasterize-vector-layers" class="section level2">
<h2>Rasterize vector layers</h2>
<p>For overlay analysis, all rasters must be of the same extent. So we first find the extent of the dataset that we can use while rasterizing.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ogrinfo</span> -so osm/assam.gpkg boundary</span></code></pre></div>
<div class="sourceCode" id="cb54"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gdal_rasterize</span> -ot Int16 -burn 1 -tr 15 15 -te 170134 2669018 798842 3097324 ^</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">osm/assam.gpkg</span> -l roads roads.tif</span></code></pre></div>
<p><img src="images/gdal/roads_raster.png" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gdal_rasterize</span> -ot Int16 -burn 1 -tr 15 15 -te 170134 2669018 798842 3097324 ^</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">osm/assam.gpkg</span> -l boundary boundary.tif</span></code></pre></div>
<p>Use <code>-i</code> for inverse rasterization. We want to rasterize ‘un-protected’ areas</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gdal_rasterize</span> -i -ot Int16 -burn 1 -tr 15 15 -te 170134 2669018 798842 3097324 ^</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">osm/assam.gpkg</span> -l protected_regions protected_regions.tif</span></code></pre></div>
<p>We need a water layer, but the source data has a polygon and a polyline water features layer. We create 2 rasters and then add them to create a single water features raster.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gdal_rasterize</span> -ot Int16 -burn 1 -tr 15 15 -te 170134 2669018 798842 3097324 ^</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">osm/assam.gpkg</span> -l water_polygons water_polygons.tif</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="ex">gdal_rasterize</span> -ot Int16 -burn 1 -tr 15 15 -te 170134 2669018 798842 3097324 ^</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="ex">osm/assam.gpkg</span> -l water_polylines water_polylines.tif</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="ex">gdal_calc</span> -A water_polygons.tif -B water_polylines.tif ^</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--outfile</span> water_add.tif --calc=<span class="st">&quot;A+B&quot;</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="ex">gdal_calc</span> -A water_add.tif --outfile water.tif ^</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--calc</span>=<span class="st">&quot;A&gt;0&quot;</span></span></code></pre></div>
<p><img src="images/gdal/water_raster.png" style="display: block; margin: auto;" /></p>
</div>
<div id="generate-proximity-euclidean-distance-rasters" class="section level2">
<h2>Generate proximity (Euclidean distance) rasters</h2>
<div class="sourceCode" id="cb58"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gdal_proximity</span> roads.tif roads_proximity.tif ^</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-ot</span> Int16 -distunits GEO</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="ex">gdal_proximity</span> water.tif water_proximity.tif ^</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-ot</span> Int16 -distunits GEO</span></code></pre></div>
<p><img src="images/gdal/roads_proximity.png" style="display: block; margin: auto;" /></p>
</div>
<div id="re-classify-raster-values" class="section level2">
<h2>Re-classify raster values</h2>
<p><strong>Roads</strong> Give higher score to nearer pixels</p>
<p>0-1000m –&gt; 100</p>
<p>1000-5000m –&gt; 50</p>
<p>&gt;5000m –&gt; 10</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gdal_calc</span> -A roads_proximity.tif --outfile roads_class.tif ^</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--calc</span>=<span class="st">&quot;100*(A&lt;=1000) + 50*(A&gt;1000)*(A&lt;=5000) + 10*(A&gt;5000)&quot;</span></span></code></pre></div>
<p><img src="images/gdal/roads_class.png" style="display: block; margin: auto;" /></p>
<p><strong>Water</strong> Give lower score to nearer pixels</p>
<p>0-1000m –&gt; 10</p>
<p>1000 -5000m —&gt; 50</p>
<p>&gt;5000m –&gt; 100</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gdal_calc</span> -A water_proximity.tif --outfile water_class.tif ^</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--calc</span>=<span class="st">&quot;100*(A&gt;5000) + 50*(A&gt;1000)*(A&lt;=5000) + 10*(A&lt;1000)&quot;</span></span></code></pre></div>
<p><img src="images/gdal/water_class.png" style="display: block; margin: auto;" /></p>
</div>
<div id="overlay-analysis" class="section level2">
<h2>Overlay analysis</h2>
<p>Roads and Water have a range of values, but protected areas are either 0 or 1. So we combine these together accordingly.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gdal_calc</span> ^</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">-A</span> roads_class.tif -B water_class.tif -C protected_regions.tif -D boundary.tif ^</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--outfile</span> suitability.tif --calc=<span class="st">&quot;(A + B)*(C&gt;0)*D&quot;</span> --NoDataValue=0</span></code></pre></div>
<p>Smooth the output</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gdalwarp</span> -r cubicspline -tr 60 60 -dstnodata 0 ^</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">suitability.tif</span> suitability_final.tif</span></code></pre></div>
<p><img src="images/gdal/suitability.png" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="running-commands-in-batch" class="section level1">
<h1>Running commands in batch</h1>
<p>You can run the GDAL/OGR commands in a loop using Python. Open OSGeo4W Shell and type the following to set the correct system paths</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="ex">py3_env</span></span></code></pre></div>
<p>Say you want to convert the format of the images from JPEG200 to GeoTiff. You would run a command such as below.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gdal_translate</span> -of GTiff -co COMPRESS=JPEG <span class="dt">{input}</span> <span class="dt">{output}</span></span></code></pre></div>
<p>But it would be a lot of manual effort if you want to run the commands on hundreds of input files. Here’s where a simple python script can help you automate running the commands in a batch. The data directory contains a file called <code>batch.py</code> with the following python code.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>input_dir <span class="op">=</span> <span class="st">&#39;naip&#39;</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>command <span class="op">=</span> <span class="st">&#39;gdal_translate -of GTiff -co COMPRESS=JPEG </span><span class="sc">{input}</span><span class="st"> </span><span class="sc">{output}</span><span class="st">&#39;</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> os.listdir(input_dir):</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">file</span>.endswith(<span class="st">&#39;.jp2&#39;</span>):</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">input</span> <span class="op">=</span> os.path.join(input_dir, <span class="bu">file</span>)</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>    filename <span class="op">=</span> os.path.splitext(os.path.basename(<span class="bu">file</span>))[<span class="dv">0</span>]</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span>  os.path.join(input_dir, filename <span class="op">+</span> <span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>    os.system(command.<span class="bu">format</span>(<span class="bu">input</span><span class="op">=</span><span class="bu">input</span>, output<span class="op">=</span>output))</span></code></pre></div>
<p>In OsGeo4W shell, run the following command to start batch processing on all tiles contained in the <code>naip/</code> directory.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span> batch.py</span></code></pre></div>
<p>The data directory also contains an example of running the batch commands in parallel using python’s built-in multiprocessing library. If your system has multi-core CPU, running commands in parallel like this on multiple threads can give you performance boost over running them in series.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> multiprocessing <span class="im">import</span> Pool</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> timeit <span class="im">import</span> default_timer <span class="im">as</span> timer</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>input_dir <span class="op">=</span> <span class="st">&#39;naip&#39;</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>command <span class="op">=</span> <span class="st">&#39;gdal_translate -of GTiff -co COMPRESS=JPEG </span><span class="sc">{input}</span><span class="st"> </span><span class="sc">{output}</span><span class="st">&#39;</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process(<span class="bu">file</span>):</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">input</span> <span class="op">=</span> os.path.join(input_dir, <span class="bu">file</span>)</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>    filename <span class="op">=</span> os.path.splitext(os.path.basename(<span class="bu">file</span>))[<span class="dv">0</span>]</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span>  os.path.join(input_dir, filename <span class="op">+</span> <span class="st">&#39;.tif&#39;</span>)</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>    os.system(command.<span class="bu">format</span>(<span class="bu">input</span><span class="op">=</span><span class="bu">input</span>, output<span class="op">=</span>output))</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>files <span class="op">=</span> [<span class="bu">file</span> <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> os.listdir(input_dir) <span class="cf">if</span> <span class="bu">file</span>.endswith(<span class="st">&#39;.jp2&#39;</span>)]</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&#39;__main__&#39;</span>:</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>  start <span class="op">=</span> timer()</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>  p <span class="op">=</span> Pool(<span class="dv">4</span>)</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>  p.<span class="bu">map</span>(process, files)</span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>  end <span class="op">=</span> timer()</span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(end <span class="op">-</span> start)</span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>  start <span class="op">=</span> timer()</span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>    process(<span class="bu">file</span>)</span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>  end <span class="op">=</span> timer()</span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(end <span class="op">-</span> start)</span></code></pre></div>
<p>The script runs the commands both in parallel and serial mode and prints the time taken by each of them.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span> batch-parallel.py</span></code></pre></div>
</div>
<div id="resources" class="section level1">
<h1>Resources</h1>
<ul>
<li><span class="citation">[GDAL Tips @gdaltips]</span>(<a href="https://twitter.com/gdaltips" class="uri">https://twitter.com/gdaltips</a>) on Twitter</li>
</ul>
</div>
<div id="data-credits" class="section level1">
<h1>Data Credits</h1>
<ul>
<li>OpenStreetMap (osm) data layers: Data/Maps Copyright 2019 Geofabrik GmbH and OpenStreetMap Contributors. <a href="https://download.geofabrik.de/asia/india.html">OSM India free extract</a> downloaded from Geofabrik.</li>
<li>Landsat: Landsat-8 image courtesy of the U.S. Geological Survey. Image downloaded from <a href="https://console.cloud.google.com/marketplace/details/usgs-public-data/landast">Google Cloud Platform</a> and pre-processed using <a href="https://fromgistors.blogspot.com/p/semi-automatic-classification-plugin.html">Semi Automatic Classification Plugin from QGIS</a></li>
<li>Earth at Night image: Credit: NASA Earth Observatory/NOAA NGDC. Earth at Night flat hi-resolution map downloaded from <a href="https://earthobservatory.nasa.gov/features/NightLights/page3.php">NASA earth observatory</a></li>
<li>William Mackenzie 1870 map of Southern India: out-of-copyright scanned map downloaded from <a href="http://www.hipkiss.org/data/maps.html">Hipkiss’s Scanned Old Maps</a></li>
<li>NAIP 2016 Aerial Imagery for California: The National Agriculture Imagery Program (NAIP). USDA-FSA-APFO Aerial Photography Field Office. Downloaded from <a href="https://nrcs.app.box.com/v/naip/folder/18144379349">NRCS</a></li>
</ul>
</div>
<div id="license" class="section level1">
<h1>License</h1>
<p>This course material is licensed under a <a href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>. You are free to use the material for any non-commercial purpose. Kindly give appropriate credit to the original author.</p>
<p>© 2020 Ujaval Gandhi <a href="http://spatialthoughts.com">www.spatialthoughts.com</a></p>
<hr />
<p><strong>This course is offered as an instructor-led online class. Visit <a href="https://spatialthoughts.com/events/">Spatial Thoughts</a> to know details of upcoming sessions.</strong></p>
</div>

<div id="disqus_thread" class="standardPadding"></div>

<!-- disqus -->
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = 'https://courses.spatialthoughts.com' + location.pathname;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://spatialthoughts.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
