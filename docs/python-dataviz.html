<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Ujaval Gandhi" />


<title>Mapping and Data Visualization with Python (Full Course Material)</title>

<script src="site_libs/header-attrs-2.10/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-172372432-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-172372432-3');
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Courses</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="http://spatialthoughts.com">Back to Main Site</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="#">Back to Top</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Mapping and Data Visualization with Python (Full Course Material)</h1>
<h3 class="subtitle">A comprehensive guide for creating static and dynamic visualizations with spatial data.</h3>
<h4 class="author">Ujaval Gandhi</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#get-the-data-package">Get the Data Package</a></li>
<li><a href="#installation-and-setting-up-the-environment">Installation and Setting up the Environment</a></li>
<li><a href="#hello-colab">Hello Colab</a>
<ul>
<li><a href="#package-management">Package Management</a></li>
<li><a href="#data-management">Data Management</a></li>
</ul></li>
<li><a href="#matplotlib-basics">Matplotlib Basics</a>
<ul>
<li><a href="#setup">Setup</a></li>
<li><a href="#concepts">Concepts</a></li>
<li><a href="#exercise">Exercise</a></li>
</ul></li>
<li><a href="#creating-charts">Creating Charts</a>
<ul>
<li><a href="#exercise-1">Exercise</a></li>
</ul></li>
<li><a href="#creating-maps">Creating Maps</a>
<ul>
<li><a href="#exercise-2">Exercise</a></li>
</ul></li>
<li><a href="#using-basemaps">Using Basemaps</a>
<ul>
<li><a href="#exercise-3">Exercise</a></li>
</ul></li>
<li><a href="#visualizing-rasters">Visualizing Rasters</a>
<ul>
<li><a href="#xarray-and-rioxarray-basics">XArray and rioxarray Basics</a></li>
<li><a href="#merging-rasters">Merging Rasters</a></li>
<li><a href="#visualizing-rasters-using-matplotlib">Visualizing Rasters using Matplotlib</a></li>
</ul></li>
<li><a href="#mapping-gridded-datasets">Mapping Gridded Datasets</a>
<ul>
<li><a href="#exercise-4">Exercise</a></li>
</ul></li>
<li><a href="#creating-interactive-maps-with-folium">Creating Interactive Maps with Folium</a>
<ul>
<li><a href="#exercise-5">Exercise</a></li>
</ul></li>
<li><a href="#creating-multi-layer-interactive-maps">Creating Multi-layer Interactive Maps</a>
<ul>
<li><a href="#exercise-6">Exercise</a></li>
</ul></li>
<li><a href="#supplement">Supplement</a>
<ul>
<li><a href="#elevation-profile-plot-from-a-gps-track">Elevation Profile Plot from a GPS Track</a></li>
<li><a href="#creating-a-stacked-bar-chart">Creating A Stacked Bar Chart</a></li>
<li><a href="#animations-with-matplotlib">Animations with Matplotlib</a></li>
</ul></li>
<li><a href="#resources">Resources</a></li>
<li><a href="#data-credits">Data Credits</a></li>
<li><a href="#license">License</a></li>
</ul>
</div>

<div style="page-break-after: always;"></div>
<hr />
<p><img src="images/spatial_thoughts_logo.png" width="250pt" style="display: block; margin: auto;" /></p>
<hr />
<div style="page-break-after: always;"></div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This is an intermediate-level course that teaches you how to use Python for creating charts, plots, animations, and maps.</p>
<p><a href="https://docs.google.com/presentation/d/1Mc8O7zXJt-0LwUocPjpfjvkqYj-0qRnUMUIFpftVZFw/edit?usp=sharing" target="_blank"><img src="images/python_dataviz/course_overview.png" width="400" alt="View Presentation" /></a></p>
<p><a href="https://docs.google.com/presentation/d/1Mc8O7zXJt-0LwUocPjpfjvkqYj-0qRnUMUIFpftVZFw/edit?usp=sharing" target="_blank">View the Presentation ↗</a></p>
</div>
<div id="get-the-data-package" class="section level1">
<h1>Get the Data Package</h1>
<p>The code examples in this class use a variety of datasets. All the required datasets and Jupyter notebooks are supplied to you in the <code>python_dataviz.zip</code> file. Unzip this file to a directory - preferably to the <code>&lt;home folder&gt;/Downloads/python_dataviz/</code> folder.</p>
<p><em>Not enrolled in our instructor-led class but want to work through the material on your own?</em> <a href="https://docs.google.com/forms/d/e/1FAIpQLSf6TGQmr5w_QlDEgZ7QJrfuiRTu-aCuhfcNY_fYCU3zv9hHOg/viewform" target="_blank">Get free access to the data package</a></p>
</div>
<div id="installation-and-setting-up-the-environment" class="section level1">
<h1>Installation and Setting up the Environment</h1>
<p>This class requires installing Anaconda and creating a new environment named `<code>python_dataviz</code>. Please review the <a href="https://courses.spatialthoughts.com/python-foundation.html#installation-and-setting-up-the-environment">Anaconda Installation Guide</a> for step-by-step instructions.</p>
<p>Once you have created and activate the <code>python_dataviz</code> environment, install the following packages from the <code>conda-forge</code> channel.</p>
<ul>
<li><code>geopandas</code></li>
<li><code>matplotlib</code></li>
<li><code>jupyterlab</code></li>
<li><code>xarray</code></li>
<li><code>rioxarray</code></li>
<li><code>contextily</code></li>
<li><code>cartopy</code></li>
<li><code>folium</code></li>
</ul>
<p>Open the command prompt/terminal and run the following conda commands for installation.</p>
<pre><code>conda create --name python_dataviz
conda activate python_dataviz
conda install -c conda-forge geopandas matplotlib jupyterlab xarray rioxarray contextily cartopy folium -y</code></pre>
<div style="page-break-after: always;"></div>
</div>
<div id="hello-colab" class="section level1">
<h1>Hello Colab</h1>
<p><a href="https://colab.research.google.com/github/spatialthoughts/python-dataviz/blob/main/00_hello_colab.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab" /></a></p>
<p><a href="https://colab.research.google.com/">Google Colab</a> is a hosted Jupyter notebook environment that allows anyone to run Python code via a web-browser. It provides you free computation and data storage that can be utilized by your Python code.</p>
<p>You can click the <code>+Code</code> button to create a new cell and enter a block of code. To run the code, click the <strong>Run Code</strong> button next to the cell, or press <code>Shirt+Enter</code> key.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Hello World&#39;</span>)</span></code></pre></div>
<pre><code>Hello World</code></pre>
<div id="package-management" class="section level3">
<h3>Package Management</h3>
<p>Colab comes pre-installed with many Python packages. You can use a package by simply importing it.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code></pre></div>
<p>Each Colab notebook instance is run on a Ubuntu Linux machine in the cloud. If you want to install any packages, you can run a command by prefixing the command with a <code>!</code>. For example, you can install third-party packages via <code>pip</code> using the command <code>!pip</code>.</p>
<blockquote>
<p>Tip: If you want to list all pre-install packages and their versions in your Colab environemnt, you can run <code>!pip list -v</code>.</p>
</blockquote>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="op">--</span>quiet rioxarray</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray</span></code></pre></div>
<p>Some packages may also require additional binaries or local configuration. This can be achieved using package management commands for Ubuntu Linux. For example, we can run <code>apt</code> command to install specific package required for <code>geopandas</code> to work correctly.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>apt install <span class="op">-</span>qq libspatialindex<span class="op">-</span>dev</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="op">--</span>quiet fiona shapely pyproj rtree</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="op">--</span>quiet geopandas</span></code></pre></div>
<pre><code>libspatialindex-dev is already the newest version (1.8.5-5).
The following package was automatically installed and is no longer required:
  libnvidia-common-460
Use &#39;apt autoremove&#39; to remove it.
0 upgraded, 0 newly installed, 0 to remove and 20 not upgraded.</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span></code></pre></div>
</div>
<div id="data-management" class="section level3">
<h3>Data Management</h3>
<p>Colab provides 100GB of disk space along with your notebook. This can be used to store your data, intermediate outputs and results.</p>
<p>The code below will create 2 folders named ‘data’ and ‘output’ in your local filesystem.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>data_folder <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>output_folder <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(data_folder):</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    os.mkdir(data_folder)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(output_folder):</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    os.mkdir(output_folder)</span></code></pre></div>
<p>We can download some data from the internet and store it in the Colab environment. Below is a helper function that uses <code>urllib</code> to fetch any file from a URL.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> download(url):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    filename <span class="op">=</span> os.path.join(data_folder, os.path.basename(url))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(filename):</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        <span class="im">from</span> urllib.request <span class="im">import</span> urlretrieve</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        local, _ <span class="op">=</span> urlretrieve(url, filename)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;Downloaded &#39;</span> <span class="op">+</span> local)</span></code></pre></div>
<p>Let’s download the <a href="https://www.naturalearthdata.com/downloads/10m-cultural-vectors/">Populated Places</a> dataset from Natural Earth.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>download(<span class="st">&#39;https://naciscdn.org/naturalearth/10m/cultural/&#39;</span> <span class="op">+</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;ne_10m_populated_places_simple.zip&#39;</span>)</span></code></pre></div>
<pre><code>Downloaded data/ne_10m_populated_places_simple.zip</code></pre>
<p>The file is now in our local filesystem. We can construct the path to the data folder and read it using <code>geopandas</code></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">file</span> <span class="op">=</span> <span class="st">&#39;ne_10m_populated_places_simple.zip&#39;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>filepath <span class="op">=</span> os.path.join(data_folder, <span class="bu">file</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>places <span class="op">=</span> gpd.read_file(filepath)</span></code></pre></div>
<p>Let’s do some data processing and write the results to a new file. The code below will filter all places which are also country capitals.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>capitals <span class="op">=</span> places[places[<span class="st">&#39;adm0cap&#39;</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>capitals</span></code></pre></div>
<p>We can write the results to the disk as a GeoPackage file.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>output_file <span class="op">=</span> <span class="st">&#39;capitals.gpkg&#39;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(output_folder, output_file)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>capitals.to_file(driver<span class="op">=</span><span class="st">&#39;GPKG&#39;</span>, filename<span class="op">=</span>output_path)</span></code></pre></div>
<p>You can open the <strong>Files</strong> tab from the left-hand panel in Colab and browse to the <code>output</code> folder. Locate the <code>capitals.gpkg</code> file and click the <strong>⋮</strong> button and select <em>Download</em> to download the file locally.</p>
<hr />
</div>
</div>
<div id="matplotlib-basics" class="section level1">
<h1>Matplotlib Basics</h1>
<p><a href="https://colab.research.google.com/github/spatialthoughts/python-dataviz/blob/main/01_matplotlib_basics.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab" /></a></p>
<hr />
<p>This notebook introduces the <a href="https://matplotlib.org/">Matplotlib</a> library. This is one of the core Python packages for data visualization and is used by many spatial and non-spatial packages to create charts and maps.</p>
<div id="setup" class="section level2">
<h2>Setup</h2>
<p>Most of the Matplotlib functionality is available in the <code>pyplot</code> submodule, and by convention is imported as <code>plt</code></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code></pre></div>
</div>
<div id="concepts" class="section level2">
<h2>Concepts</h2>
<p>It is important to understand the 2 matplotlib objects</p>
<ul>
<li>Figure: This is the main container of the plot. A figure can contain multiple plots inside it</li>
<li>Axes: Axes refers to an individual plot or graph. A figure contains 1 or more axes.</li>
</ul>
<p>We create a figure and a single subplot. Specifying 1 row and 1 column for the <code>subplots()</code> function create a figure and an axes within it. Even if we have a single plot in the figure, it is useful to use tthis logic of intialization so it is consistent across different scripts.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">5</span>,<span class="dv">5</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/01_matplotlib_basics_files/01_matplotlib_basics_7_0.png" /></p>
<p>First, let’s learn how to plot a single point using matplotlib. Let’s say we want to display a point at the coordinate (0.5, 0.5).</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>point <span class="op">=</span> (<span class="fl">0.5</span>, <span class="fl">0.5</span>)</span></code></pre></div>
<p>We display the point using the <code>plot()</code> function. The <code>plot()</code> function expects at least 2 arguments, first one being one or more x coordinates and the second one being one or more y coordinates. Remember that once a plot is displayed using <code>plt.show()</code>, it displays the plot and empties the figure. So you’ll have to create it again.</p>
<p>Reference: <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.plot.html">matplotlib.pyplot.plot</a></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">5</span>,<span class="dv">5</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>ax.plot(point[<span class="dv">0</span>], point[<span class="dv">1</span>], color<span class="op">=</span><span class="st">&#39;green&#39;</span>, marker<span class="op">=</span><span class="st">&#39;o&#39;</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/01_matplotlib_basics_files/01_matplotlib_basics_11_0.png" /></p>
<p><strong>Note: Understanding <code>*args</code> and <code>**kwargs</code></strong></p>
<p>Python functions accept 2 types of arguments. - <em>Non Keyword Arguments</em>: These are referred as <code>*args</code>. When the number of arguments that a function takes is not fixed, it is specified as <code>*args</code>. In the function <code>plot()</code> above, you can specify 1 argument, 2 arguments or even 6 arguments and the function will respond accordingly. - <em>Keyword Arguments</em>: These are referred as <code>**kwargs</code>. These are specified as <code>key=value</code> pairs and usually used to specify optional parameters. These should always be specified after the non-keyword arguments. The <code>color='green'</code> in the <code>plot()</code> function is a keyboard argument.</p>
<p>One problematic area for plotting geospatial data using matplotlib is that geospatial data is typically represented as a list of x and y coordinates. Let’s say we want to plot the following 3 points defined as a list of (x,y) tuples.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>points <span class="op">=</span> [(<span class="fl">0.1</span>, <span class="fl">0.5</span>), (<span class="fl">0.5</span>, <span class="fl">0.5</span>), (<span class="fl">0.9</span>, <span class="fl">0.5</span>)]</span></code></pre></div>
<p>But to plot it, <code>matplotlib</code> require 2 separate lists or x and y coordinates. Here we can use the <code>zip()</code> function to create list of x and y coordinates.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>x, y <span class="op">=</span> <span class="bu">zip</span>(<span class="op">*</span>points)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y)</span></code></pre></div>
<pre><code>(0.1, 0.5, 0.9)
(0.5, 0.5, 0.5)</code></pre>
<p>Now these can be plotted using the <code>plot()</code> method. We specify keyword arguments <code>color</code> and <code>marker</code>.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">5</span>,<span class="dv">5</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>ax.plot(x, y, color<span class="op">=</span><span class="st">&#39;green&#39;</span>, marker<span class="op">=</span><span class="st">&#39;o&#39;</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/01_matplotlib_basics_files/01_matplotlib_basics_18_0.png" /></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">5</span>,<span class="dv">5</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>ax.plot(x, y, color<span class="op">=</span><span class="st">&#39;green&#39;</span>, marker<span class="op">=</span><span class="st">&#39;o&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;None&#39;</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/01_matplotlib_basics_files/01_matplotlib_basics_19_0.png" /></p>
<p>You can save the figure using the <code>savefig()</code> method. Remember to save the figure <em>before</em> calling <code>plt.show()</code> otherwise the figure would be empty.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">5</span>,<span class="dv">5</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>ax.plot(x, y, color<span class="op">=</span><span class="st">&#39;green&#39;</span>, marker<span class="op">=</span><span class="st">&#39;o&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;None&#39;</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>output_folder <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(output_folder, <span class="st">&#39;simple.png&#39;</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>plt.savefig(output_path)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>Matplotlib provides many specialized functions for different types of plots. <code>scatter()</code> for Scatter Charts, <code>bar()</code> for Bar Charts and so on. You can use them directly, but in practice they are used via higher-level libraries like <code>pandas</code>. In the next section, we will see how to create such charts.</p>
</div>
<div id="exercise" class="section level2">
<h2>Exercise</h2>
<p>Create a plot that displays the 2 given points with their x,y coordinates with different sumbology.</p>
<ul>
<li><code>point1</code>: Plot it with green color and a triangle marker.</li>
<li><code>point2</code>: Plot it with red color and a circle marker.</li>
</ul>
<p>Reference: <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.plot.html">matplotlib.pyplot.plot</a></p>
<blockquote>
<p>Hint: You can call <code>plot()</code> multiple times to add new data to the same Axes.</p>
</blockquote>
<div class="sourceCode" id="cb27"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>point1 <span class="op">=</span> (<span class="dv">4</span>, <span class="dv">1</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>point2 <span class="op">=</span> (<span class="dv">3</span>, <span class="dv">4</span>)</span></code></pre></div>
<hr />
<p>Open the notebook named <code>02_creating_charts.ipynb</code>.</p>
<hr />
</div>
</div>
<div id="creating-charts" class="section level1">
<h1>Creating Charts</h1>
<p>Pandas allows you to read structured datasets and visualize them using the <code>plot()</code> method. By default, Pandas uses <code>matplotlib</code> to create the plots.</p>
<p>In this notebook, we will take work with open dataset of crime in London.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code></pre></div>
<p>We have 12 different CSV files containing crime data for each month of 2020. We can use the <code>glob</code> module to find all files matching a pattern.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>data_pkg_path <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>folder <span class="op">=</span> <span class="st">&#39;crime&#39;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>file_pattern <span class="op">=</span> <span class="st">&#39;2020-*.csv&#39;</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>file_path_pattern <span class="op">=</span> os.path.join(data_pkg_path, folder, file_pattern)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>file_list <span class="op">=</span> []</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> glob.glob(file_path_pattern):</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    file_list.append(<span class="bu">file</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>file_list</span></code></pre></div>
<p>It will be helpful to merge all these files into a single dataframe. We can use <code>pd.concat()</code> to merge a list of dataframes.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>dataframe_list <span class="op">=</span> []</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> file_list:</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(<span class="bu">file</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    dataframe_list.append(df)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>merged_df <span class="op">=</span> pd.concat(dataframe_list)</span></code></pre></div>
<p>Let’s create a pie-chart showing the distribution of different types of crime. Pandas <code>groupby()</code> function allows us to calculate group statistics.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>type_counts <span class="op">=</span> merged_df.groupby(<span class="st">&#39;Crime type&#39;</span>).size()</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>type_counts</span></code></pre></div>
<p>We now uses the <code>plot()</code> method to create the chart. This method is a wrapper around <code>matplotlib</code> and can accept supported arguments from it.</p>
<p>Reference: <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.plot.html">pandas.DataFrame.plot</a></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">15</span>,<span class="dv">7</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>type_counts.plot(kind<span class="op">=</span><span class="st">&#39;pie&#39;</span>, ax<span class="op">=</span>ax)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">15</span>,<span class="dv">7</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>type_counts.plot(kind<span class="op">=</span><span class="st">&#39;pie&#39;</span>, ax<span class="op">=</span>ax, wedgeprops<span class="op">=</span>{<span class="st">&#39;linewidth&#39;</span>: <span class="fl">1.0</span>, <span class="st">&#39;edgecolor&#39;</span>: <span class="st">&#39;white&#39;</span>}, label<span class="op">=</span><span class="st">&#39;&#39;</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Crime Types&#39;</span>, fontsize <span class="op">=</span> <span class="dv">18</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>We can also chart the trend of crime over the year. For this, let’s group the data by month.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>monthly_counts <span class="op">=</span> merged_df.groupby(<span class="st">&#39;Month&#39;</span>).size()</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>monthly_counts</span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">15</span>,<span class="dv">7</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>monthly_counts.plot(kind<span class="op">=</span><span class="st">&#39;bar&#39;</span>, ax<span class="op">=</span>ax)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">15</span>,<span class="dv">7</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>monthly_counts.plot(kind<span class="op">=</span><span class="st">&#39;bar&#39;</span>, ax<span class="op">=</span>ax)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>monthly_counts.plot(kind<span class="op">=</span><span class="st">&#39;line&#39;</span>, ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">&#39;red&#39;</span>, marker<span class="op">=</span><span class="st">&#39;o&#39;</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div id="exercise-1" class="section level2">
<h2>Exercise</h2>
<p>Plot the trend of Bicycle thefts as a line chart. The cell below filters the <code>merged_df</code> dataframe to select incidents of ‘Bicycle theft’. Group the results by months and plot the results.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>bicycle_thefts <span class="op">=</span> merged_df[merged_df[<span class="st">&#39;Crime type&#39;</span>] <span class="op">==</span> <span class="st">&#39;Bicycle theft&#39;</span>]</span></code></pre></div>
<hr />
<p>Open the notebook named <code>03_creating_maps.ipynb</code>.</p>
<hr />
</div>
</div>
<div id="creating-maps" class="section level1">
<h1>Creating Maps</h1>
<p>Similar to Pandas, GeoPandas has a <code>plot()</code> method that can plot geospatial data using Matplotlib.</p>
<p>We will work with census data to create a choropleth map of population density. We will start with a shapefile of census tracts, and join it with tabular data to get a GeoDataframe with census tract geometry and correponding populations.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code></pre></div>
<p>Read the census tracts shapefile as a GeoDataframe</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>data_pkg_path <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>folder <span class="op">=</span> <span class="st">&#39;census&#39;</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">&#39;tl_2019_06_tract.shp&#39;</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> os.path.join(data_pkg_path, folder, filename)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>tracts <span class="op">=</span> gpd.read_file(file_path)</span></code></pre></div>
<p>The <code>plot()</code> method will render the data to a plot.</p>
<p>Reference: <a href="https://geopandas.org/en/stable/docs/reference/api/geopandas.GeoDataFrame.plot.html">geopandas.GeoDataFrame.plot</a></p>
<p>You can supply additional style options to change the appearance of the map.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">10</span>,<span class="dv">10</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>tracts.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">&#39;grey&#39;</span>, edgecolor<span class="op">=</span><span class="st">&#39;red&#39;</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>The shapefile does not have any demographic data columns. But we have a CSV file containing a variety of population statistics for each tract. We read this file as a Pandas DataFrame.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>data_pkg_path <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>folder <span class="op">=</span> <span class="st">&#39;census&#39;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">&#39;ACSST5Y2019.S0101_data.csv&#39;</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> os.path.join(data_pkg_path, folder, filename)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> pd.read_csv(file_path, skiprows<span class="op">=</span>[<span class="dv">1</span>])</span></code></pre></div>
<p>To join this DataFrame with the GeoDataFrame, we need a column with unique identifiers. We use the <code>GEOID</code> column and process the id so they match exactly in both datasets.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>filtered <span class="op">=</span> table[[<span class="st">&#39;GEO_ID&#39;</span>,<span class="st">&#39;NAME&#39;</span>, <span class="st">&#39;S0101_C01_001E&#39;</span>]]</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>filtered <span class="op">=</span> filtered.rename(columns <span class="op">=</span> {<span class="st">&#39;S0101_C01_001E&#39;</span>: <span class="st">&#39;Population&#39;</span>, <span class="st">&#39;GEO_ID&#39;</span>: <span class="st">&#39;GEOID&#39;</span>})</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>filtered[<span class="st">&#39;GEOID&#39;</span>] <span class="op">=</span> filtered.GEOID.<span class="bu">str</span>[<span class="op">-</span><span class="dv">11</span>:]</span></code></pre></div>
<p>Finally, we do a table join using the <code>merge</code> method.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> tracts.merge(filtered, on<span class="op">=</span><span class="st">&#39;GEOID&#39;</span>)</span></code></pre></div>
<p>For creating a choropleth map, we must normalize the population counts. US Census Bureau <a href="https://www.census.gov/quickfacts/fact/note/US/LND110210">recommends</a> calculating the population density by dividing the total population by the land area. The original shapefile contains a column <code>ALAND</code> with the land area in square kilometers. Using it, we compute a new column <code>density</code> containing the persons per square kilometer.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>gdf[<span class="st">&#39;density&#39;</span>] <span class="op">=</span> <span class="fl">1e6</span><span class="op">*</span>gdf[<span class="st">&#39;Population&#39;</span>]<span class="op">/</span>gdf[<span class="st">&#39;ALAND&#39;</span>]</span></code></pre></div>
<p>For a choropleth map, we can specify a color ramp and classification scheme.</p>
<p>References: - <a href="https://matplotlib.org/stable/tutorials/colors/colormaps.html">Matplotlib Colormaps</a> - <a href="https://pysal.org/mapclassify/generated/mapclassify.classify.html#mapclassify.classify">Mapclassify Classification Schemes</a></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">10</span>,<span class="dv">10</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>gdf.plot(ax<span class="op">=</span>ax, column<span class="op">=</span><span class="st">&#39;density&#39;</span>, scheme<span class="op">=</span><span class="st">&#39;quantiles&#39;</span>)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">10</span>,<span class="dv">10</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>gdf.plot(ax<span class="op">=</span>ax, column<span class="op">=</span><span class="st">&#39;density&#39;</span>, cmap<span class="op">=</span><span class="st">&#39;RdYlGn_r&#39;</span>, scheme<span class="op">=</span><span class="st">&#39;quantiles&#39;</span>, k<span class="op">=</span><span class="dv">10</span>, legend<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>Instead of the class breaks being determined by the classification scheme, we can manually specify the ranges.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">10</span>,<span class="dv">10</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>gdf.plot(ax<span class="op">=</span>ax, column<span class="op">=</span><span class="st">&#39;density&#39;</span>, cmap<span class="op">=</span><span class="st">&#39;RdYlGn_r&#39;</span>, scheme<span class="op">=</span><span class="st">&#39;User_Defined&#39;</span>, </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>         legend<span class="op">=</span><span class="va">True</span>, classification_kwds<span class="op">=</span><span class="bu">dict</span>(bins<span class="op">=</span>[<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">25</span>,<span class="dv">50</span>,<span class="dv">100</span>, <span class="dv">250</span>, <span class="dv">500</span>, <span class="dv">1000</span>, <span class="dv">5000</span>]))</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;California Population Density (2019)&#39;</span>, size <span class="op">=</span> <span class="dv">18</span>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>output_folder <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(output_folder, <span class="st">&#39;california_pop.png&#39;</span>)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>plt.savefig(output_path, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div id="exercise-2" class="section level2">
<h2>Exercise</h2>
<p>Plot the census tracts geodataframe <code>tracts</code> with just outlines and no fill color.</p>
<p>Hint: The styling options as specified as keyword arguments to the <code>plot()</code> function. Set the <code>facecolor</code> option to <code>'none'</code> for no fills. Check the <a href="https://geopandas.org/en/stable/docs/reference/api/geopandas.GeoDataFrame.plot.html"><em>style_kwds</em> parameter</a> of the <code>plot()</code> method for more details.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">10</span>,<span class="dv">10</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>tracts.plot(ax<span class="op">=</span>ax)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<hr />
<p>Open the notebook named <code>04_using_basemaps.ipynb</code>.</p>
<hr />
</div>
</div>
<div id="using-basemaps" class="section level1">
<h1>Using Basemaps</h1>
<p>Creating geospatial visualizations oftern require overlaying your data on a basemap. <a href="https://contextily.readthedocs.io/en/latest/">Contextily</a> is a package that allows you to fetch various basemaps from the internet and ad them to your plot as static images.</p>
<p>We will learn how to take a shapefile showing the path of the <a href="https://svs.gsfc.nasa.gov/4518">2017 Solar Eclipse</a> and create a map with a topographic map.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> contextily <span class="im">as</span> cx</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>data_pkg_path <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>folder <span class="op">=</span> <span class="st">&#39;eclipse&#39;</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>upath_file <span class="op">=</span> os.path.join(data_pkg_path, folder, <span class="st">&#39;upath17.shp&#39;</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>path_gdf <span class="op">=</span> gpd.read_file(upath_file)</span></code></pre></div>
<p>We can show the GeoDataFrame using the <code>plot()</code> method.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">15</span>,<span class="dv">7</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>path_gdf.plot(ax<span class="op">=</span>ax)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>The visualization is not useful as it is missing context. We want to overlay this on a basemap to understand where the eclipse was visible from. We can choose from a variety of basemap tiles. There are over 200 basemap styles included in the library. Let’s see them using the <code>providers</code> property.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>providers <span class="op">=</span> cx.providers</span></code></pre></div>
<p>For overlaying the eclipse path, let’s use the <em>OpenTopoMap</em> basemap. We need to specify a CRS for the map. For now, let’s use the CRS of the original shapefile.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">15</span>,<span class="dv">7</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>path_gdf.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">&#39;#cccccc&#39;</span>, edgecolor<span class="op">=</span><span class="st">&#39;#969696&#39;</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>cx.add_basemap(ax, crs<span class="op">=</span>path_gdf.crs, source<span class="op">=</span>cx.providers.OpenTopoMap)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>The web tiles for the basemap are in the Web Mercator CRS (EPSG:3857). When you request them in a different CRS, they are warped to the requested CRS. This may cause the labels to not be legible in some cases. Instead, we can request the tiles in their original CRS and reproject our data layer to its CRS.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>path_reprojected <span class="op">=</span> path_gdf.to_crs(<span class="st">&#39;epsg:3857&#39;</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">15</span>,<span class="dv">7</span>)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>path_reprojected.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">&#39;#cccccc&#39;</span>, edgecolor<span class="op">=</span><span class="st">&#39;#969696&#39;</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>cx.add_basemap(ax, crs<span class="op">=</span>path_reprojected.crs, source<span class="op">=</span>cx.providers.OpenTopoMap)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;2017 Total Solar Eclipse Path&#39;</span>, size <span class="op">=</span> <span class="dv">18</span>)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>output_folder <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(output_folder, <span class="st">&#39;eclipse_path.png&#39;</span>)</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>plt.savefig(output_path, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div id="exercise-3" class="section level2">
<h2>Exercise</h2>
<p>Instead of the OpenTopoMap, create a visualization using the <em>Toner</em> basemap from <em>Stamen</em>.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">15</span>,<span class="dv">7</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>path_gdf.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">&#39;#cccccc&#39;</span>, edgecolor<span class="op">=</span><span class="st">&#39;#969696&#39;</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>cx.add_basemap(ax, crs<span class="op">=</span>path_gdf.crs, source<span class="op">=</span>cx.providers.OpenTopoMap)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<hr />
<p>Open the notebook named <code>06_visualizing_rasters.ipynb</code>.</p>
<hr />
</div>
</div>
<div id="visualizing-rasters" class="section level1">
<h1>Visualizing Rasters</h1>
<p><a href="http://xarray.pydata.org/">Xarray</a> is an evolution of rasterio and is inspired by libraries like pandas to work with raster datasets. It is particularly suited for working with multi-dimensional time-series raster datasets. It also integrates tightly with <a href="https://dask.org/">dask</a> that allows one to scale raster data processing using parallel computing.</p>
<p><a href="https://corteva.github.io/rioxarray/stable/index.html">rioxarray</a> is an extension of xarray that makes it easy to work with geospatial rasters. You can install the <code>rioxarray</code> package from the <code>conda-forge</code> channel.</p>
<p>This notebook shows how we can replicate the analysis from the <a href="#working-with-rasterio">Working with RasterIO</a> exercise and also covers raster data visualization using <code>matplotlib</code>.</p>
<div id="xarray-and-rioxarray-basics" class="section level3">
<h3>XArray and rioxarray Basics</h3>
<p>We start by reading a single SRTM tile containing elevation values.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>data_pkg_path <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>srtm_dir <span class="op">=</span> <span class="st">&#39;srtm&#39;</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">&#39;N28E087.hgt&#39;</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> os.path.join(data_pkg_path, srtm_dir, filename)</span></code></pre></div>
<p>By convention, <code>rioxarray</code> is imported as <code>rxr</code></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray <span class="im">as</span> rxr</span></code></pre></div>
<p>The <code>open_rasterio()</code> method is able to read any data source supported by <code>rasterio</code> library.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>rds <span class="op">=</span> rxr.open_rasterio(path)</span></code></pre></div>
<p>The result is a <code>xarray.DataArray</code> object.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(rds)</span></code></pre></div>
<p>You can access the pixel values using the <code>values</code> property which returns the array’s data as a numpy array.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>rds.values</span></code></pre></div>
<p>A <code>xarray.DataArray</code> object also contains 1 or more <code>coordinates</code>. Each coordinate is a 1-dimensional array representing values along one of the data axes. In case of the 1-band SRTM elevation data, we have 3 coordinates - <code>x</code>, <code>y</code> and <code>band</code>.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>rds.coords</span></code></pre></div>
<p>A key feature of <code>xarray</code> is the ability to access slices of the dataset using <a href="http://xarray.pydata.org/en/stable/user-guide/indexing.html">index lookup</a> methods. For example, we can slice the main dataset and get the data for Band1 using the <code>sel()</code> method.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>band1 <span class="op">=</span> rds.sel(band<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
<p>The raster metadata is stored in the <a href="https://corteva.github.io/rioxarray/stable/rioxarray.html#rioxarray-rio-accessors"><code>rio</code></a> accessor. This is enabled by the <code>rioxarray</code> library which provides geospatial functions on top of <code>xarray</code>.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;CRS:&#39;</span>, rds.rio.crs)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Resolution:&#39;</span>, rds.rio.resolution())</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Bounds:&#39;</span>, rds.rio.bounds())</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Width:&#39;</span>, rds.rio.width)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Height:&#39;</span>, rds.rio.height)</span></code></pre></div>
</div>
<div id="merging-rasters" class="section level3">
<h3>Merging Rasters</h3>
<p>Now that you understand the basic data structure of <em>xarray</em> and the &amp;rio* extension, let’s use it to process some data. We will take 4 individual SRTM tiles and merge them to a single GeoTiff. You will note that <code>rioxarray</code> handles the CRS and transform much better - taking care of internal details and providing a simple API.</p>
<blockquote>
<p>Remember to always import <code>rioxarray</code> even if you are using sub-modules. Importing <code>rioxarray</code> activates the <code>rio</code> accessor which is required for all operations.</p>
</blockquote>
<div class="sourceCode" id="cb64"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray <span class="im">as</span> rxr</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rioxarray.merge <span class="im">import</span> merge_arrays</span></code></pre></div>
<p>Define input and output paths.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>srtm_path <span class="op">=</span> os.path.join(data_pkg_path, <span class="st">&#39;srtm&#39;</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>all_files <span class="op">=</span> os.listdir(srtm_path)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>output_filename <span class="op">=</span> <span class="st">&#39;merged.tif&#39;</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(output_dir, output_filename)</span></code></pre></div>
<p>Open each source file using <code>open_rasterio()</code> method and store the resulting datasets in a list.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>datasets <span class="op">=</span> []</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> all_files:</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    path <span class="op">=</span> os.path.join(srtm_path, <span class="bu">file</span>)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    datasets.append(rxr.open_rasterio(path))</span></code></pre></div>
<p>Use the <code>merge_arrays()</code> method from the <code>rioxarray.merge</code> module to merge the rasters.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>merged <span class="op">=</span> merge_arrays(datasets)</span></code></pre></div>
<p>Finally, save the merged array to disk as a GeoTiff file.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>merged.rio.to_raster(output_path)</span></code></pre></div>
</div>
<div id="visualizing-rasters-using-matplotlib" class="section level3">
<h3>Visualizing Rasters using Matplotlib</h3>
<p><code>xarray</code> plotting functionality is built on top of the the popular <code>matplotlib</code> library.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code></pre></div>
<p>You cna visualize any <code>DataArray</code> object by calling <code>plot()</code> method. Here we create a row of 4 plots and render each of the source SRTM rasters. We can use the <code>cmap</code> option to specify a color ramp. Here we are using the built-in <em>Greys</em> ramp. Appending **_r** gives us the inverted ramp with blacks representing lower elevation values.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">15</span>,<span class="dv">3</span>)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, dataset <span class="kw">in</span> <span class="bu">enumerate</span>(datasets):</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axes[index]</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>    dataset.plot(ax<span class="op">=</span>ax, cmap<span class="op">=</span><span class="st">&#39;Greys_r&#39;</span>)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>    ax.axis(<span class="st">&#39;off&#39;</span>)</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>    filename <span class="op">=</span> all_files[index]</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>    ax.set_title(filename)</span></code></pre></div>
<p>Similarly, we can visualize the merged raster.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">12</span>, <span class="dv">10</span>)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>merged.plot(ax<span class="op">=</span>ax, cmap<span class="op">=</span><span class="st">&#39;Greys_r&#39;</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">&#39;merged&#39;</span>)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="sourceCode" id="cb72"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>merged</span></code></pre></div>
<div class="sourceCode" id="cb73"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>bands, rows, cols <span class="op">=</span> np.where(merged <span class="op">==</span> np.<span class="bu">max</span>(merged))</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>band <span class="op">=</span> bands[<span class="dv">0</span>]</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>row <span class="op">=</span> rows[<span class="dv">0</span>]</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>col <span class="op">=</span> cols[<span class="dv">0</span>]</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(band, row, col)</span></code></pre></div>
<div class="sourceCode" id="cb74"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> merged.isel(band<span class="op">=</span>band, x<span class="op">=</span>col, y<span class="op">=</span>row)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>lat <span class="op">=</span> result.y.values</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>lon <span class="op">=</span> result.x.values</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>elevation <span class="op">=</span> <span class="bu">int</span>(result)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lat, lon, elevation)</span></code></pre></div>
<div class="sourceCode" id="cb75"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">12</span>, <span class="dv">12</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>merged.plot(ax<span class="op">=</span>ax, cmap<span class="op">=</span><span class="st">&#39;viridis&#39;</span>)</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>ax.plot(lon, lat, <span class="st">&#39;^r&#39;</span>, markersize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>ax.annotate(<span class="st">&#39;Mt. Everest (elevation:</span><span class="sc">{}</span><span class="st">m)&#39;</span>.<span class="bu">format</span>(elevation),</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>            xy<span class="op">=</span>(lon, lat), xycoords<span class="op">=</span><span class="st">&#39;data&#39;</span>,</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>            xytext<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">20</span>), textcoords<span class="op">=</span><span class="st">&#39;offset points&#39;</span>,</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>            arrowprops<span class="op">=</span><span class="bu">dict</span>(arrowstyle<span class="op">=</span><span class="st">&#39;-&gt;&#39;</span>, color<span class="op">=</span><span class="st">&#39;black&#39;</span>)</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>output_folder <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(output_folder, <span class="st">&#39;mt_everest.png&#39;</span>)</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>plt.savefig(output_path, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<hr />
<p>Open the notebook named <code>07_mapping_gridded_datasets.ipynb</code>.</p>
<hr />
</div>
</div>
<div id="mapping-gridded-datasets" class="section level1">
<h1>Mapping Gridded Datasets</h1>
<p>Many climate and meteorological datasets come as gridded rasters in data formats such as NetCDF and GRIB. XArray provides <a href="https://xarray.pydata.org/en/stable/user-guide/plotting.html">Plotting Functions</a> based on Matplotlib.</p>
<p>In this section, we will take the <a href="https://data.giss.nasa.gov/gistemp/">Gridded Monthly Temperature Anomaly Data</a> from 1880-2020 from GISTEMP and visualize the temperature anomaly for the year 2021.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cartopy</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cartopy.crs <span class="im">as</span> ccrs</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span></code></pre></div>
<div class="sourceCode" id="cb77"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>data_pkg_path <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> os.path.join(data_pkg_path, <span class="st">&#39;gistemp&#39;</span>,<span class="st">&#39;gistemp1200_GHCNv4_ERSSTv5.nc&#39;</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>ds <span class="op">=</span> xr.open_dataset(file_path)</span></code></pre></div>
<p>The NetCDF file contains a grid of values for each month from 1880-2020. The <code>time</code> dimension has a length of 1704.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>ds</span></code></pre></div>
<p>We can aggregate the data to yearly time-steps using the <code>resample()</code> method, reducing the <code>time</code> dimension.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>yearly <span class="op">=</span> ds.resample(time<span class="op">=</span><span class="st">&#39;Y&#39;</span>).mean()</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>yearly</span></code></pre></div>
<p>We extract the <code>tempanomaly</code> variable and use the indexing method <code>isel()</code> to extract the latest time slice.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>anomaly <span class="op">=</span> yearly[<span class="st">&#39;tempanomaly&#39;</span>]</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>anomaly2021 <span class="op">=</span> anomaly.isel(time<span class="op">=-</span><span class="dv">1</span>)</span></code></pre></div>
<p>We can now plot this data using the <code>imshow()</code> method from xarray.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xarray.plot <span class="im">import</span> imshow</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>imshow(anomaly2021)</span></code></pre></div>
<p>To create more informative map visualization, we need to reproject this grid to another projection. CartoPy supports a wide range of projections and can plot them using matplotlib. CartoPy creates a <a href="https://scitools.org.uk/cartopy/docs/latest/reference/generated/cartopy.mpl.geoaxes.GeoAxes.html">GeoAxes</a> object and replaces the default <code>Axes</code> with it. This allows you to plot the data on a specified projection.</p>
<p>Reference: <a href="https://scitools.org.uk/cartopy/docs/latest/reference/crs.html?highlight=list#list-of-projections">CartoPy List of Projections</a></p>
<div class="sourceCode" id="cb82"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.axes(projection<span class="op">=</span>ccrs.Orthographic(<span class="dv">0</span>, <span class="dv">40</span>))</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>ax.coastlines()</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.gcf()</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">5</span>,<span class="dv">5</span>)</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>We can create a GeoAxes with a custom Orthographic projection and plot the temperature anomaly data on it. The <code>transform</code> argument specifies the CRS of the original dataset.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.axes(projection<span class="op">=</span>ccrs.Orthographic(<span class="dv">0</span>, <span class="dv">30</span>))</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>ax.coastlines()</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>anomaly2021.plot.imshow(ax<span class="op">=</span>ax,</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>    vmin<span class="op">=-</span><span class="dv">4</span>, vmax<span class="op">=</span><span class="dv">4</span>, cmap<span class="op">=</span><span class="st">&#39;coolwarm&#39;</span>,</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>    transform<span class="op">=</span>ccrs.PlateCarree())</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.gcf()</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">5</span>,<span class="dv">5</span>)</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>We can further customize the map by adjusting the colorbar.</p>
<p>Reference: <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.colorbar.html">matplotlib.pyplot.colorbar</a></p>
<div class="sourceCode" id="cb84"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>cbar_kwargs <span class="op">=</span> {</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;orientation&#39;</span>:<span class="st">&#39;horizontal&#39;</span>,</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;location&#39;</span>: <span class="st">&#39;bottom&#39;</span>,</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;fraction&#39;</span>: <span class="fl">0.025</span>,</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;pad&#39;</span>: <span class="fl">0.05</span>,</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;extend&#39;</span>:<span class="st">&#39;neither&#39;</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.axes(projection<span class="op">=</span>ccrs.Orthographic(<span class="dv">0</span>, <span class="dv">30</span>))</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>ax.coastlines()</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>anomaly2021.plot.imshow(</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>    vmin<span class="op">=-</span><span class="dv">4</span>, vmax<span class="op">=</span><span class="dv">4</span>, cmap<span class="op">=</span><span class="st">&#39;coolwarm&#39;</span>,</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>    transform<span class="op">=</span>ccrs.PlateCarree(),</span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>    add_labels<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>    cbar_kwargs<span class="op">=</span>cbar_kwargs)</span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.gcf()</span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">10</span>,<span class="dv">10</span>)</span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Temprature Anomaly in 2021 (°C)&#39;</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a>output_folder <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(output_folder, <span class="st">&#39;anomaly.jpg&#39;</span>)</span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a>plt.savefig(output_path, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div id="exercise-4" class="section level2">
<h2>Exercise</h2>
<p>Display the map in an Equal Earth projection.</p>
<hr />
<p>Open the notebook named <code>08_interactive_maps_folium.ipynb</code>.</p>
<hr />
</div>
</div>
<div id="creating-interactive-maps-with-folium" class="section level1">
<h1>Creating Interactive Maps with Folium</h1>
<p><a href="https://python-visualization.github.io/folium/">Folium</a> is a Python library that allows you to create interactive maps based on the popular <a href="https://leafletjs.com/">Leaflet</a> javascript library.</p>
<p>In this section, we will learn how to create an interactive map showing driving directions between two locations.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium</span></code></pre></div>
<div class="sourceCode" id="cb86"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>san_francisco <span class="op">=</span> (<span class="fl">37.7749</span>, <span class="op">-</span><span class="fl">122.4194</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>new_york <span class="op">=</span> (<span class="fl">40.661</span>, <span class="op">-</span><span class="fl">73.944</span>)</span></code></pre></div>
<div class="sourceCode" id="cb87"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> folium.Map()</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<div class="sourceCode" id="cb88"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> folium.Map(location<span class="op">=</span>[<span class="fl">39.83</span>, <span class="op">-</span><span class="fl">98.58</span>], zoom_start<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<div class="sourceCode" id="cb89"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>folium.Marker(san_francisco, popup<span class="op">=</span><span class="st">&#39;San Francisco&#39;</span>).add_to(m)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>folium.Marker(new_york, popup<span class="op">=</span><span class="st">&#39;New York&#39;</span>).add_to(m)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<ul>
<li><a href="https://python-visualization.github.io/folium/modules.html#folium.map.Marker">folium.map.Marker</a></li>
<li><a href="https://python-visualization.github.io/folium/modules.html#folium.map.Icon">folium.map.Icon</a></li>
<li><a href="https://fontawesome.com/search?m=free&amp;c=maps">fontawesome icons</a></li>
<li><a href="https://getbootstrap.com/docs/3.3/components/">bootstrap icons</a></li>
</ul>
<div class="sourceCode" id="cb90"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> folium.Map(location<span class="op">=</span>[<span class="fl">39.83</span>, <span class="op">-</span><span class="fl">98.58</span>], zoom_start<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>folium.Marker(san_francisco, popup<span class="op">=</span><span class="st">&#39;San Francisco&#39;</span>,</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>              icon<span class="op">=</span>folium.Icon(</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>                  color<span class="op">=</span><span class="st">&#39;green&#39;</span>, icon<span class="op">=</span><span class="st">&#39;crosshairs&#39;</span>, prefix<span class="op">=</span><span class="st">&#39;fa&#39;</span>)</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>             ).add_to(m)</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>folium.Marker(new_york, popup<span class="op">=</span><span class="st">&#39;New York&#39;</span>, </span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>              icon<span class="op">=</span>folium.Icon(color<span class="op">=</span><span class="st">&#39;red&#39;</span>, icon<span class="op">=</span><span class="st">&#39;crosshairs&#39;</span>, prefix<span class="op">=</span><span class="st">&#39;fa&#39;</span>)</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>             ).add_to(m)</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<p>Enter your API key in the followig variable. The API key is obtained from the <a href="https://openrouteservice.org/dev/#/home">OpenRouteService Dashboard</a></p>
<div class="sourceCode" id="cb91"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>ORS_API_KEY <span class="op">=</span> <span class="st">&#39;&#39;</span></span></code></pre></div>
<p>While running this notebook in production, we load the <code>ORS_API_KEY</code> from a <code>.env</code> file in the local environment. &gt; Users of this notebook can skip running this cell.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> ORS_API_KEY:</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> dotenv <span class="im">import</span> dotenv_values</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>    config <span class="op">=</span> dotenv_values(<span class="st">&#39;.env&#39;</span>)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>    ORS_API_KEY <span class="op">=</span> config[<span class="st">&#39;ORS_API_KEY&#39;</span>]</span></code></pre></div>
<div class="sourceCode" id="cb93"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>san_francisco <span class="op">=</span> (<span class="fl">37.7749</span>, <span class="op">-</span><span class="fl">122.4194</span>)</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>new_york <span class="op">=</span> (<span class="fl">40.661</span>, <span class="op">-</span><span class="fl">73.944</span>)</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">=</span> {</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;api_key&#39;</span>: ORS_API_KEY,</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;start&#39;</span> : <span class="st">&#39;</span><span class="sc">{}</span><span class="st">,</span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(san_francisco[<span class="dv">1</span>], san_francisco[<span class="dv">0</span>]),</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;end&#39;</span> : <span class="st">&#39;</span><span class="sc">{}</span><span class="st">,</span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(new_york[<span class="dv">1</span>], new_york[<span class="dv">0</span>])</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;https://api.openrouteservice.org/v2/directions/driving-car&#39;</span>, params<span class="op">=</span>parameters)</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;Request successful.&#39;</span>)</span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> response.json()</span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;Request failed.&#39;</span>)</span></code></pre></div>
<p>Extract the coordinates for the driving directions.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>route<span class="op">=</span> data[<span class="st">&#39;features&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;geometry&#39;</span>][<span class="st">&#39;coordinates&#39;</span>]</span></code></pre></div>
<div class="sourceCode" id="cb95"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>route[:<span class="dv">5</span>]</span></code></pre></div>
<p>The coordinates returned by OpenRouteService API is in the order [X,Y] (i.e. [Longitude, Latitude]) whereas Folium requires the coordinates in [Y,X] (i.e. [Latitude, Longitude]) order. We can swap them before plotting.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>route_xy <span class="op">=</span> []</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x, y <span class="kw">in</span> route:</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>    route_xy.append((y,x))</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>route_xy[:<span class="dv">5</span>]</span></code></pre></div>
<p>An easier way to accomplish the same is by using a Python <a href="https://www.w3schools.com/python/python_lists_comprehension.asp">List Comprehension</a>.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>route_xy <span class="op">=</span> [(y, x) <span class="cf">for</span> x, y <span class="kw">in</span> route]</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>route_xy[:<span class="dv">5</span>]</span></code></pre></div>
<div class="sourceCode" id="cb98"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>summary <span class="op">=</span> data[<span class="st">&#39;features&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;properties&#39;</span>][<span class="st">&#39;summary&#39;</span>]</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>distance <span class="op">=</span> <span class="bu">round</span>(summary[<span class="st">&#39;distance&#39;</span>]<span class="op">/</span><span class="dv">1000</span>)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>tooltip <span class="op">=</span> <span class="st">&#39;Driving Distance: </span><span class="sc">{}</span><span class="st">km&#39;</span>.<span class="bu">format</span>(distance)</span></code></pre></div>
<div class="sourceCode" id="cb99"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> folium.Map(location<span class="op">=</span>[<span class="fl">39.83</span>, <span class="op">-</span><span class="fl">98.58</span>], zoom_start<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>folium.Marker(san_francisco, popup<span class="op">=</span><span class="st">&#39;San Francisco&#39;</span>,</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>              icon<span class="op">=</span>folium.Icon(</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>                  color<span class="op">=</span><span class="st">&#39;green&#39;</span>, icon<span class="op">=</span><span class="st">&#39;crosshairs&#39;</span>, prefix<span class="op">=</span><span class="st">&#39;fa&#39;</span>)</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>             ).add_to(m)</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>folium.Marker(new_york, popup<span class="op">=</span><span class="st">&#39;New York&#39;</span>, </span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>              icon<span class="op">=</span>folium.Icon(color<span class="op">=</span><span class="st">&#39;red&#39;</span>, icon<span class="op">=</span><span class="st">&#39;crosshairs&#39;</span>, prefix<span class="op">=</span><span class="st">&#39;fa&#39;</span>)</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>             ).add_to(m)</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>folium.PolyLine(route_xy, tooltip<span class="op">=</span>tooltip).add_to(m)</span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<div class="sourceCode" id="cb100"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>output_folder <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(output_folder):</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>    os.mkdir(output_folder)</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(output_folder, <span class="st">&#39;directions.html&#39;</span>)</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>m.save(output_path)</span></code></pre></div>
<div id="exercise-5" class="section level2">
<h2>Exercise</h2>
<p>Below is the complete code to create an interactive map with the driving directions between two cities. Replace the origin and destination with your chosen cities and create an interactive map.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>origin <span class="op">=</span> (<span class="fl">37.7749</span>, <span class="op">-</span><span class="fl">122.4194</span>)</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>origin_name <span class="op">=</span> <span class="st">&#39;San Francisco&#39;</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>destination <span class="op">=</span> (<span class="fl">40.661</span>, <span class="op">-</span><span class="fl">73.944</span>)</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>destination_name <span class="op">=</span> <span class="st">&#39;New York&#39;</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>ORS_API_KEY <span class="op">=</span> <span class="st">&#39;5b3ce3597851110001cf6248ed43ece522584866b5deb4ac3732a19f&#39;</span></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">=</span> {</span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;api_key&#39;</span>: ORS_API_KEY,</span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;start&#39;</span> : <span class="st">&#39;</span><span class="sc">{}</span><span class="st">,</span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(origin[<span class="dv">1</span>], origin[<span class="dv">0</span>]),</span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;end&#39;</span> : <span class="st">&#39;</span><span class="sc">{}</span><span class="st">,</span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(destination[<span class="dv">1</span>], destination[<span class="dv">0</span>])</span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(</span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;https://api.openrouteservice.org/v2/directions/driving-car&#39;</span>, params<span class="op">=</span>parameters)</span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;Request successful.&#39;</span>)</span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> response.json()</span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb101-24"><a href="#cb101-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;Request failed.&#39;</span>)</span>
<span id="cb101-25"><a href="#cb101-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-26"><a href="#cb101-26" aria-hidden="true" tabindex="-1"></a>route<span class="op">=</span> data[<span class="st">&#39;features&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;geometry&#39;</span>][<span class="st">&#39;coordinates&#39;</span>]</span>
<span id="cb101-27"><a href="#cb101-27" aria-hidden="true" tabindex="-1"></a>summary <span class="op">=</span> data[<span class="st">&#39;features&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;properties&#39;</span>][<span class="st">&#39;summary&#39;</span>]</span>
<span id="cb101-28"><a href="#cb101-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-29"><a href="#cb101-29" aria-hidden="true" tabindex="-1"></a>route_xy <span class="op">=</span> [(y, x) <span class="cf">for</span> x, y <span class="kw">in</span> route]</span>
<span id="cb101-30"><a href="#cb101-30" aria-hidden="true" tabindex="-1"></a>distance <span class="op">=</span> <span class="bu">round</span>(summary[<span class="st">&#39;distance&#39;</span>]<span class="op">/</span><span class="dv">1000</span>)</span>
<span id="cb101-31"><a href="#cb101-31" aria-hidden="true" tabindex="-1"></a>tooltip <span class="op">=</span> <span class="st">&#39;Driving Distance: </span><span class="sc">{}</span><span class="st">km&#39;</span>.<span class="bu">format</span>(distance)</span>
<span id="cb101-32"><a href="#cb101-32" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> folium.Map(location<span class="op">=</span>[<span class="fl">39.83</span>, <span class="op">-</span><span class="fl">98.58</span>], zoom_start<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb101-33"><a href="#cb101-33" aria-hidden="true" tabindex="-1"></a>folium.Marker(origin, popup<span class="op">=</span>origin_name,</span>
<span id="cb101-34"><a href="#cb101-34" aria-hidden="true" tabindex="-1"></a>              icon<span class="op">=</span>folium.Icon(</span>
<span id="cb101-35"><a href="#cb101-35" aria-hidden="true" tabindex="-1"></a>                  color<span class="op">=</span><span class="st">&#39;green&#39;</span>, icon<span class="op">=</span><span class="st">&#39;crosshairs&#39;</span>, prefix<span class="op">=</span><span class="st">&#39;fa&#39;</span>)</span>
<span id="cb101-36"><a href="#cb101-36" aria-hidden="true" tabindex="-1"></a>             ).add_to(m)</span>
<span id="cb101-37"><a href="#cb101-37" aria-hidden="true" tabindex="-1"></a>folium.Marker(destination, popup<span class="op">=</span>destination_name, </span>
<span id="cb101-38"><a href="#cb101-38" aria-hidden="true" tabindex="-1"></a>              icon<span class="op">=</span>folium.Icon(color<span class="op">=</span><span class="st">&#39;red&#39;</span>, icon<span class="op">=</span><span class="st">&#39;crosshairs&#39;</span>, prefix<span class="op">=</span><span class="st">&#39;fa&#39;</span>)</span>
<span id="cb101-39"><a href="#cb101-39" aria-hidden="true" tabindex="-1"></a>             ).add_to(m)</span>
<span id="cb101-40"><a href="#cb101-40" aria-hidden="true" tabindex="-1"></a>folium.PolyLine(route_xy, tooltip<span class="op">=</span>tooltip).add_to(m)</span>
<span id="cb101-41"><a href="#cb101-41" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<hr />
<hr />
<p>Open the notebook named <code>09_multilayer_maps.ipynb</code>.</p>
<hr />
</div>
</div>
<div id="creating-multi-layer-interactive-maps" class="section level1">
<h1>Creating Multi-layer Interactive Maps</h1>
<p><a href="https://python-visualization.github.io/folium/">Folium</a> supports creating maps with multiple layers. Recent versions of GeoPandas have built-in support to create interactive folium maps from a GeoDataFrame.</p>
<p>In this section, we will create a multi-layer interactive map using 2 vector datasets.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span></code></pre></div>
<div class="sourceCode" id="cb103"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>data_pkg_path <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">&#39;karnataka.gpkg&#39;</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> os.path.join(data_pkg_path, <span class="st">&#39;roads&#39;</span>, filename)</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>roads_gdf <span class="op">=</span> gpd.read_file(path, layer<span class="op">=</span><span class="st">&#39;karnataka_major_roads&#39;</span>)</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>districts_gdf <span class="op">=</span> gpd.read_file(path, layer<span class="op">=</span><span class="st">&#39;karnataka_districts&#39;</span>)</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>state_gdf <span class="op">=</span> gpd.read_file(path, layer<span class="op">=</span><span class="st">&#39;karnataka&#39;</span>)</span></code></pre></div>
<p>We can use the <a href="https://geopandas.org/en/stable/docs/reference/api/geopandas.GeoDataFrame.explore.html">explore()</a> method to create an interactive folium map from the GeoDataFrame.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>districts_gdf.explore()</span></code></pre></div>
<div class="sourceCode" id="cb105"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>districts_gdf.explore(</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">&#39;black&#39;</span>, </span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>    style_kwds<span class="op">=</span>{<span class="st">&#39;fillOpacity&#39;</span>: <span class="fl">0.3</span>, <span class="st">&#39;weight&#39;</span>: <span class="fl">0.5</span>},</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>    tiles<span class="op">=</span><span class="st">&#39;Stamen Terrain&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb106"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>roads_gdf</span></code></pre></div>
<div class="sourceCode" id="cb107"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_category(row):</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>    ref <span class="op">=</span> <span class="bu">str</span>(row[<span class="st">&#39;ref&#39;</span>])</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">&#39;NH&#39;</span> <span class="kw">in</span> ref:</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;NH&#39;</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="st">&#39;SH&#39;</span> <span class="kw">in</span> ref:</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;SH&#39;</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;NA&#39;</span></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>roads_gdf[<span class="st">&#39;category&#39;</span>] <span class="op">=</span> roads_gdf.<span class="bu">apply</span>(get_category, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>roads_gdf</span></code></pre></div>
<div class="sourceCode" id="cb108"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>filtered <span class="op">=</span> roads_gdf[roads_gdf[<span class="st">&#39;category&#39;</span>].isin([<span class="st">&#39;NH&#39;</span>, <span class="st">&#39;SH&#39;</span>])]</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>filtered</span></code></pre></div>
<div class="sourceCode" id="cb109"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>filtered.explore(</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>    column<span class="op">=</span><span class="st">&#39;category&#39;</span>, </span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>    categories<span class="op">=</span>[<span class="st">&#39;NH&#39;</span>, <span class="st">&#39;SH&#39;</span>], </span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span>[<span class="st">&#39;#1f78b4&#39;</span>, <span class="st">&#39;#e31a1c&#39;</span>],</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>    categorical<span class="op">=</span><span class="va">True</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>You can have fine-grained control over how each feature is styled on the map. The <code>explore()</code> function takes a <code>style_function</code> parameter where you can specify a function that returns style properties using any of the supported parameters. The function is passed on each feature as a GeoJSON object and you can use any columns values to create your style.</p>
<p>The function below will stlye all features of ‘NH’ category with thicker lines.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> style(feature):</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> feature[<span class="st">&#39;properties&#39;</span>][<span class="st">&#39;category&#39;</span>] <span class="op">==</span> <span class="st">&#39;NH&#39;</span>:</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">&#39;weight&#39;</span>: <span class="dv">2</span>}</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">&#39;weight&#39;</span>: <span class="fl">0.5</span>}</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>filtered.explore(</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>    column<span class="op">=</span><span class="st">&#39;category&#39;</span>, </span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>    categories<span class="op">=</span>[<span class="st">&#39;NH&#39;</span>, <span class="st">&#39;SH&#39;</span>], </span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span>[<span class="st">&#39;#1f78b4&#39;</span>, <span class="st">&#39;#e31a1c&#39;</span>],</span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>    categorical<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>    style_kwds<span class="op">=</span>{<span class="st">&#39;style_function&#39;</span>:style}</span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>When you call <code>explore()</code> a folium object is created. You can save that object and add more layers to the same object.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> districts_gdf.explore(</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">&#39;black&#39;</span>, </span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>    style_kwds<span class="op">=</span>{<span class="st">&#39;fillOpacity&#39;</span>: <span class="fl">0.3</span>, <span class="st">&#39;weight&#39;</span>:<span class="fl">0.5</span>},</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">&#39;districts&#39;</span>,</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>    tiles<span class="op">=</span><span class="st">&#39;Stamen Terrain&#39;</span>)</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> style(feature):</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> feature[<span class="st">&#39;properties&#39;</span>][<span class="st">&#39;category&#39;</span>] <span class="op">==</span> <span class="st">&#39;NH&#39;</span>:</span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">&#39;weight&#39;</span>: <span class="dv">2</span>}</span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">&#39;weight&#39;</span>: <span class="fl">0.5</span>}</span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a>filtered.explore(</span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a>    m<span class="op">=</span>m,</span>
<span id="cb111-17"><a href="#cb111-17" aria-hidden="true" tabindex="-1"></a>    column<span class="op">=</span><span class="st">&#39;category&#39;</span>, </span>
<span id="cb111-18"><a href="#cb111-18" aria-hidden="true" tabindex="-1"></a>    categories<span class="op">=</span>[<span class="st">&#39;NH&#39;</span>, <span class="st">&#39;SH&#39;</span>], </span>
<span id="cb111-19"><a href="#cb111-19" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span>[<span class="st">&#39;#1f78b4&#39;</span>, <span class="st">&#39;#e31a1c&#39;</span>],</span>
<span id="cb111-20"><a href="#cb111-20" aria-hidden="true" tabindex="-1"></a>    categorical<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb111-21"><a href="#cb111-21" aria-hidden="true" tabindex="-1"></a>    style_kwds<span class="op">=</span>{<span class="st">&#39;style_function&#39;</span>:style}</span>
<span id="cb111-22"><a href="#cb111-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb111-23"><a href="#cb111-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-24"><a href="#cb111-24" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<p>To make our map easier to explore, we also add a <em>Layer Control</em> that displays the list of layers on the top-right corner and also allows the users to turn them on or off. We need to add the <code>name</code> parameter to the <code>explore()</code> function with the name that will be displayed in the layer control.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> districts_gdf.explore(</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">&#39;black&#39;</span>, </span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>    style_kwds<span class="op">=</span>{<span class="st">&#39;fillOpacity&#39;</span>: <span class="fl">0.3</span>, <span class="st">&#39;weight&#39;</span>:<span class="fl">0.5</span>},</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>    tiles<span class="op">=</span><span class="st">&#39;Stamen Terrain&#39;</span>,</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">&#39;Districts&#39;</span>)</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> style(feature):</span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> feature[<span class="st">&#39;properties&#39;</span>][<span class="st">&#39;category&#39;</span>] <span class="op">==</span> <span class="st">&#39;NH&#39;</span>:</span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">&#39;weight&#39;</span>: <span class="dv">2</span>}</span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">&#39;weight&#39;</span>: <span class="fl">0.5</span>}</span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a>filtered.explore(</span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a>    m<span class="op">=</span>m,</span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a>    column<span class="op">=</span><span class="st">&#39;category&#39;</span>, </span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a>    categories<span class="op">=</span>[<span class="st">&#39;NH&#39;</span>, <span class="st">&#39;SH&#39;</span>], </span>
<span id="cb112-19"><a href="#cb112-19" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span>[<span class="st">&#39;#1f78b4&#39;</span>, <span class="st">&#39;#e31a1c&#39;</span>],</span>
<span id="cb112-20"><a href="#cb112-20" aria-hidden="true" tabindex="-1"></a>    categorical<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb112-21"><a href="#cb112-21" aria-hidden="true" tabindex="-1"></a>    style_kwds<span class="op">=</span>{<span class="st">&#39;style_function&#39;</span>:style},</span>
<span id="cb112-22"><a href="#cb112-22" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">&#39;Highways&#39;</span>)</span>
<span id="cb112-23"><a href="#cb112-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-24"><a href="#cb112-24" aria-hidden="true" tabindex="-1"></a>folium.LayerControl().add_to(m)</span>
<span id="cb112-25"><a href="#cb112-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-26"><a href="#cb112-26" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<div id="exercise-6" class="section level2">
<h2>Exercise</h2>
<p>Add the <code>state_gdf</code> layer to the folium map below with a thick blue border and no fill. Save the resulting map as a HTML file on your computer.</p>
<p>Hint: Use the <code>style_kwds</code> with <em>‘fill’</em> and <em>‘weight’</em> options. </p>
</div>
</div>
<div id="supplement" class="section level1">
<h1>Supplement</h1>
<div id="elevation-profile-plot-from-a-gps-track" class="section level2">
<h2>Elevation Profile Plot from a GPS Track</h2>
<div class="sourceCode" id="cb113"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.dates <span class="im">as</span> mdates</span></code></pre></div>
<div class="sourceCode" id="cb114"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>data_pkg_path <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>gpx_path <span class="op">=</span> os.path.join(data_pkg_path, <span class="st">&#39;gps&#39;</span>, <span class="st">&#39;summit.gpx&#39;</span>)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="co"># GPX files contain many layers. Read the &#39;track_points&#39; layer</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gpd.read_file(gpx_path, layer<span class="op">=</span><span class="st">&#39;track_points&#39;</span>)</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gdf[[<span class="st">&#39;track_fid&#39;</span>,<span class="st">&#39;ele&#39;</span>, <span class="st">&#39;time&#39;</span>, <span class="st">&#39;geometry&#39;</span>]]</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>gdf</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
track_fid
</th>
<th>
ele
</th>
<th>
time
</th>
<th>
geometry
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
0
</td>
<td>
3187.3
</td>
<td>
2022-04-04 00:07:42+00:00
</td>
<td>
POINT (78.56758 30.82669)
</td>
</tr>
<tr>
<th>
1
</th>
<td>
0
</td>
<td>
3194.4
</td>
<td>
2022-04-04 00:07:54+00:00
</td>
<td>
POINT (78.56747 30.82667)
</td>
</tr>
<tr>
<th>
2
</th>
<td>
0
</td>
<td>
3196.6
</td>
<td>
2022-04-04 00:07:59+00:00
</td>
<td>
POINT (78.56743 30.82670)
</td>
</tr>
<tr>
<th>
3
</th>
<td>
0
</td>
<td>
3196.8
</td>
<td>
2022-04-04 00:08:04+00:00
</td>
<td>
POINT (78.56741 30.82671)
</td>
</tr>
<tr>
<th>
4
</th>
<td>
0
</td>
<td>
3198.2
</td>
<td>
2022-04-04 00:08:14+00:00
</td>
<td>
POINT (78.56739 30.82668)
</td>
</tr>
<tr>
<th>
…
</th>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
</tr>
<tr>
<th>
2305
</th>
<td>
0
</td>
<td>
3150.8
</td>
<td>
2022-04-04 06:05:58+00:00
</td>
<td>
POINT (78.56878 30.82703)
</td>
</tr>
<tr>
<th>
2306
</th>
<td>
0
</td>
<td>
3150.5
</td>
<td>
2022-04-04 06:06:01+00:00
</td>
<td>
POINT (78.56879 30.82704)
</td>
</tr>
<tr>
<th>
2307
</th>
<td>
0
</td>
<td>
3150.3
</td>
<td>
2022-04-04 06:06:06+00:00
</td>
<td>
POINT (78.56883 30.82707)
</td>
</tr>
<tr>
<th>
2308
</th>
<td>
0
</td>
<td>
3150.3
</td>
<td>
2022-04-04 06:06:11+00:00
</td>
<td>
POINT (78.56878 30.82710)
</td>
</tr>
<tr>
<th>
2309
</th>
<td>
0
</td>
<td>
3150.5
</td>
<td>
2022-04-04 06:06:16+00:00
</td>
<td>
POINT (78.56877 30.82709)
</td>
</tr>
</tbody>
</table>
<p>
2310 rows × 4 columns
</p>
</div>
<p>Let’s use the timestamp contained in the ‘time’ column as the index. This will allow us to filter and plot the time-series data easily. We must first convert the time column to datetime type with an appropriate timezone.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>gdf[<span class="st">&#39;time&#39;</span>] <span class="op">=</span> pd.to_datetime(gdf[<span class="st">&#39;time&#39;</span>])</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gdf.set_index(<span class="st">&#39;time&#39;</span>)</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>gdf.index <span class="op">=</span> gdf.index.tz_convert(<span class="st">&#39;Asia/Kolkata&#39;</span>)</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>gdf</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
track_fid
</th>
<th>
ele
</th>
<th>
geometry
</th>
</tr>
<tr>
<th>
time
</th>
<th>
</th>
<th>
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
2022-04-04 05:37:42+05:30
</th>
<td>
0
</td>
<td>
3187.3
</td>
<td>
POINT (78.56758 30.82669)
</td>
</tr>
<tr>
<th>
2022-04-04 05:37:54+05:30
</th>
<td>
0
</td>
<td>
3194.4
</td>
<td>
POINT (78.56747 30.82667)
</td>
</tr>
<tr>
<th>
2022-04-04 05:37:59+05:30
</th>
<td>
0
</td>
<td>
3196.6
</td>
<td>
POINT (78.56743 30.82670)
</td>
</tr>
<tr>
<th>
2022-04-04 05:38:04+05:30
</th>
<td>
0
</td>
<td>
3196.8
</td>
<td>
POINT (78.56741 30.82671)
</td>
</tr>
<tr>
<th>
2022-04-04 05:38:14+05:30
</th>
<td>
0
</td>
<td>
3198.2
</td>
<td>
POINT (78.56739 30.82668)
</td>
</tr>
<tr>
<th>
…
</th>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
</tr>
<tr>
<th>
2022-04-04 11:35:58+05:30
</th>
<td>
0
</td>
<td>
3150.8
</td>
<td>
POINT (78.56878 30.82703)
</td>
</tr>
<tr>
<th>
2022-04-04 11:36:01+05:30
</th>
<td>
0
</td>
<td>
3150.5
</td>
<td>
POINT (78.56879 30.82704)
</td>
</tr>
<tr>
<th>
2022-04-04 11:36:06+05:30
</th>
<td>
0
</td>
<td>
3150.3
</td>
<td>
POINT (78.56883 30.82707)
</td>
</tr>
<tr>
<th>
2022-04-04 11:36:11+05:30
</th>
<td>
0
</td>
<td>
3150.3
</td>
<td>
POINT (78.56878 30.82710)
</td>
</tr>
<tr>
<th>
2022-04-04 11:36:16+05:30
</th>
<td>
0
</td>
<td>
3150.5
</td>
<td>
POINT (78.56877 30.82709)
</td>
</tr>
</tbody>
</table>
<p>
2310 rows × 3 columns
</p>
</div>
<p>Using time as index allows us to filter the data as follows</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>gdf_subset <span class="op">=</span> gdf[<span class="st">&#39;2022-04-04T09:00:00&#39;</span>:<span class="st">&#39;2022-04-04T09:30:00&#39;</span>]</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>gdf_subset</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
track_fid
</th>
<th>
ele
</th>
<th>
geometry
</th>
</tr>
<tr>
<th>
time
</th>
<th>
</th>
<th>
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
2022-04-04 09:08:44+05:30
</th>
<td>
0
</td>
<td>
3626.1
</td>
<td>
POINT (78.54941 30.83630)
</td>
</tr>
<tr>
<th>
2022-04-04 09:10:01+05:30
</th>
<td>
0
</td>
<td>
3625.7
</td>
<td>
POINT (78.54940 30.83636)
</td>
</tr>
<tr>
<th>
2022-04-04 09:10:06+05:30
</th>
<td>
0
</td>
<td>
3625.7
</td>
<td>
POINT (78.54940 30.83636)
</td>
</tr>
<tr>
<th>
2022-04-04 09:11:25+05:30
</th>
<td>
0
</td>
<td>
3626.4
</td>
<td>
POINT (78.54939 30.83628)
</td>
</tr>
<tr>
<th>
2022-04-04 09:11:30+05:30
</th>
<td>
0
</td>
<td>
3626.4
</td>
<td>
POINT (78.54940 30.83629)
</td>
</tr>
<tr>
<th>
…
</th>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
</tr>
<tr>
<th>
2022-04-04 09:29:38+05:30
</th>
<td>
0
</td>
<td>
3539.5
</td>
<td>
POINT (78.55257 30.83533)
</td>
</tr>
<tr>
<th>
2022-04-04 09:29:41+05:30
</th>
<td>
0
</td>
<td>
3539.9
</td>
<td>
POINT (78.55259 30.83532)
</td>
</tr>
<tr>
<th>
2022-04-04 09:29:46+05:30
</th>
<td>
0
</td>
<td>
3539.1
</td>
<td>
POINT (78.55261 30.83530)
</td>
</tr>
<tr>
<th>
2022-04-04 09:29:51+05:30
</th>
<td>
0
</td>
<td>
3539.0
</td>
<td>
POINT (78.55265 30.83529)
</td>
</tr>
<tr>
<th>
2022-04-04 09:29:56+05:30
</th>
<td>
0
</td>
<td>
3538.4
</td>
<td>
POINT (78.55269 30.83528)
</td>
</tr>
</tbody>
</table>
<p>
166 rows × 3 columns
</p>
</div>
<p>We can now plot the elevation against the timestamp using Matplotlib. Since we have a large number of timestamps, we can use <code>set_major_locator()</code> to define what labels will be present on the axis.</p>
<p>Since our timestamps are timezone aware, we can also plot a timezone name (i.e. IST) along with the label.</p>
<p>We can also use a different style for our plot. You can run <code>plt.style.available</code> to see all available styles.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">&#39;ggplot&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb118"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">15</span>,<span class="dv">7</span>)</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>gdf[<span class="st">&#39;ele&#39;</span>].plot(kind<span class="op">=</span><span class="st">&#39;line&#39;</span>, ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">&#39;#2b8cbe&#39;</span>)</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Elevation Profile&#39;</span>, fontsize <span class="op">=</span> <span class="dv">18</span>)</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Elevation (meters)&#39;</span>, size <span class="op">=</span> <span class="dv">15</span>)</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="va">None</span>)</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Show a tick every 30 minute</span></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>xlocator <span class="op">=</span> mdates.MinuteLocator(interval<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>xformat <span class="op">=</span> mdates.DateFormatter(<span class="st">&#39;%H:%M %Z&#39;</span>, tz<span class="op">=</span>gdf.index.tz)  <span class="co"># adds some extra formatting, but not required</span></span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_major_locator(xlocator)</span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_major_formatter(xformat)</span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true" tabindex="-1"></a>ax.set_ylim([<span class="dv">3200</span>, <span class="dv">3700</span>])</span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true" tabindex="-1"></a>ax.fill_between(gdf.index, gdf[<span class="st">&#39;ele&#39;</span>].values, color<span class="op">=</span><span class="st">&#39;grey&#39;</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb118-17"><a href="#cb118-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/supplement_elevation_profile_plot_files/supplement_elevation_profile_plot_10_0.png" /></p>
<div class="sourceCode" id="cb119"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">&#39;default&#39;</span>)</span></code></pre></div>
</div>
<div id="creating-a-stacked-bar-chart" class="section level2">
<h2>Creating A Stacked Bar Chart</h2>
<div class="sourceCode" id="cb120"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code></pre></div>
<p>We have 12 different CSV files containing crime data for each month of 2020. We can use the <code>glob</code> module to find all files matching a pattern.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>data_pkg_path <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>folder <span class="op">=</span> <span class="st">&#39;crime&#39;</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>file_pattern <span class="op">=</span> <span class="st">&#39;2020-*.csv&#39;</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>file_path_pattern <span class="op">=</span> os.path.join(data_pkg_path, folder, file_pattern)</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>dataframe_list <span class="op">=</span> [pd.read_csv(f) <span class="cf">for</span> f <span class="kw">in</span> glob.glob(file_path_pattern)]</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>merged_df <span class="op">=</span> pd.concat(dataframe_list)</span></code></pre></div>
<p>We want to chart a stacked chart with information about crime type in each bar.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>counts_by_type <span class="op">=</span> merged_df.groupby([<span class="st">&#39;Month&#39;</span>, <span class="st">&#39;Crime type&#39;</span>]).size()</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>counts_by_type</span></code></pre></div>
<pre><code>Month    Crime type                  
2020-01  Anti-social behaviour           17548
         Bicycle theft                    1172
         Burglary                         6889
         Criminal damage and arson        4374
         Drugs                            4282
                                         ...  
2020-12  Robbery                          2021
         Shoplifting                      2690
         Theft from the person            3075
         Vehicle crime                    7758
         Violence and sexual offences    17836
Length: 168, dtype: int64</code></pre>
<p>The result is not in a suitable format for plotting. We call <code>unstack()</code> to create a dataframe.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>counts_df <span class="op">=</span> counts_by_type.unstack()</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>counts_df</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
Crime type
</th>
<th>
Anti-social behaviour
</th>
<th>
Bicycle theft
</th>
<th>
Burglary
</th>
<th>
Criminal damage and arson
</th>
<th>
Drugs
</th>
<th>
Other crime
</th>
<th>
Other theft
</th>
<th>
Possession of weapons
</th>
<th>
Public order
</th>
<th>
Robbery
</th>
<th>
Shoplifting
</th>
<th>
Theft from the person
</th>
<th>
Vehicle crime
</th>
<th>
Violence and sexual offences
</th>
</tr>
<tr>
<th>
Month
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
2020-01
</th>
<td>
17548
</td>
<td>
1172
</td>
<td>
6889
</td>
<td>
4374
</td>
<td>
4282
</td>
<td>
832
</td>
<td>
9497
</td>
<td>
562
</td>
<td>
4025
</td>
<td>
3263
</td>
<td>
3853
</td>
<td>
4256
</td>
<td>
11975
</td>
<td>
18451
</td>
</tr>
<tr>
<th>
2020-02
</th>
<td>
16975
</td>
<td>
1044
</td>
<td>
6216
</td>
<td>
4220
</td>
<td>
3818
</td>
<td>
757
</td>
<td>
9729
</td>
<td>
452
</td>
<td>
3842
</td>
<td>
3152
</td>
<td>
3845
</td>
<td>
4570
</td>
<td>
10405
</td>
<td>
17959
</td>
</tr>
<tr>
<th>
2020-03
</th>
<td>
23014
</td>
<td>
1078
</td>
<td>
5362
</td>
<td>
4392
</td>
<td>
3657
</td>
<td>
813
</td>
<td>
7531
</td>
<td>
483
</td>
<td>
3966
</td>
<td>
2711
</td>
<td>
2996
</td>
<td>
3414
</td>
<td>
9621
</td>
<td>
18371
</td>
</tr>
<tr>
<th>
2020-04
</th>
<td>
62763
</td>
<td>
1060
</td>
<td>
3661
</td>
<td>
3496
</td>
<td>
4978
</td>
<td>
751
</td>
<td>
3884
</td>
<td>
460
</td>
<td>
3464
</td>
<td>
1101
</td>
<td>
1691
</td>
<td>
677
</td>
<td>
6327
</td>
<td>
15638
</td>
</tr>
<tr>
<th>
2020-05
</th>
<td>
58502
</td>
<td>
1768
</td>
<td>
3886
</td>
<td>
3906
</td>
<td>
6427
</td>
<td>
823
</td>
<td>
4443
</td>
<td>
533
</td>
<td>
4250
</td>
<td>
1293
</td>
<td>
1956
</td>
<td>
795
</td>
<td>
7277
</td>
<td>
18149
</td>
</tr>
<tr>
<th>
2020-06
</th>
<td>
39584
</td>
<td>
2548
</td>
<td>
4320
</td>
<td>
4353
</td>
<td>
4665
</td>
<td>
882
</td>
<td>
5387
</td>
<td>
463
</td>
<td>
4966
</td>
<td>
1705
</td>
<td>
2400
</td>
<td>
1194
</td>
<td>
8102
</td>
<td>
19629
</td>
</tr>
<tr>
<th>
2020-07
</th>
<td>
35588
</td>
<td>
2833
</td>
<td>
4928
</td>
<td>
4692
</td>
<td>
4569
</td>
<td>
892
</td>
<td>
6977
</td>
<td>
453
</td>
<td>
5584
</td>
<td>
2168
</td>
<td>
3099
</td>
<td>
2072
</td>
<td>
8811
</td>
<td>
20991
</td>
</tr>
<tr>
<th>
2020-08
</th>
<td>
35842
</td>
<td>
3019
</td>
<td>
4995
</td>
<td>
4710
</td>
<td>
3534
</td>
<td>
780
</td>
<td>
7647
</td>
<td>
451
</td>
<td>
5490
</td>
<td>
2530
</td>
<td>
3006
</td>
<td>
2542
</td>
<td>
8919
</td>
<td>
21317
</td>
</tr>
<tr>
<th>
2020-09
</th>
<td>
30863
</td>
<td>
3078
</td>
<td>
5195
</td>
<td>
4274
</td>
<td>
3541
</td>
<td>
964
</td>
<td>
7516
</td>
<td>
503
</td>
<td>
5167
</td>
<td>
2599
</td>
<td>
3060
</td>
<td>
2696
</td>
<td>
9829
</td>
<td>
20348
</td>
</tr>
<tr>
<th>
2020-10
</th>
<td>
31186
</td>
<td>
2619
</td>
<td>
5618
</td>
<td>
4214
</td>
<td>
4124
</td>
<td>
812
</td>
<td>
7248
</td>
<td>
500
</td>
<td>
4577
</td>
<td>
2440
</td>
<td>
3222
</td>
<td>
3225
</td>
<td>
10148
</td>
<td>
19538
</td>
</tr>
<tr>
<th>
2020-11
</th>
<td>
33863
</td>
<td>
1985
</td>
<td>
5209
</td>
<td>
4205
</td>
<td>
4410
</td>
<td>
981
</td>
<td>
5734
</td>
<td>
511
</td>
<td>
4239
</td>
<td>
2286
</td>
<td>
2770
</td>
<td>
2568
</td>
<td>
9172
</td>
<td>
18981
</td>
</tr>
<tr>
<th>
2020-12
</th>
<td>
29377
</td>
<td>
1313
</td>
<td>
4765
</td>
<td>
4087
</td>
<td>
3624
</td>
<td>
779
</td>
<td>
6331
</td>
<td>
392
</td>
<td>
3888
</td>
<td>
2021
</td>
<td>
2690
</td>
<td>
3075
</td>
<td>
7758
</td>
<td>
17836
</td>
</tr>
</tbody>
</table>
</div>
<p>Now we can create the stacked bar chart. Instead of the default legend, we create a horizontal legend with a frame using the <code>legend()</code> function.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">20</span>,<span class="dv">10</span>)</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>counts_df.plot(kind<span class="op">=</span><span class="st">&#39;bar&#39;</span>, stacked<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax, colormap<span class="op">=</span><span class="st">&#39;tab20&#39;</span>)</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">&#39;upper center&#39;</span>, ncol<span class="op">=</span><span class="dv">5</span>, frameon<span class="op">=</span><span class="va">True</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">0.5</span>, <span class="fl">1.1</span>), fancybox<span class="op">=</span><span class="va">True</span>, shadow<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">&#39;right&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">&#39;top&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Year&#39;</span>, size <span class="op">=</span> <span class="dv">15</span>)</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Number of Incidents&#39;</span>, size <span class="op">=</span> <span class="dv">15</span>)</span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Crime in London (2020)&#39;</span>, size <span class="op">=</span> <span class="dv">18</span>, y<span class="op">=</span><span class="fl">1.1</span>)</span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a>output_folder <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(output_folder, <span class="st">&#39;stacked_chart.jpg&#39;</span>)</span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a>plt.savefig(output_path)</span>
<span id="cb125-13"><a href="#cb125-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/supplement_stacked_barcharts_files/supplement_stacked_barcharts_9_0.png" /></p>
</div>
<div id="animations-with-matplotlib" class="section level2">
<h2>Animations with Matplotlib</h2>
<p>This notebook shows how to use the <code>FuncAnimation</code> function from the <code>matplotlib.animation</code> module to create animated plots.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.animation <span class="im">import</span> FuncAnimation, PillowWriter</span></code></pre></div>
<p>Let’s understand the basics of matplotlib animation with a simple example. We will define 3 positions and we will create an animation of a point moving between them.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>points <span class="op">=</span> [(<span class="fl">0.1</span>, <span class="fl">0.5</span>), (<span class="fl">0.5</span>, <span class="fl">0.5</span>), (<span class="fl">0.9</span>, <span class="fl">0.5</span>)]</span></code></pre></div>
<p>Then we use the <code>FuncAnimation</code> class which makes an animation by repeatedly calling a function and saving the output as a frame in the animation.</p>
<p>We need to define a function that takes the frame number and generates a plot from it. Here we define a function <code>animation</code> that takes the frame index and creates a plot from the point at the same index in the <code>points</code> list. So at frame 0, it will display the first point, frame 1 the second point and so on.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">5</span>,<span class="dv">5</span>)</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>fig.tight_layout(rect<span class="op">=</span>[<span class="dv">0</span>, <span class="fl">0.03</span>, <span class="dv">1</span>, <span class="fl">0.95</span>])</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> animate(i):</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>    ax.clear()</span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the point from the points list at index i</span></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>    point <span class="op">=</span> points[i]</span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot that point using the x and y coordinates</span></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>    ax.plot(point[<span class="dv">0</span>], point[<span class="dv">1</span>], color<span class="op">=</span><span class="st">&#39;green&#39;</span>, </span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span><span class="st">&#39;original&#39;</span>, marker<span class="op">=</span><span class="st">&#39;o&#39;</span>)</span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set the x and y axis to display a fixed range</span></span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a>    ax.set_xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a>    ax.set_ylim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a>ani <span class="op">=</span> FuncAnimation(fig, animate, frames<span class="op">=</span><span class="bu">len</span>(points),</span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a>                    interval<span class="op">=</span><span class="dv">500</span>, repeat<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code></pre></div>
<p>The animation is now contained in the <code>ani</code> object. We can call <code>save()</code> and save the result as an animated GIF. We need to specify a <code>writer</code> that supports the output format.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>output_folder <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(output_folder, <span class="st">&#39;simple_animation.gif&#39;</span>)</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>ani.save(output_path, dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>         writer<span class="op">=</span>PillowWriter(fps<span class="op">=</span><span class="dv">1</span>))</span></code></pre></div>
<p>We can also use the <code>to_jshtml()</code> function to create an HTML representation of the animation and display in a Jupyter notebook.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co">#from IPython.display import HTML</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="co">#HTML(ani.to_jshtml())</span></span></code></pre></div>
</div>
</div>
<div id="resources" class="section level1">
<h1>Resources</h1>
<ul>
<li><a href="https://jakevdp.github.io/PythonDataScienceHandbook/04.00-introduction-to-matplotlib.html">Visualization with Matplotlib</a>. Python Data Science Handbook by Jake VanderPlas</li>
</ul>
</div>
<div id="data-credits" class="section level1">
<h1>Data Credits</h1>
<ul>
<li>London Crime Statistics: ASB Incidents, Crime and Outcome - UK Home Office. Retrieved 2022-01-20. <a href="https://data.police.uk/about/" class="uri">https://data.police.uk/about/</a></li>
<li>California Census Data: U.S. Census Bureau, 2019 American Community Survey 5-Year Estimates and Cartographic Boundary Files - Shapefile: 2019</li>
<li>Eclipse Shapefiles: NASA’s Scientific Visualization Studio Downloaded from <a href="https://svs.gsfc.nasa.gov/4518" class="uri">https://svs.gsfc.nasa.gov/4518</a></li>
<li>NASA Shuttle Radar Topography Mission (SRTM) Elevation Dataset. Downloaded from <a href="https://dwtkns.com/srtm30m/%5D">30m SRTM Tile Downloader</a>.</li>
<li>Temperature Anomalies: GISTEMP Team, 2022: GISS Surface Temperature Analysis (GISTEMP), version 4. NASA Goddard Institute for Space Studies. Dataset accessed 2022-01-26 at <a href="https://data.giss.nasa.gov/gistemp/" class="uri">https://data.giss.nasa.gov/gistemp/</a>.</li>
</ul>
</div>
<div id="license" class="section level1">
<h1>License</h1>
<p>This course material is licensed under a <a href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>. You are free to use the material for any non-commercial purpose. Kindly give appropriate credit to the original author.</p>
<p>If you would like to utilize these materials as part of a commercial offering, you can purchase a <em>Trainer License</em> for a small fee.</p>
<p>Please <a href="https://spatialthoughts.com/contact/">contact us</a> for pricing and terms. <!--
This material is part of the *Trainer's Package* and the buyer gets a non-exclusive, non-transferable, perpetual license to the material. You can fully customise and brand the materials to your requirements.
--></p>
<p>© 2022 Ujaval Gandhi <a href="https://spatialthoughts.com">www.spatialthoughts.com</a></p>
<hr />
<p><strong>This course is offered as an instructor-led online class. Visit <a href="https://spatialthoughts.com/events/">Spatial Thoughts</a> to know details of upcoming sessions.</strong></p>
</div>

<div id="disqus_thread" class="standardPadding"></div>

<!-- disqus -->
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = 'https://courses.spatialthoughts.com' + location.pathname;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://spatialthoughts.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
