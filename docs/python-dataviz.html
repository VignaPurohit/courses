<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Ujaval Gandhi" />


<title>Mapping and Data Visualization with Python (Full Course Material)</title>

<script src="site_libs/header-attrs-2.10/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-172372432-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-172372432-3');
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Courses</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="http://spatialthoughts.com">Back to Main Site</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="#">Back to Top</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Mapping and Data Visualization with Python (Full Course Material)</h1>
<h3 class="subtitle">A comprehensive guide for creating static and dynamic visualizations with spatial data.</h3>
<h4 class="author">Ujaval Gandhi</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#notebooks-and-datasets">Notebooks and Datasets</a></li>
<li><a href="#hello-colab">Hello Colab</a>
<ul>
<li><a href="#package-management">Package Management</a></li>
<li><a href="#data-management">Data Management</a></li>
</ul></li>
<li><a href="#matplotlib-basics">Matplotlib Basics</a>
<ul>
<li><a href="#setup">Setup</a></li>
<li><a href="#concepts">Concepts</a></li>
<li><a href="#exercise">Exercise</a></li>
</ul></li>
<li><a href="#creating-charts">Creating Charts</a>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#setup-and-data-download">Setup and Data Download</a></li>
<li><a href="#data-pre-processing">Data Pre-Processing</a></li>
<li><a href="#create-a-pie-chart">Create a Pie-Chart</a></li>
<li><a href="#create-a-bar-chart">Create a Bar Chart</a></li>
<li><a href="#exercise-1">Exercise</a></li>
</ul></li>
<li><a href="#creating-maps">Creating Maps</a>
<ul>
<li><a href="#overview-1">Overview</a></li>
<li><a href="#setup-and-data-download-1">Setup and Data Download</a></li>
<li><a href="#data-pre-processing-1">Data Pre-Processing</a></li>
<li><a href="#create-a-choropleth-map">Create a Choropleth Map</a></li>
<li><a href="#exercise-2">Exercise</a></li>
</ul></li>
<li><a href="#using-basemaps">Using Basemaps</a>
<ul>
<li><a href="#overview-2">Overview</a></li>
<li><a href="#setup-and-data-download-2">Setup and Data Download</a></li>
<li><a href="#data-pre-processing-2">Data Pre-Processing</a></li>
<li><a href="#create-a-multi-layer-map">Create a Multi-Layer Map</a></li>
<li><a href="#add-a-basemap">Add A BaseMap</a></li>
<li><a href="#exercise-3">Exercise</a></li>
</ul></li>
<li><a href="#xarray-basics">XArray Basics</a>
<ul>
<li><a href="#overview-3">Overview</a></li>
<li><a href="#setup-and-data-download-3">Setup and Data Download</a></li>
<li><a href="#xarray-terminology">XArray Terminology</a></li>
<li><a href="#selecting-data">Selecting Data</a></li>
<li><a href="#aggregating-data">Aggregating Data</a></li>
</ul></li>
<li><a href="#mapping-gridded-datasets">Mapping Gridded Datasets</a>
<ul>
<li><a href="#overview-4">Overview</a></li>
<li><a href="#setup-and-data-download-4">Setup and Data Download</a></li>
<li><a href="#data-pre-processing-3">Data Pre-Processing</a></li>
<li><a href="#plotting-using-matplotlib">Plotting using Matplotlib</a></li>
<li><a href="#plotting-using-cartopy">Plotting using CartoPy</a></li>
<li><a href="#exercise-4">Exercise</a></li>
</ul></li>
<li><a href="#visualizing-rasters">Visualizing Rasters</a>
<ul>
<li><a href="#overview-5">Overview</a></li>
<li><a href="#setup-and-data-download-5">Setup and Data Download</a></li>
<li><a href="#rioxarray-basics">Rioxarray Basics</a></li>
<li><a href="#merging-rasters">Merging Rasters</a></li>
<li><a href="#plotting-multiple-rasters">Plotting Multiple Rasters</a></li>
<li><a href="#annotating-plots">Annotating Plots</a></li>
<li><a href="#exercise-5">Exercise</a></li>
</ul></li>
<li><a href="#interactive-maps-with-folium">Interactive Maps with Folium</a>
<ul>
<li><a href="#overview-6">Overview</a></li>
<li><a href="#setup-1">Setup</a></li>
<li><a href="#folium-basics">Folium Basics</a></li>
<li><a href="#exercise-6">Exercise</a></li>
</ul></li>
<li><a href="#multi-layer-interactive-maps">Multi-layer Interactive Maps</a>
<ul>
<li><a href="#overview-7">Overview</a></li>
<li><a href="#setup-and-data-download-6">Setup and Data Download</a></li>
<li><a href="#using-geopandas-explore">Using GeoPandas explore()</a></li>
<li><a href="#create-multi-layer-maps">Create Multi-layer Maps</a></li>
<li><a href="#exercise-7">Exercise</a></li>
</ul></li>
<li><a href="#leafmap-basics">Leafmap Basics</a>
<ul>
<li><a href="#overview-8">Overview</a></li>
<li><a href="#setup-and-data-download-7">Setup and Data Download</a></li>
<li><a href="#leafmap-basics-1">Leafmap Basics</a></li>
<li><a href="#exercise-8">Exercise</a></li>
</ul></li>
<li><a href="#streamlit-basics">Streamlit Basics</a>
<ul>
<li><a href="#installation-and-setting-up-the-environment">Installation and Setting up the Environment</a></li>
</ul></li>
<li><a href="#building-apps-and-dashboards-with-streamlit">Building Apps and Dashboards with Streamlit</a></li>
<li><a href="#supplement">Supplement</a>
<ul>
<li><a href="#elevation-profile-plot-from-a-gps-track">Elevation Profile Plot from a GPS Track</a></li>
<li><a href="#creating-a-stacked-bar-chart">Creating A Stacked Bar Chart</a></li>
<li><a href="#animations-with-matplotlib">Animations with Matplotlib</a></li>
</ul></li>
<li><a href="#resources">Resources</a></li>
<li><a href="#data-credits">Data Credits</a></li>
<li><a href="#license">License</a></li>
</ul>
</div>

<div style="page-break-after: always;"></div>
<hr />
<p><img src="images/spatial_thoughts_logo.png" width="250pt" style="display: block; margin: auto;" /></p>
<hr />
<div style="page-break-after: always;"></div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This is an intermediate-level course that teaches you how to use Python for creating charts, plots, animations, and maps.</p>
<p><a href="https://docs.google.com/presentation/d/1Mc8O7zXJt-0LwUocPjpfjvkqYj-0qRnUMUIFpftVZFw/edit?usp=sharing" target="_blank"><img src="images/python_dataviz/course_overview.png" width="400" alt="View Presentation" /></a></p>
<p><a href="https://docs.google.com/presentation/d/1Mc8O7zXJt-0LwUocPjpfjvkqYj-0qRnUMUIFpftVZFw/edit?usp=sharing" target="_blank">View the Presentation ↗</a></p>
</div>
<div id="notebooks-and-datasets" class="section level1">
<h1>Notebooks and Datasets</h1>
<p>This course uses Google Colab for all exercises. You do not need to install any packages or download any datasets. The notebooks can be accessed by clicking on the <img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab" /> buttons at the beginning of each section. You may also access them directly from the <a href="https://github.com/spatialthoughts/python-dataviz-web">GitHub repository</a>.</p>
<div style="page-break-after: always;"></div>
</div>
<div id="hello-colab" class="section level1">
<h1>Hello Colab</h1>
<p><a href="https://colab.research.google.com/github/spatialthoughts/python-dataviz-web/blob/main/00_hello_colab.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab" /></a></p>
<p><a href="https://colab.research.google.com/">Google Colab</a> is a hosted Jupyter notebook environment that allows anyone to run Python code via a web-browser. It provides you free computation and data storage that can be utilized by your Python code.</p>
<p>You can click the <code>+Code</code> button to create a new cell and enter a block of code. To run the code, click the <strong>Run Code</strong> button next to the cell, or press <code>Shirt+Enter</code> key.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Hello World&#39;</span>)</span></code></pre></div>
<pre><code>Hello World</code></pre>
<div id="package-management" class="section level3">
<h3>Package Management</h3>
<p>Colab comes pre-installed with many Python packages. You can use a package by simply importing it.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code></pre></div>
<p>Each Colab notebook instance is run on a Ubuntu Linux machine in the cloud. If you want to install any packages, you can run a command by prefixing the command with a <code>!</code>. For example, you can install third-party packages via <code>pip</code> using the command <code>!pip</code>.</p>
<blockquote>
<p>Tip: If you want to list all pre-install packages and their versions in your Colab environemnt, you can run <code>!pip list -v</code>.</p>
</blockquote>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="op">--</span>quiet rioxarray</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray</span></code></pre></div>
<p>Some packages may also require additional binaries or local configuration. This can be achieved using package management commands for Ubuntu Linux. For example, we can run <code>apt</code> command to install specific package required for <code>geopandas</code> to work correctly.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>apt install <span class="op">-</span>qq libspatialindex<span class="op">-</span>dev</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="op">--</span>quiet fiona shapely pyproj rtree</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="op">--</span>quiet geopandas</span></code></pre></div>
<pre><code>libspatialindex-dev is already the newest version (1.8.5-5).
The following package was automatically installed and is no longer required:
  libnvidia-common-460
Use &#39;apt autoremove&#39; to remove it.
0 upgraded, 0 newly installed, 0 to remove and 20 not upgraded.</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span></code></pre></div>
</div>
<div id="data-management" class="section level3">
<h3>Data Management</h3>
<p>Colab provides 100GB of disk space along with your notebook. This can be used to store your data, intermediate outputs and results.</p>
<p>The code below will create 2 folders named ‘data’ and ‘output’ in your local filesystem.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>data_folder <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>output_folder <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(data_folder):</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    os.mkdir(data_folder)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(output_folder):</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    os.mkdir(output_folder)</span></code></pre></div>
<p>We can download some data from the internet and store it in the Colab environment. Below is a helper function that uses <code>urllib</code> to fetch any file from a URL.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> download(url):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    filename <span class="op">=</span> os.path.join(data_folder, os.path.basename(url))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(filename):</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        <span class="im">from</span> urllib.request <span class="im">import</span> urlretrieve</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        local, _ <span class="op">=</span> urlretrieve(url, filename)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;Downloaded &#39;</span> <span class="op">+</span> local)</span></code></pre></div>
<p>Let’s download the <a href="https://www.naturalearthdata.com/downloads/10m-cultural-vectors/">Populated Places</a> dataset from Natural Earth.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>download(<span class="st">&#39;https://naciscdn.org/naturalearth/10m/cultural/&#39;</span> <span class="op">+</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;ne_10m_populated_places_simple.zip&#39;</span>)</span></code></pre></div>
<pre><code>Downloaded data/ne_10m_populated_places_simple.zip</code></pre>
<p>The file is now in our local filesystem. We can construct the path to the data folder and read it using <code>geopandas</code></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="bu">file</span> <span class="op">=</span> <span class="st">&#39;ne_10m_populated_places_simple.zip&#39;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>filepath <span class="op">=</span> os.path.join(data_folder, <span class="bu">file</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>places <span class="op">=</span> gpd.read_file(filepath)</span></code></pre></div>
<p>Let’s do some data processing and write the results to a new file. The code below will filter all places which are also country capitals.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>capitals <span class="op">=</span> places[places[<span class="st">&#39;adm0cap&#39;</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>capitals</span></code></pre></div>
<p>We can write the results to the disk as a GeoPackage file.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>output_file <span class="op">=</span> <span class="st">&#39;capitals.gpkg&#39;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(output_folder, output_file)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>capitals.to_file(driver<span class="op">=</span><span class="st">&#39;GPKG&#39;</span>, filename<span class="op">=</span>output_path)</span></code></pre></div>
<p>You can open the <strong>Files</strong> tab from the left-hand panel in Colab and browse to the <code>output</code> folder. Locate the <code>capitals.gpkg</code> file and click the <strong>⋮</strong> button and select <em>Download</em> to download the file locally.</p>
<hr />
</div>
</div>
<div id="matplotlib-basics" class="section level1">
<h1>Matplotlib Basics</h1>
<p><a href="https://colab.research.google.com/github/spatialthoughts/python-dataviz-web/blob/main/01_matplotlib_basics.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab" /></a></p>
<p>This notebook introduces the <a href="https://matplotlib.org/">Matplotlib</a> library. This is one of the core Python packages for data visualization and is used by many spatial and non-spatial packages to create charts and maps.</p>
<div id="setup" class="section level2">
<h2>Setup</h2>
<p>Most of the Matplotlib functionality is available in the <code>pyplot</code> submodule, and by convention is imported as <code>plt</code></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code></pre></div>
</div>
<div id="concepts" class="section level2">
<h2>Concepts</h2>
<p>It is important to understand the 2 matplotlib objects</p>
<ul>
<li>Figure: This is the main container of the plot. A figure can contain multiple plots inside it</li>
<li>Axes: Axes refers to an individual plot or graph. A figure contains 1 or more axes.</li>
</ul>
<p>We create a figure and a single subplot. Specifying 1 row and 1 column for the <code>subplots()</code> function create a figure and an axes within it. Even if we have a single plot in the figure, it is useful to use tthis logic of intialization so it is consistent across different scripts.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">5</span>,<span class="dv">5</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/01_matplotlib_basics_files/01_matplotlib_basics_7_0.png" /></p>
<p>First, let’s learn how to plot a single point using matplotlib. Let’s say we want to display a point at the coordinate (0.5, 0.5).</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>point <span class="op">=</span> (<span class="fl">0.5</span>, <span class="fl">0.5</span>)</span></code></pre></div>
<p>We display the point using the <code>plot()</code> function. The <code>plot()</code> function expects at least 2 arguments, first one being one or more x coordinates and the second one being one or more y coordinates. Remember that once a plot is displayed using <code>plt.show()</code>, it displays the plot and empties the figure. So you’ll have to create it again.</p>
<p>Reference: <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.plot.html">matplotlib.pyplot.plot</a></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">5</span>,<span class="dv">5</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>ax.plot(point[<span class="dv">0</span>], point[<span class="dv">1</span>], color<span class="op">=</span><span class="st">&#39;green&#39;</span>, marker<span class="op">=</span><span class="st">&#39;o&#39;</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/01_matplotlib_basics_files/01_matplotlib_basics_11_0.png" /></p>
<p><strong>Note: Understanding <code>*args</code> and <code>**kwargs</code></strong></p>
<p>Python functions accept 2 types of arguments. - <em>Non Keyword Arguments</em>: These are referred as <code>*args</code>. When the number of arguments that a function takes is not fixed, it is specified as <code>*args</code>. In the function <code>plot()</code> above, you can specify 1 argument, 2 arguments or even 6 arguments and the function will respond accordingly. - <em>Keyword Arguments</em>: These are referred as <code>**kwargs</code>. These are specified as <code>key=value</code> pairs and usually used to specify optional parameters. These should always be specified after the non-keyword arguments. The <code>color='green'</code> in the <code>plot()</code> function is a keyboard argument.</p>
<p>One problematic area for plotting geospatial data using matplotlib is that geospatial data is typically represented as a list of x and y coordinates. Let’s say we want to plot the following 3 points defined as a list of (x,y) tuples.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>points <span class="op">=</span> [(<span class="fl">0.1</span>, <span class="fl">0.5</span>), (<span class="fl">0.5</span>, <span class="fl">0.5</span>), (<span class="fl">0.9</span>, <span class="fl">0.5</span>)]</span></code></pre></div>
<p>But to plot it, <code>matplotlib</code> require 2 separate lists or x and y coordinates. Here we can use the <code>zip()</code> function to create list of x and y coordinates.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>x, y <span class="op">=</span> <span class="bu">zip</span>(<span class="op">*</span>points)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y)</span></code></pre></div>
<pre><code>(0.1, 0.5, 0.9)
(0.5, 0.5, 0.5)</code></pre>
<p>Now these can be plotted using the <code>plot()</code> method. We specify keyword arguments <code>color</code> and <code>marker</code>.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">5</span>,<span class="dv">5</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>ax.plot(x, y, color<span class="op">=</span><span class="st">&#39;green&#39;</span>, marker<span class="op">=</span><span class="st">&#39;o&#39;</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/01_matplotlib_basics_files/01_matplotlib_basics_18_0.png" /></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">5</span>,<span class="dv">5</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>ax.plot(x, y, color<span class="op">=</span><span class="st">&#39;green&#39;</span>, marker<span class="op">=</span><span class="st">&#39;o&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;None&#39;</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/01_matplotlib_basics_files/01_matplotlib_basics_19_0.png" /></p>
<p>You can save the figure using the <code>savefig()</code> method. Remember to save the figure <em>before</em> calling <code>plt.show()</code> otherwise the figure would be empty.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">5</span>,<span class="dv">5</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>ax.plot(x, y, color<span class="op">=</span><span class="st">&#39;green&#39;</span>, marker<span class="op">=</span><span class="st">&#39;o&#39;</span>, linestyle<span class="op">=</span><span class="st">&#39;None&#39;</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>output_folder <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(output_folder, <span class="st">&#39;simple.png&#39;</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>plt.savefig(output_path)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>Matplotlib provides many specialized functions for different types of plots. <code>scatter()</code> for Scatter Charts, <code>bar()</code> for Bar Charts and so on. You can use them directly, but in practice they are used via higher-level libraries like <code>pandas</code>. In the next section, we will see how to create such charts.</p>
</div>
<div id="exercise" class="section level2">
<h2>Exercise</h2>
<p>Create a plot that displays the 2 given points with their x,y coordinates with different sumbology.</p>
<ul>
<li><code>point1</code>: Plot it with green color and a triangle marker.</li>
<li><code>point2</code>: Plot it with red color and a circle marker.</li>
</ul>
<p>Reference: <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.plot.html">matplotlib.pyplot.plot</a></p>
<blockquote>
<p>Hint: You can call <code>plot()</code> multiple times to add new data to the same Axes.</p>
</blockquote>
<div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>point1 <span class="op">=</span> (<span class="dv">4</span>, <span class="dv">1</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>point2 <span class="op">=</span> (<span class="dv">3</span>, <span class="dv">4</span>)</span></code></pre></div>
<hr />
</div>
</div>
<div id="creating-charts" class="section level1">
<h1>Creating Charts</h1>
<p><a href="https://colab.research.google.com/github/spatialthoughts/python-dataviz-web/blob/main/02_creating_charts.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab" /></a></p>
<div id="overview" class="section level2">
<h2>Overview</h2>
<p>Pandas allows you to read structured datasets and visualize them using the <code>plot()</code> method. By default, Pandas uses <code>matplotlib</code> to create the plots.</p>
<p>In this notebook, we will take work with open dataset of crime in London.</p>
</div>
<div id="setup-and-data-download" class="section level2">
<h2>Setup and Data Download</h2>
<p>The following blocks of code will install the required packages and download the datasets to your Colab environment.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>data_folder <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>output_folder <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(data_folder):</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    os.mkdir(data_folder)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(output_folder):</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    os.mkdir(output_folder)</span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> download(url):</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    filename <span class="op">=</span> os.path.join(data_folder, os.path.basename(url))</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(filename):</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>        <span class="im">from</span> urllib.request <span class="im">import</span> urlretrieve</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>        local, _ <span class="op">=</span> urlretrieve(url, filename)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;Downloaded &#39;</span> <span class="op">+</span> local)</span></code></pre></div>
<p>We have 12 different CSV files containing crime data for each month of 2020. We download each of them to the data folder.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>files <span class="op">=</span> [</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;2020-01-metropolitan-street.csv&#39;</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;2020-02-metropolitan-street.csv&#39;</span>,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;2020-03-metropolitan-street.csv&#39;</span>,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;2020-04-metropolitan-street.csv&#39;</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;2020-05-metropolitan-street.csv&#39;</span>,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;2020-06-metropolitan-street.csv&#39;</span>,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;2020-07-metropolitan-street.csv&#39;</span>,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;2020-08-metropolitan-street.csv&#39;</span>,</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;2020-09-metropolitan-street.csv&#39;</span>,</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;2020-10-metropolitan-street.csv&#39;</span>,</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;2020-11-metropolitan-street.csv&#39;</span>,</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;2020-12-metropolitan-street.csv&#39;</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>data_url <span class="op">=</span> <span class="st">&#39;https://github.com/spatialthoughts/python-dataviz-web/raw/main/data/crime/&#39;</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> f <span class="kw">in</span> files:</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  url <span class="op">=</span> os.path.join(data_url <span class="op">+</span> f)</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  download(url)</span></code></pre></div>
<pre><code>Downloaded data/2020-01-metropolitan-street.csv
Downloaded data/2020-02-metropolitan-street.csv
Downloaded data/2020-03-metropolitan-street.csv
Downloaded data/2020-04-metropolitan-street.csv
Downloaded data/2020-05-metropolitan-street.csv
Downloaded data/2020-06-metropolitan-street.csv
Downloaded data/2020-07-metropolitan-street.csv
Downloaded data/2020-08-metropolitan-street.csv
Downloaded data/2020-09-metropolitan-street.csv
Downloaded data/2020-10-metropolitan-street.csv
Downloaded data/2020-11-metropolitan-street.csv
Downloaded data/2020-12-metropolitan-street.csv</code></pre>
</div>
<div id="data-pre-processing" class="section level2">
<h2>Data Pre-Processing</h2>
<p>It will be helpful to merge all 12 CSV files into a single dataframe. We can use <code>pd.concat()</code> to merge a list of dataframes.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>dataframe_list <span class="op">=</span> []</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> f <span class="kw">in</span> files:</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    filepath <span class="op">=</span> os.path.join(data_folder, f)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(filepath)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    dataframe_list.append(df)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>merged_df <span class="op">=</span> pd.concat(dataframe_list)</span></code></pre></div>
<p>The resulting dataframe consists of over 1 million records of various crimes recorded in London in the year 2020.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>merged_df</span></code></pre></div>
</div>
<div id="create-a-pie-chart" class="section level2">
<h2>Create a Pie-Chart</h2>
<p>Let’s create a pie-chart showing the distribution of different types of crime. Pandas <code>groupby()</code> function allows us to calculate group statistics.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>type_counts <span class="op">=</span> merged_df.groupby(<span class="st">&#39;Crime type&#39;</span>).size()</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>type_counts</span></code></pre></div>
<pre><code>Crime type
Anti-social behaviour           415105
Bicycle theft                    23517
Burglary                         61044
Criminal damage and arson        50923
Drugs                            51629
Other crime                      10066
Other theft                      81924
Possession of weapons             5763
Public order                     53458
Robbery                          27269
Shoplifting                      34588
Theft from the person            31084
Vehicle crime                   108344
Violence and sexual offences    227208
dtype: int64</code></pre>
<p>We now uses the <code>plot()</code> method to create the chart. This method is a wrapper around <code>matplotlib</code> and can accept supported arguments from it.</p>
<p>Reference: <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.plot.html"><code>pandas.DataFrame.plot</code></a></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">15</span>,<span class="dv">10</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>type_counts.plot(kind<span class="op">=</span><span class="st">&#39;pie&#39;</span>, ax<span class="op">=</span>ax)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/02_creating_charts_files/02_creating_charts_16_0.png" /></p>
<p>Let’s customize the chart. First we use <code>set_title()</code> method to add a title to the chart and <code>set_ylabel()</code> to remove the empty y-axis label. Lastly, we use the <code>plt.tight_layout()</code> to remove the extra whitespace around the plot.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">15</span>,<span class="dv">10</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>type_counts.plot(kind<span class="op">=</span><span class="st">&#39;pie&#39;</span>, ax<span class="op">=</span>ax)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">&#39;Crime Types&#39;</span>, fontsize <span class="op">=</span> <span class="dv">18</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">&#39;&#39;</span>)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/02_creating_charts_files/02_creating_charts_18_0.png" /></p>
<p>Matplotlib plots offer unlimited possibilities to customize your charts. Let’s see some of the options available to customize the pie-chart.</p>
<ul>
<li><code>wedgeprops</code>: Customize the look of each ‘wedge’ of the pie.</li>
<li><code>textprops</code>: Set the text properties of labels.</li>
<li><code>autopct</code> and <code>pctdistance</code>: Format and distance of the percentage label of each slice.</li>
</ul>
<p>Reference: <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.pie.html"><code>matplotlib.pyplot.pie</code></a></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>wedgeprops<span class="op">=</span>{<span class="st">&#39;linewidth&#39;</span>: <span class="dv">1</span>, <span class="st">&#39;edgecolor&#39;</span>: <span class="st">&#39;white&#39;</span>}</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>textprops<span class="op">=</span> {<span class="st">&#39;fontsize&#39;</span>: <span class="dv">10</span>, <span class="st">&#39;fontstyle&#39;</span>: <span class="st">&#39;italic&#39;</span>}</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>autopct<span class="op">=</span> <span class="st">&#39;</span><span class="sc">%.1f%%</span><span class="st">&#39;</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>pctdistance <span class="op">=</span> <span class="fl">0.8</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">15</span>,<span class="dv">10</span>)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>type_counts.plot(kind<span class="op">=</span><span class="st">&#39;pie&#39;</span>, ax<span class="op">=</span>ax, </span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>                 wedgeprops<span class="op">=</span>wedgeprops,</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>                 textprops<span class="op">=</span>textprops, </span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>                 autopct<span class="op">=</span>autopct,</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>                 pctdistance<span class="op">=</span>pctdistance )</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">&#39;Crime Types&#39;</span>, fontsize <span class="op">=</span> <span class="dv">18</span>)</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">&#39;&#39;</span>)</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/02_creating_charts_files/02_creating_charts_20_0.png" /></p>
</div>
<div id="create-a-bar-chart" class="section level2">
<h2>Create a Bar Chart</h2>
<p>We can also chart the trend of crime over the year. For this, let’s group the data by month.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>monthly_counts <span class="op">=</span> merged_df.groupby(<span class="st">&#39;Month&#39;</span>).size()</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>monthly_counts</span></code></pre></div>
<pre><code>Month
2020-01     90979
2020-02     86984
2020-03     87409
2020-04    109951
2020-05    114008
2020-06    100198
2020-07    103657
2020-08    104782
2020-09     99633
2020-10     99471
2020-11     96914
2020-12     87936
dtype: int64</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">15</span>,<span class="dv">7</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>monthly_counts.plot(kind<span class="op">=</span><span class="st">&#39;bar&#39;</span>, ax<span class="op">=</span>ax)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/02_creating_charts_files/02_creating_charts_23_0.png" /></p>
<p>As we learnt earlier, we can add multiple plots on the same Axes. We can add a <code>line</code> chart along with the <code>bar</code> chart to show the trendline as well. Lastly we add the titles and axis labels to finish the chart.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">15</span>,<span class="dv">7</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>monthly_counts.plot(kind<span class="op">=</span><span class="st">&#39;bar&#39;</span>, ax<span class="op">=</span>ax)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>monthly_counts.plot(kind<span class="op">=</span><span class="st">&#39;line&#39;</span>, ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">&#39;red&#39;</span>, marker<span class="op">=</span><span class="st">&#39;o&#39;</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">&#39;Total Crime by Month&#39;</span>)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">&#39;Total Incidents&#39;</span>)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/02_creating_charts_files/02_creating_charts_25_0.png" /></p>
</div>
<div id="exercise-1" class="section level2">
<h2>Exercise</h2>
<p>Plot the trend of Bicycle thefts as a line chart. The cell below filters the <code>merged_df</code> dataframe to select incidents of ‘Bicycle theft’. Group the results by months and plot the results.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>bicycle_thefts <span class="op">=</span> merged_df[merged_df[<span class="st">&#39;Crime type&#39;</span>] <span class="op">==</span> <span class="st">&#39;Bicycle theft&#39;</span>]</span></code></pre></div>
<hr />
</div>
</div>
<div id="creating-maps" class="section level1">
<h1>Creating Maps</h1>
<p><a href="https://colab.research.google.com/github/spatialthoughts/python-dataviz-web/blob/main/03_creating_maps.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab" /></a></p>
<div id="overview-1" class="section level2">
<h2>Overview</h2>
<p>Similar to Pandas, GeoPandas has a <code>plot()</code> method that can plot geospatial data using Matplotlib.</p>
<p>We will work with census data to create a choropleth map of population density. We will start with a shapefile of census tracts, and join it with tabular data to get a GeoDataframe with census tract geometry and correponding populations.</p>
</div>
<div id="setup-and-data-download-1" class="section level2">
<h2>Setup and Data Download</h2>
<p>The following blocks of code will install the required packages and download the datasets to your Colab environment.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>capture</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">&#39;google.colab&#39;</span> <span class="kw">in</span> <span class="bu">str</span>(get_ipython()):</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">!</span>apt install libspatialindex<span class="op">-</span>dev</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">!</span>pip install fiona shapely pyproj rtree mapclassify</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">!</span>pip install geopandas</span></code></pre></div>
<div class="sourceCode" id="cb45"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>data_folder <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>output_folder <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(data_folder):</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    os.mkdir(data_folder)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(output_folder):</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    os.mkdir(output_folder)</span></code></pre></div>
<div class="sourceCode" id="cb47"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> download(url):</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    filename <span class="op">=</span> os.path.join(data_folder, os.path.basename(url))</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(filename):</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>        <span class="im">from</span> urllib.request <span class="im">import</span> urlretrieve</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>        local, _ <span class="op">=</span> urlretrieve(url, filename)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;Downloaded &#39;</span> <span class="op">+</span> local)</span></code></pre></div>
<p>We will download the the census tracts shapefile and a CSV file containing a variety of population statistics for each tract.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>shapefile_name <span class="op">=</span> <span class="st">&#39;tl_2019_06_tract&#39;</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>shapefile_exts <span class="op">=</span> [<span class="st">&#39;.shp&#39;</span>, <span class="st">&#39;.shx&#39;</span>, <span class="st">&#39;.dbf&#39;</span>, <span class="st">&#39;.prj&#39;</span>]</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>data_url <span class="op">=</span> <span class="st">&#39;https://github.com/spatialthoughts/python-dataviz-web/raw/main/data/census/&#39;</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ext <span class="kw">in</span> shapefile_exts:</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  url <span class="op">=</span> data_url <span class="op">+</span> shapefile_name <span class="op">+</span> ext</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  download(url)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>csv_name <span class="op">=</span> <span class="st">&#39;ACSST5Y2019.S0101_data.csv&#39;</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>download(data_url <span class="op">+</span> csv_name)</span></code></pre></div>
<pre><code>Downloaded data/tl_2019_06_tract.shp
Downloaded data/tl_2019_06_tract.shx
Downloaded data/tl_2019_06_tract.dbf
Downloaded data/tl_2019_06_tract.prj
Downloaded data/ACSST5Y2019.S0101_data.csv</code></pre>
</div>
<div id="data-pre-processing-1" class="section level2">
<h2>Data Pre-Processing</h2>
<p>Let’s read the census tracts shapefile and the CSV file containing population counts.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>shapefile_path <span class="op">=</span> os.path.join(data_folder, shapefile_name <span class="op">+</span> <span class="st">&#39;.shp&#39;</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>tracts <span class="op">=</span> gpd.read_file(shapefile_path)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>tracts</span></code></pre></div>
<p>We now read the file containing a variety of population statistics for each tract. We read this file as a Pandas DataFrame. The CSV file contains an extra row before the header, so we specify <code>skiprows=[1]</code> to skip reading it.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>csv_path <span class="op">=</span> os.path.join(data_folder, csv_name)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> pd.read_csv(csv_path, skiprows<span class="op">=</span>[<span class="dv">1</span>])</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>table</span></code></pre></div>
<p>To join this DataFrame with the GeoDataFrame, we need a column with unique identifiers. We use the <code>GEOID</code> column and process the id so they match exactly in both datasets.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>filtered <span class="op">=</span> table[[<span class="st">&#39;GEO_ID&#39;</span>,<span class="st">&#39;NAME&#39;</span>, <span class="st">&#39;S0101_C01_001E&#39;</span>]]</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>filtered <span class="op">=</span> filtered.rename(columns <span class="op">=</span> {<span class="st">&#39;S0101_C01_001E&#39;</span>: <span class="st">&#39;Population&#39;</span>, <span class="st">&#39;GEO_ID&#39;</span>: <span class="st">&#39;GEOID&#39;</span>})</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>filtered[<span class="st">&#39;GEOID&#39;</span>] <span class="op">=</span> filtered.GEOID.<span class="bu">str</span>[<span class="op">-</span><span class="dv">11</span>:]</span></code></pre></div>
<p>Finally, we do a table join using the <code>merge</code> method.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> tracts.merge(filtered, on<span class="op">=</span><span class="st">&#39;GEOID&#39;</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>gdf</span></code></pre></div>
<p>For creating a choropleth map, we must normalize the population counts. US Census Bureau <a href="https://www.census.gov/quickfacts/fact/note/US/LND110210">recommends</a> calculating the population density by dividing the total population by the land area. The original shapefile contains a column <code>ALAND</code> with the land area in square kilometers. Using it, we compute a new column <code>density</code> containing the persons per square kilometer.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>gdf[<span class="st">&#39;density&#39;</span>] <span class="op">=</span> <span class="fl">1e6</span><span class="op">*</span>gdf[<span class="st">&#39;Population&#39;</span>]<span class="op">/</span>gdf[<span class="st">&#39;ALAND&#39;</span>]</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>gdf</span></code></pre></div>
</div>
<div id="create-a-choropleth-map" class="section level2">
<h2>Create a Choropleth Map</h2>
<p>The <code>plot()</code> method will render the data to a plot.</p>
<p>Reference: <a href="https://geopandas.org/en/stable/docs/reference/api/geopandas.GeoDataFrame.plot.html">geopandas.GeoDataFrame.plot</a></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">10</span>,<span class="dv">10</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>gdf.plot(ax<span class="op">=</span>ax)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/03_creating_maps_files/03_creating_maps_21_0.png" /></p>
<p>You can supply additional style options to change the appearance of the map. <code>facecolor</code> and <code>edgecolor</code> parameters are used to determine the fill and outline colors respectively. The stroke width can be adjusted using the <code>linewidth</code> parameter.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">10</span>,<span class="dv">10</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>gdf.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">&#39;#f0f0f0&#39;</span>, edgecolor<span class="op">=</span><span class="st">&#39;#de2d26&#39;</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/03_creating_maps_files/03_creating_maps_23_0.png" /></p>
<p>We have the population density for each tract in the <code>density</code> column. We can assign a color to each polygon based on the value in this column - resulting in a choropleth map. Additionally, we need to specify a color ramp using <code>cmap</code> and classification scheme using <code>scheme</code>. The classification schedule will determine how the continuous data will be classified into discrete bins.</p>
<blockquote>
<p>Tip: You can add <code>_r</code> to any color ramp name to get a <strong>r</strong>eversed version of that ramp.</p>
</blockquote>
<p>References: - <a href="https://matplotlib.org/stable/tutorials/colors/colormaps.html">Matplotlib Colormaps</a> - <a href="https://pysal.org/mapclassify/generated/mapclassify.classify.html#mapclassify.classify">Mapclassify Classification Schemes</a></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">10</span>,<span class="dv">10</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>gdf.plot(ax<span class="op">=</span>ax, column<span class="op">=</span><span class="st">&#39;density&#39;</span>, cmap<span class="op">=</span><span class="st">&#39;RdYlGn_r&#39;</span>, scheme<span class="op">=</span><span class="st">&#39;quantiles&#39;</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/03_creating_maps_files/03_creating_maps_25_0.png" /></p>
<p>Instead of the class breaks being determined by the classification scheme, we can also manually specify the ranges. This is preferable so we can have a human-interpretable legend. The <code>legend=True</code> parameter adds a legend to our plot.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">10</span>,<span class="dv">10</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>gdf.plot(ax<span class="op">=</span>ax, column<span class="op">=</span><span class="st">&#39;density&#39;</span>, cmap<span class="op">=</span><span class="st">&#39;RdYlGn_r&#39;</span>, scheme<span class="op">=</span><span class="st">&#39;User_Defined&#39;</span>, </span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>         classification_kwds<span class="op">=</span><span class="bu">dict</span>(bins<span class="op">=</span>[<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">25</span>,<span class="dv">50</span>,<span class="dv">100</span>, <span class="dv">250</span>, <span class="dv">500</span>, <span class="dv">1000</span>, <span class="dv">5000</span>]),</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>         legend<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/03_creating_maps_files/03_creating_maps_27_0.png" /></p>
<p>We give final touches to our map and save the result as a PNG file. Remember to call <code>plt.savefig()</code> before showing the plot as the plot gets emptied after being shown.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(output_folder, <span class="st">&#39;california_pop.png&#39;</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">10</span>,<span class="dv">10</span>)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>gdf.plot(ax<span class="op">=</span>ax, column<span class="op">=</span><span class="st">&#39;density&#39;</span>, cmap<span class="op">=</span><span class="st">&#39;RdYlGn_r&#39;</span>, scheme<span class="op">=</span><span class="st">&#39;User_Defined&#39;</span>, </span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>         classification_kwds<span class="op">=</span><span class="bu">dict</span>(bins<span class="op">=</span>[<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">25</span>,<span class="dv">50</span>,<span class="dv">100</span>, <span class="dv">250</span>, <span class="dv">500</span>, <span class="dv">1000</span>, <span class="dv">5000</span>]),</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>         legend<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">&#39;California Population Density (2019)&#39;</span>, size <span class="op">=</span> <span class="dv">18</span>)</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>plt.savefig(output_path, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/03_creating_maps_files/03_creating_maps_29_0.png" /></p>
</div>
<div id="exercise-2" class="section level2">
<h2>Exercise</h2>
<p>Plot the census tracts geodataframe <code>tracts</code> with just outlines and no fill color.</p>
<blockquote>
<p>Hint: Set the <code>facecolor</code> option to <code>'none'</code> for no fills. Check the <a href="https://geopandas.org/en/stable/docs/reference/api/geopandas.GeoDataFrame.plot.html"><em>style_kwds</em> parameter</a> of the <code>plot()</code> method for more details.</p>
</blockquote>
<div class="sourceCode" id="cb60"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">10</span>,<span class="dv">10</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>tracts.plot(ax<span class="op">=</span>ax)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<hr />
</div>
</div>
<div id="using-basemaps" class="section level1">
<h1>Using Basemaps</h1>
<p><a href="https://colab.research.google.com/github/spatialthoughts/python-dataviz-web/blob/main/04_using_basemaps.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab" /></a></p>
<div id="overview-2" class="section level2">
<h2>Overview</h2>
<p>Creating geospatial visualizations oftern require overlaying your data on a basemap. <a href="https://contextily.readthedocs.io/en/latest/">Contextily</a> is a package that allows you to fetch various basemaps from the internet and ad them to your plot as static images.</p>
<p>We will learn how to take a shapefile showing the path of the <a href="https://svs.gsfc.nasa.gov/4518">2017 Solar Eclipse</a> and create a map with a topographic basemap.</p>
</div>
<div id="setup-and-data-download-2" class="section level2">
<h2>Setup and Data Download</h2>
<p>The following blocks of code will install the required packages and download the datasets to your Colab environment.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>capture</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">&#39;google.colab&#39;</span> <span class="kw">in</span> <span class="bu">str</span>(get_ipython()):</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">!</span>apt install libspatialindex<span class="op">-</span>dev</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">!</span>pip install fiona shapely pyproj rtree</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">!</span>pip install geopandas</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">!</span>pip install contextily</span></code></pre></div>
<div class="sourceCode" id="cb62"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> contextily <span class="im">as</span> cx</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code></pre></div>
<div class="sourceCode" id="cb63"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>data_folder <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>output_folder <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(data_folder):</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    os.mkdir(data_folder)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(output_folder):</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>    os.mkdir(output_folder)</span></code></pre></div>
<div class="sourceCode" id="cb64"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> download(url):</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    filename <span class="op">=</span> os.path.join(data_folder, os.path.basename(url))</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(filename):</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>        <span class="im">from</span> urllib.request <span class="im">import</span> urlretrieve</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>        local, _ <span class="op">=</span> urlretrieve(url, filename)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;Downloaded &#39;</span> <span class="op">+</span> local)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>path_shapefile <span class="op">=</span> <span class="st">&#39;upath17&#39;</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>umbra_shapefile <span class="op">=</span> <span class="st">&#39;umbra17&#39;</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>shapefile_exts <span class="op">=</span> [<span class="st">&#39;.shp&#39;</span>, <span class="st">&#39;.shx&#39;</span>, <span class="st">&#39;.dbf&#39;</span>, <span class="st">&#39;.prj&#39;</span>]</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>data_url <span class="op">=</span> <span class="st">&#39;https://github.com/spatialthoughts/python-dataviz-web/raw/main/data/eclipse/&#39;</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> shapefile <span class="kw">in</span> [path_shapefile, umbra_shapefile]:</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> ext <span class="kw">in</span> shapefile_exts:</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> data_url <span class="op">+</span> shapefile <span class="op">+</span> ext</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>    download(url)</span></code></pre></div>
<pre><code>Downloaded data/upath17.shp
Downloaded data/upath17.shx
Downloaded data/upath17.dbf
Downloaded data/upath17.prj
Downloaded data/umbra17.shp
Downloaded data/umbra17.shx
Downloaded data/umbra17.dbf
Downloaded data/umbra17.prj</code></pre>
</div>
<div id="data-pre-processing-2" class="section level2">
<h2>Data Pre-Processing</h2>
<div class="sourceCode" id="cb66"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>path_shapefile_path <span class="op">=</span> os.path.join(data_folder, path_shapefile <span class="op">+</span> <span class="st">&#39;.shp&#39;</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>path_gdf <span class="op">=</span> gpd.read_file(path_shapefile_path)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>path_gdf</span></code></pre></div>
<div class="sourceCode" id="cb67"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>umbra_shapefile_path <span class="op">=</span> os.path.join(data_folder, umbra_shapefile <span class="op">+</span> <span class="st">&#39;.shp&#39;</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>umbra_gdf <span class="op">=</span> gpd.read_file(umbra_shapefile_path)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>umbra_gdf[:<span class="dv">5</span>]</span></code></pre></div>
</div>
<div id="create-a-multi-layer-map" class="section level2">
<h2>Create a Multi-Layer Map</h2>
<p>We can show a GeoDataFrame using the <code>plot()</code> method.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">15</span>,<span class="dv">7</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>path_gdf.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">&#39;#cccccc&#39;</span>, edgecolor<span class="op">=</span><span class="st">&#39;#969696&#39;</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/04_using_basemaps_files/04_using_basemaps_12_0.png" /></p>
<p>To add another layer to our plot, we can simply render another GeoDataFrame on the same Axes.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">15</span>,<span class="dv">7</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>path_gdf.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">&#39;#cccccc&#39;</span>, edgecolor<span class="op">=</span><span class="st">&#39;#969696&#39;</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>umbra_gdf.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">&#39;#636363&#39;</span>, edgecolor<span class="op">=</span><span class="st">&#39;none&#39;</span>)</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/04_using_basemaps_files/04_using_basemaps_14_0.png" /></p>
</div>
<div id="add-a-basemap" class="section level2">
<h2>Add A BaseMap</h2>
<p>The visualization is not useful as it is missing context. We want to overlay this on a basemap to understand where the eclipse was visible from. We can choose from a variety of basemap tiles. There are over 200 basemap styles included in the library. Let’s see them using the <code>providers</code> property.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>providers <span class="op">=</span> cx.providers</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>providers</span></code></pre></div>
<p>For overlaying the eclipse path, let’s use the <em>OpenTopoMap</em> basemap. We need to specify a CRS for the map. For now, let’s use the CRS of the original shapefile.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">15</span>,<span class="dv">7</span>)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>path_gdf.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">&#39;#cccccc&#39;</span>, edgecolor<span class="op">=</span><span class="st">&#39;#969696&#39;</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>umbra_gdf.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">&#39;#636363&#39;</span>, edgecolor<span class="op">=</span><span class="st">&#39;none&#39;</span>)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>cx.add_basemap(ax, crs<span class="op">=</span>path_gdf.crs, source<span class="op">=</span>cx.providers.OpenTopoMap)</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/04_using_basemaps_files/04_using_basemaps_19_0.png" /></p>
<p>The web tiles for the basemap are in the Web Mercator CRS (EPSG:3857). When you request them in a different CRS, they are warped to the requested CRS. This may cause the labels to not be legible in some cases. Instead, we can request the tiles in their original CRS and reproject our data layer to its CRS.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>path_reprojected <span class="op">=</span> path_gdf.to_crs(<span class="st">&#39;EPSG:3857&#39;</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>umbra_reprojected <span class="op">=</span> umbra_gdf.to_crs(<span class="st">&#39;EPSG:3857&#39;</span>)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">15</span>,<span class="dv">7</span>)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>path_reprojected.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">&#39;#cccccc&#39;</span>, edgecolor<span class="op">=</span><span class="st">&#39;#969696&#39;</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>umbra_reprojected.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">&#39;#636363&#39;</span>, edgecolor<span class="op">=</span><span class="st">&#39;none&#39;</span>)</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>cx.add_basemap(ax, crs<span class="op">=</span>path_reprojected.crs, source<span class="op">=</span>cx.providers.OpenTopoMap)</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">&#39;2017 Total Solar Eclipse Path&#39;</span>, size <span class="op">=</span> <span class="dv">18</span>)</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/04_using_basemaps_files/04_using_basemaps_21_0.png" /></p>
</div>
<div id="exercise-3" class="section level2">
<h2>Exercise</h2>
<p>Instead of the OpenTopoMap, create a visualization using the <em>Toner</em> basemap from <em>Stamen</em>. Save the resulting visualization as a PNG file <code>eclipse_path.png</code>.</p>
<hr />
</div>
</div>
<div id="xarray-basics" class="section level1">
<h1>XArray Basics</h1>
<p><a href="https://colab.research.google.com/github/spatialthoughts/python-dataviz-web/blob/main/05_xarray_basics.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab" /></a></p>
<div id="overview-3" class="section level2">
<h2>Overview</h2>
<p>Many climate and meteorological datasets come as gridded rasters in data formats such as NetCDF and GRIB. We will use <a href="http://xarray.pydata.org/">XArray</a> to read, process and visualize the gridded raster dataset.</p>
<p>Xarray is an evolution of rasterio and is inspired by libraries like pandas to work with raster datasets. It is particularly suited for working with multi-dimensional time-series raster datasets. It also integrates tightly with dask that allows one to scale raster data processing using parallel computing. XArray provides <a href="https://xarray.pydata.org/en/stable/user-guide/plotting.html">Plotting Functions</a> based on Matplotlib.</p>
<p>In this section, we will take the <a href="https://data.giss.nasa.gov/gistemp/">Gridded Monthly Temperature Anomaly Data</a> from 1880-present from GISTEMP and visualize the temperature anomaly for the year 2021.</p>
</div>
<div id="setup-and-data-download-3" class="section level2">
<h2>Setup and Data Download</h2>
<p>The following blocks of code will install the required packages and download the datasets to your Colab environment.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span></code></pre></div>
<div class="sourceCode" id="cb74"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>data_folder <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>output_folder <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(data_folder):</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>    os.mkdir(data_folder)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(output_folder):</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>    os.mkdir(output_folder)</span></code></pre></div>
<div class="sourceCode" id="cb75"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> download(url):</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>    filename <span class="op">=</span> os.path.join(data_folder, os.path.basename(url))</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(filename):</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>        <span class="im">from</span> urllib.request <span class="im">import</span> urlretrieve</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>        local, _ <span class="op">=</span> urlretrieve(url, filename)</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;Downloaded &#39;</span> <span class="op">+</span> local)</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">&#39;gistemp1200_GHCNv4_ERSSTv5.nc&#39;</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>data_url <span class="op">=</span> <span class="st">&#39;https://github.com/spatialthoughts/python-dataviz-web/raw/main/data/gistemp/&#39;</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>download(data_url <span class="op">+</span> filename)</span></code></pre></div>
<pre><code>Downloaded data/gistemp1200_GHCNv4_ERSSTv5.nc</code></pre>
</div>
<div id="xarray-terminology" class="section level2">
<h2>XArray Terminology</h2>
<p>By convention, XArray is imported as <code>xr</code>. We use Xarray’s <code>open_dataset()</code> method to read the gridded raster. The result is a <code>xarray.Dataset</code> object.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> os.path.join(data_folder, filename)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>ds <span class="op">=</span> xr.open_dataset(file_path)</span></code></pre></div>
<p>The NetCDF file contains a grid of values for each month from 1880-2021 at a spatial resolution of 2 degrees. Let’s understand what is contained in a Dataset.</p>
<ul>
<li><em>Variables</em>: This is similar to a band in a raster dataset. We have 2 variables in this dataset: <code>tempanomany</code> and <code>time_bnds</code>. Each variable contains an array of values.</li>
<li><em>Dimensions</em>: This is similar to number of array axes. We have a 4-dimensional dataset. A 2D grid of pixels (<code>lat</code> and <code>lon</code>) at multiple time intervals <code>time</code> with multiple variables <code>nv</code>.</li>
<li><em>Coordinates</em>: These are the labels for values in each dimension. We have labels for <code>lat</code>, <code>lon</code> and <code>time</code>.</li>
<li><em>Attributes</em>: This is the metadata associated with the dataset.</li>
</ul>
<div class="sourceCode" id="cb78"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>ds</span></code></pre></div>
<div>
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs> <symbol id="icon-database" viewBox="0 0 32 32"> <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path> <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> </symbol> <symbol id="icon-file-text2" viewBox="0 0 32 32"> <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path> <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> </symbol> </defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style>
<pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:      (lat: 90, lon: 180, time: 1704, nv: 2)
Coordinates:
  * lat          (lat) float32 -89.0 -87.0 -85.0 -83.0 ... 83.0 85.0 87.0 89.0
  * lon          (lon) float32 -179.0 -177.0 -175.0 -173.0 ... 175.0 177.0 179.0
  * time         (time) datetime64[ns] 1880-01-15 1880-02-15 ... 2021-12-15
Dimensions without coordinates: nv
Data variables:
    time_bnds    (time, nv) datetime64[ns] 1880-01-01 1880-02-01 ... 2022-01-01
    tempanomaly  (time, lat, lon) float32 nan nan nan nan ... 3.65 3.65 3.65
Attributes:
    title:        GISTEMP Surface Temperature Analysis
    institution:  NASA Goddard Institute for Space Studies
    source:       http://data.giss.nasa.gov/gistemp/
    Conventions:  CF-1.6
    history:      Created 2022-01-11 09:09:58 by SBBX_to_nc 2.0 - ILAND=1200,...</pre>
<div class="xr-wrap" style="display:none">
<div class="xr-header">
<div class="xr-obj-type">
xarray.Dataset
</div>
</div>
<ul class="xr-sections">
<li class="xr-section-item">
<input id='section-15564195-83ab-46fb-8e6c-38ac96ac8781' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-15564195-83ab-46fb-8e6c-38ac96ac8781' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label>
<div class="xr-section-inline-details">
<ul class="xr-dim-list">
<li>
<span class="xr-has-index">lat</span>: 90
</li>
<li>
<span class="xr-has-index">lon</span>: 180
</li>
<li>
<span class="xr-has-index">time</span>: 1704
</li>
<li>
<span>nv</span>: 2
</li>
</ul>
</div>
<div class="xr-section-details">

</div>
</li>
<li class="xr-section-item">
<input id='section-3f56b7f0-a4d6-4284-a337-441620766d10' class='xr-section-summary-in' type='checkbox'  checked><label for='section-3f56b7f0-a4d6-4284-a337-441620766d10' class='xr-section-summary' >Coordinates: <span>(3)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<ul class="xr-var-list">
<li class="xr-var-item">
<div class="xr-var-name">
<span class="xr-has-index">lat</span>
</div>
<div class="xr-var-dims">
(lat)
</div>
<div class="xr-var-dtype">
float32
</div>
<div class="xr-var-preview xr-preview">
-89.0 -87.0 -85.0 … 87.0 89.0
</div>
<input id='attrs-c7f09cd3-c0a4-48eb-849b-95a53a9fa46e' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-c7f09cd3-c0a4-48eb-849b-95a53a9fa46e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6f4ade87-ceae-4860-b79a-8f8ac6fce58d' class='xr-var-data-in' type='checkbox'><label for='data-6f4ade87-ceae-4860-b79a-8f8ac6fce58d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
<dt>
<span>standard_name :</span>
</dt>
<dd>
latitude
</dd>
<dt>
<span>long_name :</span>
</dt>
<dd>
Latitude
</dd>
<dt>
<span>units :</span>
</dt>
<dd>
degrees_north
</dd>
</dl>
</div>
<div class="xr-var-data">
<pre>array([-89., -87., -85., -83., -81., -79., -77., -75., -73., -71., -69., -67.,
       -65., -63., -61., -59., -57., -55., -53., -51., -49., -47., -45., -43.,
       -41., -39., -37., -35., -33., -31., -29., -27., -25., -23., -21., -19.,
       -17., -15., -13., -11.,  -9.,  -7.,  -5.,  -3.,  -1.,   1.,   3.,   5.,
         7.,   9.,  11.,  13.,  15.,  17.,  19.,  21.,  23.,  25.,  27.,  29.,
        31.,  33.,  35.,  37.,  39.,  41.,  43.,  45.,  47.,  49.,  51.,  53.,
        55.,  57.,  59.,  61.,  63.,  65.,  67.,  69.,  71.,  73.,  75.,  77.,
        79.,  81.,  83.,  85.,  87.,  89.], dtype=float32)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span class="xr-has-index">lon</span>
</div>
<div class="xr-var-dims">
(lon)
</div>
<div class="xr-var-dtype">
float32
</div>
<div class="xr-var-preview xr-preview">
-179.0 -177.0 … 177.0 179.0
</div>
<input id='attrs-dbd99ccb-18d8-49f0-a730-0fe512a4f046' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-dbd99ccb-18d8-49f0-a730-0fe512a4f046' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8fd288cf-d6eb-4388-9a82-4c7c26a89a70' class='xr-var-data-in' type='checkbox'><label for='data-8fd288cf-d6eb-4388-9a82-4c7c26a89a70' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
<dt>
<span>standard_name :</span>
</dt>
<dd>
longitude
</dd>
<dt>
<span>long_name :</span>
</dt>
<dd>
Longitude
</dd>
<dt>
<span>units :</span>
</dt>
<dd>
degrees_east
</dd>
</dl>
</div>
<div class="xr-var-data">
<pre>array([-179., -177., -175., -173., -171., -169., -167., -165., -163., -161.,
       -159., -157., -155., -153., -151., -149., -147., -145., -143., -141.,
       -139., -137., -135., -133., -131., -129., -127., -125., -123., -121.,
       -119., -117., -115., -113., -111., -109., -107., -105., -103., -101.,
        -99.,  -97.,  -95.,  -93.,  -91.,  -89.,  -87.,  -85.,  -83.,  -81.,
        -79.,  -77.,  -75.,  -73.,  -71.,  -69.,  -67.,  -65.,  -63.,  -61.,
        -59.,  -57.,  -55.,  -53.,  -51.,  -49.,  -47.,  -45.,  -43.,  -41.,
        -39.,  -37.,  -35.,  -33.,  -31.,  -29.,  -27.,  -25.,  -23.,  -21.,
        -19.,  -17.,  -15.,  -13.,  -11.,   -9.,   -7.,   -5.,   -3.,   -1.,
          1.,    3.,    5.,    7.,    9.,   11.,   13.,   15.,   17.,   19.,
         21.,   23.,   25.,   27.,   29.,   31.,   33.,   35.,   37.,   39.,
         41.,   43.,   45.,   47.,   49.,   51.,   53.,   55.,   57.,   59.,
         61.,   63.,   65.,   67.,   69.,   71.,   73.,   75.,   77.,   79.,
         81.,   83.,   85.,   87.,   89.,   91.,   93.,   95.,   97.,   99.,
        101.,  103.,  105.,  107.,  109.,  111.,  113.,  115.,  117.,  119.,
        121.,  123.,  125.,  127.,  129.,  131.,  133.,  135.,  137.,  139.,
        141.,  143.,  145.,  147.,  149.,  151.,  153.,  155.,  157.,  159.,
        161.,  163.,  165.,  167.,  169.,  171.,  173.,  175.,  177.,  179.],
      dtype=float32)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span class="xr-has-index">time</span>
</div>
<div class="xr-var-dims">
(time)
</div>
<div class="xr-var-dtype">
datetime64[ns]
</div>
<div class="xr-var-preview xr-preview">
1880-01-15 … 2021-12-15
</div>
<input id='attrs-50eeaab8-c67b-4dcf-82a7-a9f60cf246f9' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-50eeaab8-c67b-4dcf-82a7-a9f60cf246f9' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-77ee55e3-8394-4595-abe4-1e12835d10f5' class='xr-var-data-in' type='checkbox'><label for='data-77ee55e3-8394-4595-abe4-1e12835d10f5' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
<dt>
<span>long_name :</span>
</dt>
<dd>
time
</dd>
<dt>
<span>bounds :</span>
</dt>
<dd>
time_bnds
</dd>
</dl>
</div>
<div class="xr-var-data">
<pre>array([&#x27;1880-01-15T00:00:00.000000000&#x27;, &#x27;1880-02-15T00:00:00.000000000&#x27;,
       &#x27;1880-03-15T00:00:00.000000000&#x27;, ..., &#x27;2021-10-15T00:00:00.000000000&#x27;,
       &#x27;2021-11-15T00:00:00.000000000&#x27;, &#x27;2021-12-15T00:00:00.000000000&#x27;],
      dtype=&#x27;datetime64[ns]&#x27;)</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="xr-section-item">
<input id='section-71ff647c-b18d-4331-9438-ea1947bd9c2c' class='xr-section-summary-in' type='checkbox'  checked><label for='section-71ff647c-b18d-4331-9438-ea1947bd9c2c' class='xr-section-summary' >Data variables: <span>(2)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<ul class="xr-var-list">
<li class="xr-var-item">
<div class="xr-var-name">
<span>time_bnds</span>
</div>
<div class="xr-var-dims">
(time, nv)
</div>
<div class="xr-var-dtype">
datetime64[ns]
</div>
<div class="xr-var-preview xr-preview">
1880-01-01 … 2022-01-01
</div>
<input id='attrs-39f4d426-a6ff-423e-b400-3f2413b06ff2' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-39f4d426-a6ff-423e-b400-3f2413b06ff2' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5e357f03-35a0-4a14-9874-08023136ea1a' class='xr-var-data-in' type='checkbox'><label for='data-5e357f03-35a0-4a14-9874-08023136ea1a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array([[&#x27;1880-01-01T00:00:00.000000000&#x27;, &#x27;1880-02-01T00:00:00.000000000&#x27;],
       [&#x27;1880-02-01T00:00:00.000000000&#x27;, &#x27;1880-03-01T00:00:00.000000000&#x27;],
       [&#x27;1880-03-01T00:00:00.000000000&#x27;, &#x27;1880-04-01T00:00:00.000000000&#x27;],
       ...,
       [&#x27;2021-10-01T00:00:00.000000000&#x27;, &#x27;2021-11-01T00:00:00.000000000&#x27;],
       [&#x27;2021-11-01T00:00:00.000000000&#x27;, &#x27;2021-12-01T00:00:00.000000000&#x27;],
       [&#x27;2021-12-01T00:00:00.000000000&#x27;, &#x27;2022-01-01T00:00:00.000000000&#x27;]],
      dtype=&#x27;datetime64[ns]&#x27;)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>tempanomaly</span>
</div>
<div class="xr-var-dims">
(time, lat, lon)
</div>
<div class="xr-var-dtype">
float32
</div>
<div class="xr-var-preview xr-preview">
nan nan nan nan … 3.65 3.65 3.65
</div>
<input id='attrs-406afdf6-8a88-4fcf-9fd4-658f53ff1df3' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-406afdf6-8a88-4fcf-9fd4-658f53ff1df3' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a09e5264-eca3-40ce-b9ca-226ef4250cc0' class='xr-var-data-in' type='checkbox'><label for='data-a09e5264-eca3-40ce-b9ca-226ef4250cc0' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
<dt>
<span>long_name :</span>
</dt>
<dd>
Surface temperature anomaly
</dd>
<dt>
<span>units :</span>
</dt>
<dd>
K
</dd>
<dt>
<span>cell_methods :</span>
</dt>
<dd>
time: mean
</dd>
</dl>
</div>
<div class="xr-var-data">
<pre>array([[[  nan,   nan, ...,   nan,   nan],
        [  nan,   nan, ...,   nan,   nan],
        ...,
        [  nan,   nan, ...,   nan,   nan],
        [  nan,   nan, ...,   nan,   nan]],

       [[  nan,   nan, ...,   nan,   nan],
        [  nan,   nan, ...,   nan,   nan],
        ...,
        [  nan,   nan, ...,   nan,   nan],
        [  nan,   nan, ...,   nan,   nan]],

       ...,

       [[ 0.34,  0.34, ...,  0.34,  0.34],
        [ 0.34,  0.34, ...,  0.34,  0.34],
        ...,
        [ 2.71,  2.71, ...,  2.71,  2.71],
        [ 2.71,  2.71, ...,  2.71,  2.71]],

       [[-0.02, -0.02, ..., -0.02, -0.02],
        [-0.02, -0.02, ..., -0.02, -0.02],
        ...,
        [ 3.65,  3.65, ...,  3.65,  3.65],
        [ 3.65,  3.65, ...,  3.65,  3.65]]], dtype=float32)</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="xr-section-item">
<input id='section-8c62b4c6-b158-4482-8900-b21a5a88e1de' class='xr-section-summary-in' type='checkbox'  checked><label for='section-8c62b4c6-b158-4482-8900-b21a5a88e1de' class='xr-section-summary' >Attributes: <span>(5)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<dl class="xr-attrs">
<dt>
<span>title :</span>
</dt>
<dd>
GISTEMP Surface Temperature Analysis
</dd>
<dt>
<span>institution :</span>
</dt>
<dd>
NASA Goddard Institute for Space Studies
</dd>
<dt>
<span>source :</span>
</dt>
<dd>
<a href="http://data.giss.nasa.gov/gistemp/" class="uri">http://data.giss.nasa.gov/gistemp/</a>
</dd>
<dt>
<span>Conventions :</span>
</dt>
<dd>
CF-1.6
</dd>
<dt>
<span>history :</span>
</dt>
<dd>
Created 2022-01-11 09:09:58 by SBBX_to_nc 2.0 - ILAND=1200, IOCEAN=NCDC/ER5, Base: 1951-1980
</dd>
</dl>
</div>
</li>
</ul>
</div>
</div>
<p>A Dataset consists of one or more <code>xarray.DataArray</code> object. This is the main object that consists of a single variable with dimension names, coordinates and attributes. You can access each variable using <code>dataset.variable_name</code> syntax.</p>
<p>Let’s see the <code>time_bnds</code> variable. This contains a 2d array which has both a starting and ending time for each one averaging period.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>ds.time_bnds</span></code></pre></div>
<div>
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs> <symbol id="icon-database" viewBox="0 0 32 32"> <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path> <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> </symbol> <symbol id="icon-file-text2" viewBox="0 0 32 32"> <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path> <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> </symbol> </defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style>
<pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;time_bnds&#x27; (time: 1704, nv: 2)&gt;
array([[&#x27;1880-01-01T00:00:00.000000000&#x27;, &#x27;1880-02-01T00:00:00.000000000&#x27;],
       [&#x27;1880-02-01T00:00:00.000000000&#x27;, &#x27;1880-03-01T00:00:00.000000000&#x27;],
       [&#x27;1880-03-01T00:00:00.000000000&#x27;, &#x27;1880-04-01T00:00:00.000000000&#x27;],
       ...,
       [&#x27;2021-10-01T00:00:00.000000000&#x27;, &#x27;2021-11-01T00:00:00.000000000&#x27;],
       [&#x27;2021-11-01T00:00:00.000000000&#x27;, &#x27;2021-12-01T00:00:00.000000000&#x27;],
       [&#x27;2021-12-01T00:00:00.000000000&#x27;, &#x27;2022-01-01T00:00:00.000000000&#x27;]],
      dtype=&#x27;datetime64[ns]&#x27;)
Coordinates:
  * time     (time) datetime64[ns] 1880-01-15 1880-02-15 ... 2021-12-15
Dimensions without coordinates: nv</pre>
<div class="xr-wrap" style="display:none">
<div class="xr-header">
<div class="xr-obj-type">
xarray.DataArray
</div>
<div class="xr-array-name">
‘time_bnds’
</div>
<ul class="xr-dim-list">
<li>
<span class="xr-has-index">time</span>: 1704
</li>
<li>
<span>nv</span>: 2
</li>
</ul>
</div>
<ul class="xr-sections">
<li class="xr-section-item">
<div class="xr-array-wrap">
<input id='section-c3943444-7ac6-4017-9538-7da484ccb52e' class='xr-array-in' type='checkbox' checked><label for='section-c3943444-7ac6-4017-9538-7da484ccb52e' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-array-preview xr-preview">
<span>1880-01-01 1880-02-01 1880-02-01 … 2021-12-01 2021-12-01 2022-01-01</span>
</div>
<div class="xr-array-data">
<pre>array([[&#x27;1880-01-01T00:00:00.000000000&#x27;, &#x27;1880-02-01T00:00:00.000000000&#x27;],
       [&#x27;1880-02-01T00:00:00.000000000&#x27;, &#x27;1880-03-01T00:00:00.000000000&#x27;],
       [&#x27;1880-03-01T00:00:00.000000000&#x27;, &#x27;1880-04-01T00:00:00.000000000&#x27;],
       ...,
       [&#x27;2021-10-01T00:00:00.000000000&#x27;, &#x27;2021-11-01T00:00:00.000000000&#x27;],
       [&#x27;2021-11-01T00:00:00.000000000&#x27;, &#x27;2021-12-01T00:00:00.000000000&#x27;],
       [&#x27;2021-12-01T00:00:00.000000000&#x27;, &#x27;2022-01-01T00:00:00.000000000&#x27;]],
      dtype=&#x27;datetime64[ns]&#x27;)</pre>
</div>
</div>
</li>
<li class="xr-section-item">
<input id='section-c96ac15a-b91a-445e-8fa9-f3baaeef6107' class='xr-section-summary-in' type='checkbox'  checked><label for='section-c96ac15a-b91a-445e-8fa9-f3baaeef6107' class='xr-section-summary' >Coordinates: <span>(1)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<ul class="xr-var-list">
<li class="xr-var-item">
<div class="xr-var-name">
<span class="xr-has-index">time</span>
</div>
<div class="xr-var-dims">
(time)
</div>
<div class="xr-var-dtype">
datetime64[ns]
</div>
<div class="xr-var-preview xr-preview">
1880-01-15 … 2021-12-15
</div>
<input id='attrs-4b702b7f-c5df-4e4b-ae71-6030e0bf1271' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-4b702b7f-c5df-4e4b-ae71-6030e0bf1271' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f737e73b-cd05-4289-a95f-4d1d7478f647' class='xr-var-data-in' type='checkbox'><label for='data-f737e73b-cd05-4289-a95f-4d1d7478f647' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
<dt>
<span>long_name :</span>
</dt>
<dd>
time
</dd>
<dt>
<span>bounds :</span>
</dt>
<dd>
time_bnds
</dd>
</dl>
</div>
<div class="xr-var-data">
<pre>array([&#x27;1880-01-15T00:00:00.000000000&#x27;, &#x27;1880-02-15T00:00:00.000000000&#x27;,
       &#x27;1880-03-15T00:00:00.000000000&#x27;, ..., &#x27;2021-10-15T00:00:00.000000000&#x27;,
       &#x27;2021-11-15T00:00:00.000000000&#x27;, &#x27;2021-12-15T00:00:00.000000000&#x27;],
      dtype=&#x27;datetime64[ns]&#x27;)</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="xr-section-item">
<input id='section-0804fc68-d038-4b91-8457-4d2bab870529' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-0804fc68-d038-4b91-8457-4d2bab870529' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<dl class="xr-attrs">
</dl>
</div>
</li>
</ul>
</div>
</div>
<p>The main variable of interest is = <code>tempanomaly</code> - containing the grid of temperature anomaly values at different times. Let’s select that variable and store it as <code>da</code>.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>da <span class="op">=</span> ds.tempanomaly</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>da</span></code></pre></div>
<div>
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs> <symbol id="icon-database" viewBox="0 0 32 32"> <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path> <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> </symbol> <symbol id="icon-file-text2" viewBox="0 0 32 32"> <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path> <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> </symbol> </defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style>
<pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;tempanomaly&#x27; (time: 1704, lat: 90, lon: 180)&gt;
[27604800 values with dtype=float32]
Coordinates:
  * lat      (lat) float32 -89.0 -87.0 -85.0 -83.0 -81.0 ... 83.0 85.0 87.0 89.0
  * lon      (lon) float32 -179.0 -177.0 -175.0 -173.0 ... 175.0 177.0 179.0
  * time     (time) datetime64[ns] 1880-01-15 1880-02-15 ... 2021-12-15
Attributes:
    long_name:     Surface temperature anomaly
    units:         K
    cell_methods:  time: mean</pre>
<div class="xr-wrap" style="display:none">
<div class="xr-header">
<div class="xr-obj-type">
xarray.DataArray
</div>
<div class="xr-array-name">
‘tempanomaly’
</div>
<ul class="xr-dim-list">
<li>
<span class="xr-has-index">time</span>: 1704
</li>
<li>
<span class="xr-has-index">lat</span>: 90
</li>
<li>
<span class="xr-has-index">lon</span>: 180
</li>
</ul>
</div>
<ul class="xr-sections">
<li class="xr-section-item">
<div class="xr-array-wrap">
<input id='section-c2394bfd-9996-412c-9f7d-4e87ab15eb19' class='xr-array-in' type='checkbox' checked><label for='section-c2394bfd-9996-412c-9f7d-4e87ab15eb19' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-array-preview xr-preview">
<span>…</span>
</div>
<div class="xr-array-data">
<pre>[27604800 values with dtype=float32]</pre>
</div>
</div>
</li>
<li class="xr-section-item">
<input id='section-b4071c72-b131-4efa-a4ba-920288df0c12' class='xr-section-summary-in' type='checkbox'  checked><label for='section-b4071c72-b131-4efa-a4ba-920288df0c12' class='xr-section-summary' >Coordinates: <span>(3)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<ul class="xr-var-list">
<li class="xr-var-item">
<div class="xr-var-name">
<span class="xr-has-index">lat</span>
</div>
<div class="xr-var-dims">
(lat)
</div>
<div class="xr-var-dtype">
float32
</div>
<div class="xr-var-preview xr-preview">
-89.0 -87.0 -85.0 … 87.0 89.0
</div>
<input id='attrs-5a75db03-87eb-4c6f-860f-2931669f3671' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-5a75db03-87eb-4c6f-860f-2931669f3671' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e970bf24-b62a-414b-aa0d-dbdd6c668f4d' class='xr-var-data-in' type='checkbox'><label for='data-e970bf24-b62a-414b-aa0d-dbdd6c668f4d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
<dt>
<span>standard_name :</span>
</dt>
<dd>
latitude
</dd>
<dt>
<span>long_name :</span>
</dt>
<dd>
Latitude
</dd>
<dt>
<span>units :</span>
</dt>
<dd>
degrees_north
</dd>
</dl>
</div>
<div class="xr-var-data">
<pre>array([-89., -87., -85., -83., -81., -79., -77., -75., -73., -71., -69., -67.,
       -65., -63., -61., -59., -57., -55., -53., -51., -49., -47., -45., -43.,
       -41., -39., -37., -35., -33., -31., -29., -27., -25., -23., -21., -19.,
       -17., -15., -13., -11.,  -9.,  -7.,  -5.,  -3.,  -1.,   1.,   3.,   5.,
         7.,   9.,  11.,  13.,  15.,  17.,  19.,  21.,  23.,  25.,  27.,  29.,
        31.,  33.,  35.,  37.,  39.,  41.,  43.,  45.,  47.,  49.,  51.,  53.,
        55.,  57.,  59.,  61.,  63.,  65.,  67.,  69.,  71.,  73.,  75.,  77.,
        79.,  81.,  83.,  85.,  87.,  89.], dtype=float32)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span class="xr-has-index">lon</span>
</div>
<div class="xr-var-dims">
(lon)
</div>
<div class="xr-var-dtype">
float32
</div>
<div class="xr-var-preview xr-preview">
-179.0 -177.0 … 177.0 179.0
</div>
<input id='attrs-ac251c17-239d-4379-8f0a-8abceb5670ef' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-ac251c17-239d-4379-8f0a-8abceb5670ef' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a693c692-48da-4391-92ec-363392e86280' class='xr-var-data-in' type='checkbox'><label for='data-a693c692-48da-4391-92ec-363392e86280' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
<dt>
<span>standard_name :</span>
</dt>
<dd>
longitude
</dd>
<dt>
<span>long_name :</span>
</dt>
<dd>
Longitude
</dd>
<dt>
<span>units :</span>
</dt>
<dd>
degrees_east
</dd>
</dl>
</div>
<div class="xr-var-data">
<pre>array([-179., -177., -175., -173., -171., -169., -167., -165., -163., -161.,
       -159., -157., -155., -153., -151., -149., -147., -145., -143., -141.,
       -139., -137., -135., -133., -131., -129., -127., -125., -123., -121.,
       -119., -117., -115., -113., -111., -109., -107., -105., -103., -101.,
        -99.,  -97.,  -95.,  -93.,  -91.,  -89.,  -87.,  -85.,  -83.,  -81.,
        -79.,  -77.,  -75.,  -73.,  -71.,  -69.,  -67.,  -65.,  -63.,  -61.,
        -59.,  -57.,  -55.,  -53.,  -51.,  -49.,  -47.,  -45.,  -43.,  -41.,
        -39.,  -37.,  -35.,  -33.,  -31.,  -29.,  -27.,  -25.,  -23.,  -21.,
        -19.,  -17.,  -15.,  -13.,  -11.,   -9.,   -7.,   -5.,   -3.,   -1.,
          1.,    3.,    5.,    7.,    9.,   11.,   13.,   15.,   17.,   19.,
         21.,   23.,   25.,   27.,   29.,   31.,   33.,   35.,   37.,   39.,
         41.,   43.,   45.,   47.,   49.,   51.,   53.,   55.,   57.,   59.,
         61.,   63.,   65.,   67.,   69.,   71.,   73.,   75.,   77.,   79.,
         81.,   83.,   85.,   87.,   89.,   91.,   93.,   95.,   97.,   99.,
        101.,  103.,  105.,  107.,  109.,  111.,  113.,  115.,  117.,  119.,
        121.,  123.,  125.,  127.,  129.,  131.,  133.,  135.,  137.,  139.,
        141.,  143.,  145.,  147.,  149.,  151.,  153.,  155.,  157.,  159.,
        161.,  163.,  165.,  167.,  169.,  171.,  173.,  175.,  177.,  179.],
      dtype=float32)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span class="xr-has-index">time</span>
</div>
<div class="xr-var-dims">
(time)
</div>
<div class="xr-var-dtype">
datetime64[ns]
</div>
<div class="xr-var-preview xr-preview">
1880-01-15 … 2021-12-15
</div>
<input id='attrs-cc2cfa74-e1a5-46c0-94bc-dcd890b1c350' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-cc2cfa74-e1a5-46c0-94bc-dcd890b1c350' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7334574f-056e-4861-a42d-6646ad574a8a' class='xr-var-data-in' type='checkbox'><label for='data-7334574f-056e-4861-a42d-6646ad574a8a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
<dt>
<span>long_name :</span>
</dt>
<dd>
time
</dd>
<dt>
<span>bounds :</span>
</dt>
<dd>
time_bnds
</dd>
</dl>
</div>
<div class="xr-var-data">
<pre>array([&#x27;1880-01-15T00:00:00.000000000&#x27;, &#x27;1880-02-15T00:00:00.000000000&#x27;,
       &#x27;1880-03-15T00:00:00.000000000&#x27;, ..., &#x27;2021-10-15T00:00:00.000000000&#x27;,
       &#x27;2021-11-15T00:00:00.000000000&#x27;, &#x27;2021-12-15T00:00:00.000000000&#x27;],
      dtype=&#x27;datetime64[ns]&#x27;)</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="xr-section-item">
<input id='section-697eeca7-0ecf-4140-b87a-f8932112fa6c' class='xr-section-summary-in' type='checkbox'  checked><label for='section-697eeca7-0ecf-4140-b87a-f8932112fa6c' class='xr-section-summary' >Attributes: <span>(3)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<dl class="xr-attrs">
<dt>
<span>long_name :</span>
</dt>
<dd>
Surface temperature anomaly
</dd>
<dt>
<span>units :</span>
</dt>
<dd>
K
</dd>
<dt>
<span>cell_methods :</span>
</dt>
<dd>
time: mean
</dd>
</dl>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="selecting-data" class="section level2">
<h2>Selecting Data</h2>
<p>XArray provides a very powerful way to select subsets of data, using similar framework as Pandas. Similar to Panda’s <code>loc</code> and <code>iloc</code> methods, XArray provides <code>sel</code> and <code>isel</code> methods. Since DataArray dimensions have names, these methods allow you to specify which dimension to query.</p>
<p>Let’s select the temperature anomany values for the last time step. Since we know the index (-1) of the datam we can use <code>isel</code> method.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>da.isel(time<span class="op">=-</span><span class="dv">1</span>)</span></code></pre></div>
<div>
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs> <symbol id="icon-database" viewBox="0 0 32 32"> <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path> <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> </symbol> <symbol id="icon-file-text2" viewBox="0 0 32 32"> <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path> <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> </symbol> </defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style>
<pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;tempanomaly&#x27; (lat: 90, lon: 180)&gt;
array([[-0.02, -0.02, -0.02, ..., -0.02, -0.02, -0.02],
       [-0.02, -0.02, -0.02, ..., -0.02, -0.02, -0.02],
       [-0.02, -0.02, -0.02, ..., -0.02, -0.02, -0.02],
       ...,
       [ 3.65,  3.65,  3.65, ...,  3.65,  3.65,  3.65],
       [ 3.65,  3.65,  3.65, ...,  3.65,  3.65,  3.65],
       [ 3.65,  3.65,  3.65, ...,  3.65,  3.65,  3.65]], dtype=float32)
Coordinates:
  * lat      (lat) float32 -89.0 -87.0 -85.0 -83.0 -81.0 ... 83.0 85.0 87.0 89.0
  * lon      (lon) float32 -179.0 -177.0 -175.0 -173.0 ... 175.0 177.0 179.0
    time     datetime64[ns] 2021-12-15
Attributes:
    long_name:     Surface temperature anomaly
    units:         K
    cell_methods:  time: mean</pre>
<div class="xr-wrap" style="display:none">
<div class="xr-header">
<div class="xr-obj-type">
xarray.DataArray
</div>
<div class="xr-array-name">
‘tempanomaly’
</div>
<ul class="xr-dim-list">
<li>
<span class="xr-has-index">lat</span>: 90
</li>
<li>
<span class="xr-has-index">lon</span>: 180
</li>
</ul>
</div>
<ul class="xr-sections">
<li class="xr-section-item">
<div class="xr-array-wrap">
<input id='section-71d7eaf4-0e4a-4a89-9343-94bc652970f9' class='xr-array-in' type='checkbox' checked><label for='section-71d7eaf4-0e4a-4a89-9343-94bc652970f9' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-array-preview xr-preview">
<span>-0.02 -0.02 -0.02 -0.02 -0.02 -0.02 … 3.65 3.65 3.65 3.65 3.65 3.65</span>
</div>
<div class="xr-array-data">
<pre>array([[-0.02, -0.02, -0.02, ..., -0.02, -0.02, -0.02],
       [-0.02, -0.02, -0.02, ..., -0.02, -0.02, -0.02],
       [-0.02, -0.02, -0.02, ..., -0.02, -0.02, -0.02],
       ...,
       [ 3.65,  3.65,  3.65, ...,  3.65,  3.65,  3.65],
       [ 3.65,  3.65,  3.65, ...,  3.65,  3.65,  3.65],
       [ 3.65,  3.65,  3.65, ...,  3.65,  3.65,  3.65]], dtype=float32)</pre>
</div>
</div>
</li>
<li class="xr-section-item">
<input id='section-38a2291b-0536-40b9-81f4-ff565cc3f8d8' class='xr-section-summary-in' type='checkbox'  checked><label for='section-38a2291b-0536-40b9-81f4-ff565cc3f8d8' class='xr-section-summary' >Coordinates: <span>(3)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<ul class="xr-var-list">
<li class="xr-var-item">
<div class="xr-var-name">
<span class="xr-has-index">lat</span>
</div>
<div class="xr-var-dims">
(lat)
</div>
<div class="xr-var-dtype">
float32
</div>
<div class="xr-var-preview xr-preview">
-89.0 -87.0 -85.0 … 87.0 89.0
</div>
<input id='attrs-4952f403-ba25-4301-8af0-e2161a12b46e' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-4952f403-ba25-4301-8af0-e2161a12b46e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a7cb4280-0832-4cb4-8d61-f9336a38adbb' class='xr-var-data-in' type='checkbox'><label for='data-a7cb4280-0832-4cb4-8d61-f9336a38adbb' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
<dt>
<span>standard_name :</span>
</dt>
<dd>
latitude
</dd>
<dt>
<span>long_name :</span>
</dt>
<dd>
Latitude
</dd>
<dt>
<span>units :</span>
</dt>
<dd>
degrees_north
</dd>
</dl>
</div>
<div class="xr-var-data">
<pre>array([-89., -87., -85., -83., -81., -79., -77., -75., -73., -71., -69., -67.,
       -65., -63., -61., -59., -57., -55., -53., -51., -49., -47., -45., -43.,
       -41., -39., -37., -35., -33., -31., -29., -27., -25., -23., -21., -19.,
       -17., -15., -13., -11.,  -9.,  -7.,  -5.,  -3.,  -1.,   1.,   3.,   5.,
         7.,   9.,  11.,  13.,  15.,  17.,  19.,  21.,  23.,  25.,  27.,  29.,
        31.,  33.,  35.,  37.,  39.,  41.,  43.,  45.,  47.,  49.,  51.,  53.,
        55.,  57.,  59.,  61.,  63.,  65.,  67.,  69.,  71.,  73.,  75.,  77.,
        79.,  81.,  83.,  85.,  87.,  89.], dtype=float32)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span class="xr-has-index">lon</span>
</div>
<div class="xr-var-dims">
(lon)
</div>
<div class="xr-var-dtype">
float32
</div>
<div class="xr-var-preview xr-preview">
-179.0 -177.0 … 177.0 179.0
</div>
<input id='attrs-c2ffc062-7df3-45e8-a926-f21336e82876' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-c2ffc062-7df3-45e8-a926-f21336e82876' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f78af5fa-8c4b-41fe-82a8-eb0213909b1f' class='xr-var-data-in' type='checkbox'><label for='data-f78af5fa-8c4b-41fe-82a8-eb0213909b1f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
<dt>
<span>standard_name :</span>
</dt>
<dd>
longitude
</dd>
<dt>
<span>long_name :</span>
</dt>
<dd>
Longitude
</dd>
<dt>
<span>units :</span>
</dt>
<dd>
degrees_east
</dd>
</dl>
</div>
<div class="xr-var-data">
<pre>array([-179., -177., -175., -173., -171., -169., -167., -165., -163., -161.,
       -159., -157., -155., -153., -151., -149., -147., -145., -143., -141.,
       -139., -137., -135., -133., -131., -129., -127., -125., -123., -121.,
       -119., -117., -115., -113., -111., -109., -107., -105., -103., -101.,
        -99.,  -97.,  -95.,  -93.,  -91.,  -89.,  -87.,  -85.,  -83.,  -81.,
        -79.,  -77.,  -75.,  -73.,  -71.,  -69.,  -67.,  -65.,  -63.,  -61.,
        -59.,  -57.,  -55.,  -53.,  -51.,  -49.,  -47.,  -45.,  -43.,  -41.,
        -39.,  -37.,  -35.,  -33.,  -31.,  -29.,  -27.,  -25.,  -23.,  -21.,
        -19.,  -17.,  -15.,  -13.,  -11.,   -9.,   -7.,   -5.,   -3.,   -1.,
          1.,    3.,    5.,    7.,    9.,   11.,   13.,   15.,   17.,   19.,
         21.,   23.,   25.,   27.,   29.,   31.,   33.,   35.,   37.,   39.,
         41.,   43.,   45.,   47.,   49.,   51.,   53.,   55.,   57.,   59.,
         61.,   63.,   65.,   67.,   69.,   71.,   73.,   75.,   77.,   79.,
         81.,   83.,   85.,   87.,   89.,   91.,   93.,   95.,   97.,   99.,
        101.,  103.,  105.,  107.,  109.,  111.,  113.,  115.,  117.,  119.,
        121.,  123.,  125.,  127.,  129.,  131.,  133.,  135.,  137.,  139.,
        141.,  143.,  145.,  147.,  149.,  151.,  153.,  155.,  157.,  159.,
        161.,  163.,  165.,  167.,  169.,  171.,  173.,  175.,  177.,  179.],
      dtype=float32)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>time</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
datetime64[ns]
</div>
<div class="xr-var-preview xr-preview">
2021-12-15
</div>
<input id='attrs-440df742-7aae-4abd-940d-4a9682305ca1' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-440df742-7aae-4abd-940d-4a9682305ca1' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-72ef69bf-7d9c-4b92-b607-b465f6106120' class='xr-var-data-in' type='checkbox'><label for='data-72ef69bf-7d9c-4b92-b607-b465f6106120' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
<dt>
<span>long_name :</span>
</dt>
<dd>
time
</dd>
<dt>
<span>bounds :</span>
</dt>
<dd>
time_bnds
</dd>
</dl>
</div>
<div class="xr-var-data">
<pre>array(&#x27;2021-12-15T00:00:00.000000000&#x27;, dtype=&#x27;datetime64[ns]&#x27;)</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="xr-section-item">
<input id='section-994ae25d-0182-4025-a1fb-89326277bfd0' class='xr-section-summary-in' type='checkbox'  checked><label for='section-994ae25d-0182-4025-a1fb-89326277bfd0' class='xr-section-summary' >Attributes: <span>(3)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<dl class="xr-attrs">
<dt>
<span>long_name :</span>
</dt>
<dd>
Surface temperature anomaly
</dd>
<dt>
<span>units :</span>
</dt>
<dd>
K
</dd>
<dt>
<span>cell_methods :</span>
</dt>
<dd>
time: mean
</dd>
</dl>
</div>
</li>
</ul>
</div>
</div>
<p>We can also specify a value to query using the <code>sel()</code> method.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>da.sel(time<span class="op">=</span><span class="st">&#39;2021-12-15&#39;</span>)</span></code></pre></div>
<p>We can specify multiple dimensions to query for a subset. Let’s extract the temperature anomaly at <code>lat=49</code>, <code>lon=-123</code> and <code>time='2021-06-15'</code>. This region experienced abnormally high temperatures in June 2021.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>da.sel(lat<span class="op">=</span><span class="dv">49</span>, lon<span class="op">=-</span><span class="dv">123</span>, time<span class="op">=</span><span class="st">&#39;2021-06-15&#39;</span>)</span></code></pre></div>
<div>
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs> <symbol id="icon-database" viewBox="0 0 32 32"> <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path> <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> </symbol> <symbol id="icon-file-text2" viewBox="0 0 32 32"> <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path> <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> </symbol> </defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style>
<pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;tempanomaly&#x27; ()&gt;
array(3.86, dtype=float32)
Coordinates:
    lat      float32 49.0
    lon      float32 -123.0
    time     datetime64[ns] 2021-06-15
Attributes:
    long_name:     Surface temperature anomaly
    units:         K
    cell_methods:  time: mean</pre>
<div class="xr-wrap" style="display:none">
<div class="xr-header">
<div class="xr-obj-type">
xarray.DataArray
</div>
<div class="xr-array-name">
‘tempanomaly’
</div>
</div>
<ul class="xr-sections">
<li class="xr-section-item">
<div class="xr-array-wrap">
<input id='section-66d1a7d9-53bb-4a18-af97-92b101ac9001' class='xr-array-in' type='checkbox' checked><label for='section-66d1a7d9-53bb-4a18-af97-92b101ac9001' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-array-preview xr-preview">
<span>3.86</span>
</div>
<div class="xr-array-data">
<pre>array(3.86, dtype=float32)</pre>
</div>
</div>
</li>
<li class="xr-section-item">
<input id='section-50e0dd59-30fd-419b-917d-aef3ce91093f' class='xr-section-summary-in' type='checkbox'  checked><label for='section-50e0dd59-30fd-419b-917d-aef3ce91093f' class='xr-section-summary' >Coordinates: <span>(3)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<ul class="xr-var-list">
<li class="xr-var-item">
<div class="xr-var-name">
<span>lat</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
float32
</div>
<div class="xr-var-preview xr-preview">
49.0
</div>
<input id='attrs-cc6b6113-aa3e-461d-8e55-6b1a9b4b664d' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-cc6b6113-aa3e-461d-8e55-6b1a9b4b664d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-303757ca-fe1c-413f-9faf-77b34933ec4c' class='xr-var-data-in' type='checkbox'><label for='data-303757ca-fe1c-413f-9faf-77b34933ec4c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
<dt>
<span>standard_name :</span>
</dt>
<dd>
latitude
</dd>
<dt>
<span>long_name :</span>
</dt>
<dd>
Latitude
</dd>
<dt>
<span>units :</span>
</dt>
<dd>
degrees_north
</dd>
</dl>
</div>
<div class="xr-var-data">
<pre>array(49., dtype=float32)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>lon</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
float32
</div>
<div class="xr-var-preview xr-preview">
-123.0
</div>
<input id='attrs-7e22d92c-847b-4b8d-a32f-5aae14afa159' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-7e22d92c-847b-4b8d-a32f-5aae14afa159' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-65e07261-1694-4887-8743-74964e791a9f' class='xr-var-data-in' type='checkbox'><label for='data-65e07261-1694-4887-8743-74964e791a9f' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
<dt>
<span>standard_name :</span>
</dt>
<dd>
longitude
</dd>
<dt>
<span>long_name :</span>
</dt>
<dd>
Longitude
</dd>
<dt>
<span>units :</span>
</dt>
<dd>
degrees_east
</dd>
</dl>
</div>
<div class="xr-var-data">
<pre>array(-123., dtype=float32)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>time</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
datetime64[ns]
</div>
<div class="xr-var-preview xr-preview">
2021-06-15
</div>
<input id='attrs-26484592-af37-45c0-b2ed-0d1ce5f5d700' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-26484592-af37-45c0-b2ed-0d1ce5f5d700' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-0e1aa5fb-028d-402a-901e-31ae64055f08' class='xr-var-data-in' type='checkbox'><label for='data-0e1aa5fb-028d-402a-901e-31ae64055f08' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
<dt>
<span>long_name :</span>
</dt>
<dd>
time
</dd>
<dt>
<span>bounds :</span>
</dt>
<dd>
time_bnds
</dd>
</dl>
</div>
<div class="xr-var-data">
<pre>array(&#x27;2021-06-15T00:00:00.000000000&#x27;, dtype=&#x27;datetime64[ns]&#x27;)</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="xr-section-item">
<input id='section-0c3d4244-912a-43c7-93de-c62c5d0f59d6' class='xr-section-summary-in' type='checkbox'  checked><label for='section-0c3d4244-912a-43c7-93de-c62c5d0f59d6' class='xr-section-summary' >Attributes: <span>(3)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<dl class="xr-attrs">
<dt>
<span>long_name :</span>
</dt>
<dd>
Surface temperature anomaly
</dd>
<dt>
<span>units :</span>
</dt>
<dd>
K
</dd>
<dt>
<span>cell_methods :</span>
</dt>
<dd>
time: mean
</dd>
</dl>
</div>
</li>
</ul>
</div>
</div>
<p>The <code>sel()</code> method also support nearest neighbor lookups. This is useful when you do not know the exact label of the dimension, but want to find the closest one.</p>
<blockquote>
<p>Tip: You can use <code>interp()</code> instead of <code>sel()</code> to interpolate the value instead of closest lookup.</p>
</blockquote>
<div class="sourceCode" id="cb84"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>da.sel(lat<span class="op">=</span><span class="fl">28.6</span>, lon<span class="op">=</span><span class="fl">77.2</span>, time<span class="op">=</span><span class="st">&#39;2021-05-01&#39;</span>, method<span class="op">=</span><span class="st">&#39;nearest&#39;</span>)</span></code></pre></div>
<div>
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs> <symbol id="icon-database" viewBox="0 0 32 32"> <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path> <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> </symbol> <symbol id="icon-file-text2" viewBox="0 0 32 32"> <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path> <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> </symbol> </defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style>
<pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;tempanomaly&#x27; ()&gt;
array(-0.76, dtype=float32)
Coordinates:
    lat      float32 29.0
    lon      float32 77.0
    time     datetime64[ns] 2021-05-15
Attributes:
    long_name:     Surface temperature anomaly
    units:         K
    cell_methods:  time: mean</pre>
<div class="xr-wrap" style="display:none">
<div class="xr-header">
<div class="xr-obj-type">
xarray.DataArray
</div>
<div class="xr-array-name">
‘tempanomaly’
</div>
</div>
<ul class="xr-sections">
<li class="xr-section-item">
<div class="xr-array-wrap">
<input id='section-be367caa-f6e4-4a36-9a23-89f0182ec58e' class='xr-array-in' type='checkbox' checked><label for='section-be367caa-f6e4-4a36-9a23-89f0182ec58e' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-array-preview xr-preview">
<span>-0.76</span>
</div>
<div class="xr-array-data">
<pre>array(-0.76, dtype=float32)</pre>
</div>
</div>
</li>
<li class="xr-section-item">
<input id='section-c9d87e68-bd69-4148-a6c6-7a04bb181657' class='xr-section-summary-in' type='checkbox'  checked><label for='section-c9d87e68-bd69-4148-a6c6-7a04bb181657' class='xr-section-summary' >Coordinates: <span>(3)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<ul class="xr-var-list">
<li class="xr-var-item">
<div class="xr-var-name">
<span>lat</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
float32
</div>
<div class="xr-var-preview xr-preview">
29.0
</div>
<input id='attrs-6b522efa-4870-4ad6-89ab-96a912d50e21' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-6b522efa-4870-4ad6-89ab-96a912d50e21' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5e57da84-ee79-405b-842f-595b6d997274' class='xr-var-data-in' type='checkbox'><label for='data-5e57da84-ee79-405b-842f-595b6d997274' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
<dt>
<span>standard_name :</span>
</dt>
<dd>
latitude
</dd>
<dt>
<span>long_name :</span>
</dt>
<dd>
Latitude
</dd>
<dt>
<span>units :</span>
</dt>
<dd>
degrees_north
</dd>
</dl>
</div>
<div class="xr-var-data">
<pre>array(29., dtype=float32)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>lon</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
float32
</div>
<div class="xr-var-preview xr-preview">
77.0
</div>
<input id='attrs-34aeb76d-2377-4f4e-9026-b53339298a3c' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-34aeb76d-2377-4f4e-9026-b53339298a3c' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e6a68c84-3b30-49e0-ac26-1422bb656f85' class='xr-var-data-in' type='checkbox'><label for='data-e6a68c84-3b30-49e0-ac26-1422bb656f85' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
<dt>
<span>standard_name :</span>
</dt>
<dd>
longitude
</dd>
<dt>
<span>long_name :</span>
</dt>
<dd>
Longitude
</dd>
<dt>
<span>units :</span>
</dt>
<dd>
degrees_east
</dd>
</dl>
</div>
<div class="xr-var-data">
<pre>array(77., dtype=float32)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>time</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
datetime64[ns]
</div>
<div class="xr-var-preview xr-preview">
2021-05-15
</div>
<input id='attrs-02fe527d-02d9-4743-9b11-de48295e28b4' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-02fe527d-02d9-4743-9b11-de48295e28b4' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-603c5207-9cd4-4c0f-b757-df308efe7906' class='xr-var-data-in' type='checkbox'><label for='data-603c5207-9cd4-4c0f-b757-df308efe7906' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
<dt>
<span>long_name :</span>
</dt>
<dd>
time
</dd>
<dt>
<span>bounds :</span>
</dt>
<dd>
time_bnds
</dd>
</dl>
</div>
<div class="xr-var-data">
<pre>array(&#x27;2021-05-15T00:00:00.000000000&#x27;, dtype=&#x27;datetime64[ns]&#x27;)</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="xr-section-item">
<input id='section-331f632e-6dc4-4817-acf3-aec30cb7f594' class='xr-section-summary-in' type='checkbox'  checked><label for='section-331f632e-6dc4-4817-acf3-aec30cb7f594' class='xr-section-summary' >Attributes: <span>(3)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<dl class="xr-attrs">
<dt>
<span>long_name :</span>
</dt>
<dd>
Surface temperature anomaly
</dd>
<dt>
<span>units :</span>
</dt>
<dd>
K
</dd>
<dt>
<span>cell_methods :</span>
</dt>
<dd>
time: mean
</dd>
</dl>
</div>
</li>
</ul>
</div>
</div>
<p>The <code>sel()</code> method also allows specifying range of values using Python’s built-in <code>slice()</code> function. The code below will select all observationss in the year 2021.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>da.sel(time<span class="op">=</span><span class="bu">slice</span>(<span class="st">&#39;2021-01-01&#39;</span>, <span class="st">&#39;2021-12-31&#39;</span>))</span></code></pre></div>
</div>
<div id="aggregating-data" class="section level2">
<h2>Aggregating Data</h2>
<p>A very-powerful feature of XArray is the ability to easily aggregate data across dimensions - making it ideal for many remote sensing analysis. Let’s calculate the average temperature anomany for the year 2021.</p>
<p>We first select the subset for year 2021 and apply the <code>.mean()</code> aggregation across the <code>time</code> dimension.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>subset2021 <span class="op">=</span> da.sel(time<span class="op">=</span><span class="bu">slice</span>(<span class="st">&#39;2021-01-01&#39;</span>, <span class="st">&#39;2021-12-31&#39;</span>))</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>subset2021.mean(dim<span class="op">=</span><span class="st">&#39;time&#39;</span>)</span></code></pre></div>
<p>XArray has many features easily work with time-series data such as this. We can use temporal components to aggregate the data across time. Here we take our monthly time-series of anomalies and aggregate it to a yearly time-series using the <code>groupby()</code> method.</p>
<p>Reference: <a href="https://docs.xarray.dev/en/stable/user-guide/time-series.html#resampling-and-grouped-operations">Resampling and grouped operations</a></p>
<div class="sourceCode" id="cb87"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>yearly <span class="op">=</span> da.groupby(<span class="st">&#39;time.year&#39;</span>).mean(dim<span class="op">=</span><span class="st">&#39;time&#39;</span>)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>yearly</span></code></pre></div>
<hr />
</div>
</div>
<div id="mapping-gridded-datasets" class="section level1">
<h1>Mapping Gridded Datasets</h1>
<p><a href="https://colab.research.google.com/github/spatialthoughts/python-dataviz-web/blob/main/06_mapping_gridded_datasets.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab" /></a></p>
<div id="overview-4" class="section level2">
<h2>Overview</h2>
<p>In this section, we will take the <a href="https://data.giss.nasa.gov/gistemp/">Gridded Monthly Temperature Anomaly Data</a> from 1880-present from GISTEMP and visualize the temperature anomaly for the year 2021.</p>
</div>
<div id="setup-and-data-download-4" class="section level2">
<h2>Setup and Data Download</h2>
<p>The following blocks of code will install the required packages and download the datasets to your Colab environment.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>capture</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>apt<span class="op">-</span>get <span class="op">-</span>qq remove python<span class="op">-</span>shapely python3<span class="op">-</span>shapely</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="op">--</span>no<span class="op">-</span>binary shapely shapely <span class="op">--</span>force</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="op">--</span>no<span class="op">-</span>binary cartopy cartopy<span class="op">==</span><span class="fl">0.19.0</span>.post1</span></code></pre></div>
<div class="sourceCode" id="cb89"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cartopy</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cartopy.crs <span class="im">as</span> ccrs </span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span></code></pre></div>
<div class="sourceCode" id="cb90"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>data_folder <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>output_folder <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(data_folder):</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>    os.mkdir(data_folder)</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(output_folder):</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>    os.mkdir(output_folder)</span></code></pre></div>
<div class="sourceCode" id="cb91"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> download(url):</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>    filename <span class="op">=</span> os.path.join(data_folder, os.path.basename(url))</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(filename):</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>        <span class="im">from</span> urllib.request <span class="im">import</span> urlretrieve</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>        local, _ <span class="op">=</span> urlretrieve(url, filename)</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;Downloaded &#39;</span> <span class="op">+</span> local)</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">&#39;gistemp1200_GHCNv4_ERSSTv5.nc&#39;</span></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>data_url <span class="op">=</span> <span class="st">&#39;https://github.com/spatialthoughts/python-dataviz-web/raw/main/data/gistemp/&#39;</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>download(data_url <span class="op">+</span> filename)</span></code></pre></div>
<pre><code>Downloaded data/gistemp1200_GHCNv4_ERSSTv5.nc</code></pre>
</div>
<div id="data-pre-processing-3" class="section level2">
<h2>Data Pre-Processing</h2>
<div class="sourceCode" id="cb93"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> os.path.join(data_folder, filename)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>ds <span class="op">=</span> xr.open_dataset(file_path)</span></code></pre></div>
<div class="sourceCode" id="cb94"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>da <span class="op">=</span> ds.tempanomaly</span></code></pre></div>
<div class="sourceCode" id="cb95"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>yearly <span class="op">=</span> da.groupby(<span class="st">&#39;time.year&#39;</span>).mean(dim<span class="op">=</span><span class="st">&#39;time&#39;</span>)</span></code></pre></div>
</div>
<div id="plotting-using-matplotlib" class="section level2">
<h2>Plotting using Matplotlib</h2>
<p>XArray provides a <code>plot()</code> method based on Matplotlib. When you call <code>plot()</code> on a 2D DataArray, it uses the <code>xarray.plot.pcolormesh()</code> function that creates a Pseudocolor plot.</p>
<p>Reference: <a href="https://docs.xarray.dev/en/stable/generated/xarray.plot.pcolormesh.html#xarray.plot.pcolormesh">xarray.plot.pcolormesh</a></p>
<div class="sourceCode" id="cb96"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>anomaly2021 <span class="op">=</span> yearly.sel(year<span class="op">=</span><span class="dv">2021</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>anomaly2021</span></code></pre></div>
<div>
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs> <symbol id="icon-database" viewBox="0 0 32 32"> <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path> <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> </symbol> <symbol id="icon-file-text2" viewBox="0 0 32 32"> <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path> <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> </symbol> </defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style>
<pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;tempanomaly&#x27; (lat: 90, lon: 180)&gt;
array([[-1.0675001, -1.0675001, -1.0675001, ..., -1.0675001, -1.0675001,
        -1.0675001],
       [-1.0675001, -1.0675001, -1.0675001, ..., -1.0675001, -1.0675001,
        -1.0675001],
       [-1.0675001, -1.0675001, -1.0675001, ..., -1.0675001, -1.0675001,
        -1.0675001],
       ...,
       [ 3.7291667,  3.7291667,  3.7291667, ...,  3.7291667,  3.7291667,
         3.7291667],
       [ 3.7291667,  3.7291667,  3.7291667, ...,  3.7291667,  3.7291667,
         3.7291667],
       [ 3.7291667,  3.7291667,  3.7291667, ...,  3.7291667,  3.7291667,
         3.7291667]], dtype=float32)
Coordinates:
  * lat      (lat) float32 -89.0 -87.0 -85.0 -83.0 -81.0 ... 83.0 85.0 87.0 89.0
  * lon      (lon) float32 -179.0 -177.0 -175.0 -173.0 ... 175.0 177.0 179.0
    year     int64 2021</pre>
<div class="xr-wrap" style="display:none">
<div class="xr-header">
<div class="xr-obj-type">
xarray.DataArray
</div>
<div class="xr-array-name">
‘tempanomaly’
</div>
<ul class="xr-dim-list">
<li>
<span class="xr-has-index">lat</span>: 90
</li>
<li>
<span class="xr-has-index">lon</span>: 180
</li>
</ul>
</div>
<ul class="xr-sections">
<li class="xr-section-item">
<div class="xr-array-wrap">
<input id='section-98f57e26-0f3c-4717-8577-bc762dc6a782' class='xr-array-in' type='checkbox' checked><label for='section-98f57e26-0f3c-4717-8577-bc762dc6a782' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-array-preview xr-preview">
<span>-1.068 -1.068 -1.068 -1.068 -1.068 … 3.729 3.729 3.729 3.729 3.729</span>
</div>
<div class="xr-array-data">
<pre>array([[-1.0675001, -1.0675001, -1.0675001, ..., -1.0675001, -1.0675001,
        -1.0675001],
       [-1.0675001, -1.0675001, -1.0675001, ..., -1.0675001, -1.0675001,
        -1.0675001],
       [-1.0675001, -1.0675001, -1.0675001, ..., -1.0675001, -1.0675001,
        -1.0675001],
       ...,
       [ 3.7291667,  3.7291667,  3.7291667, ...,  3.7291667,  3.7291667,
         3.7291667],
       [ 3.7291667,  3.7291667,  3.7291667, ...,  3.7291667,  3.7291667,
         3.7291667],
       [ 3.7291667,  3.7291667,  3.7291667, ...,  3.7291667,  3.7291667,
         3.7291667]], dtype=float32)</pre>
</div>
</div>
</li>
<li class="xr-section-item">
<input id='section-98188a39-1955-4d36-9111-293a2698e247' class='xr-section-summary-in' type='checkbox'  checked><label for='section-98188a39-1955-4d36-9111-293a2698e247' class='xr-section-summary' >Coordinates: <span>(3)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<ul class="xr-var-list">
<li class="xr-var-item">
<div class="xr-var-name">
<span class="xr-has-index">lat</span>
</div>
<div class="xr-var-dims">
(lat)
</div>
<div class="xr-var-dtype">
float32
</div>
<div class="xr-var-preview xr-preview">
-89.0 -87.0 -85.0 … 87.0 89.0
</div>
<input id='attrs-1d7ec7a9-a1d9-45df-ba50-09cc924a3543' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-1d7ec7a9-a1d9-45df-ba50-09cc924a3543' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-24970c2c-1e6b-41f6-b085-81119f359322' class='xr-var-data-in' type='checkbox'><label for='data-24970c2c-1e6b-41f6-b085-81119f359322' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
<dt>
<span>standard_name :</span>
</dt>
<dd>
latitude
</dd>
<dt>
<span>long_name :</span>
</dt>
<dd>
Latitude
</dd>
<dt>
<span>units :</span>
</dt>
<dd>
degrees_north
</dd>
</dl>
</div>
<div class="xr-var-data">
<pre>array([-89., -87., -85., -83., -81., -79., -77., -75., -73., -71., -69., -67.,
       -65., -63., -61., -59., -57., -55., -53., -51., -49., -47., -45., -43.,
       -41., -39., -37., -35., -33., -31., -29., -27., -25., -23., -21., -19.,
       -17., -15., -13., -11.,  -9.,  -7.,  -5.,  -3.,  -1.,   1.,   3.,   5.,
         7.,   9.,  11.,  13.,  15.,  17.,  19.,  21.,  23.,  25.,  27.,  29.,
        31.,  33.,  35.,  37.,  39.,  41.,  43.,  45.,  47.,  49.,  51.,  53.,
        55.,  57.,  59.,  61.,  63.,  65.,  67.,  69.,  71.,  73.,  75.,  77.,
        79.,  81.,  83.,  85.,  87.,  89.], dtype=float32)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span class="xr-has-index">lon</span>
</div>
<div class="xr-var-dims">
(lon)
</div>
<div class="xr-var-dtype">
float32
</div>
<div class="xr-var-preview xr-preview">
-179.0 -177.0 … 177.0 179.0
</div>
<input id='attrs-9e268711-ce83-4ade-b606-f9fec0473866' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-9e268711-ce83-4ade-b606-f9fec0473866' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a5bc0481-5ca2-4680-8cdf-a6e15cc8f6ae' class='xr-var-data-in' type='checkbox'><label for='data-a5bc0481-5ca2-4680-8cdf-a6e15cc8f6ae' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
<dt>
<span>standard_name :</span>
</dt>
<dd>
longitude
</dd>
<dt>
<span>long_name :</span>
</dt>
<dd>
Longitude
</dd>
<dt>
<span>units :</span>
</dt>
<dd>
degrees_east
</dd>
</dl>
</div>
<div class="xr-var-data">
<pre>array([-179., -177., -175., -173., -171., -169., -167., -165., -163., -161.,
       -159., -157., -155., -153., -151., -149., -147., -145., -143., -141.,
       -139., -137., -135., -133., -131., -129., -127., -125., -123., -121.,
       -119., -117., -115., -113., -111., -109., -107., -105., -103., -101.,
        -99.,  -97.,  -95.,  -93.,  -91.,  -89.,  -87.,  -85.,  -83.,  -81.,
        -79.,  -77.,  -75.,  -73.,  -71.,  -69.,  -67.,  -65.,  -63.,  -61.,
        -59.,  -57.,  -55.,  -53.,  -51.,  -49.,  -47.,  -45.,  -43.,  -41.,
        -39.,  -37.,  -35.,  -33.,  -31.,  -29.,  -27.,  -25.,  -23.,  -21.,
        -19.,  -17.,  -15.,  -13.,  -11.,   -9.,   -7.,   -5.,   -3.,   -1.,
          1.,    3.,    5.,    7.,    9.,   11.,   13.,   15.,   17.,   19.,
         21.,   23.,   25.,   27.,   29.,   31.,   33.,   35.,   37.,   39.,
         41.,   43.,   45.,   47.,   49.,   51.,   53.,   55.,   57.,   59.,
         61.,   63.,   65.,   67.,   69.,   71.,   73.,   75.,   77.,   79.,
         81.,   83.,   85.,   87.,   89.,   91.,   93.,   95.,   97.,   99.,
        101.,  103.,  105.,  107.,  109.,  111.,  113.,  115.,  117.,  119.,
        121.,  123.,  125.,  127.,  129.,  131.,  133.,  135.,  137.,  139.,
        141.,  143.,  145.,  147.,  149.,  151.,  153.,  155.,  157.,  159.,
        161.,  163.,  165.,  167.,  169.,  171.,  173.,  175.,  177.,  179.],
      dtype=float32)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>year</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
int64
</div>
<div class="xr-var-preview xr-preview">
2021
</div>
<input id='attrs-80dd5963-5d2a-45fb-8542-0aca24901d49' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-80dd5963-5d2a-45fb-8542-0aca24901d49' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-1e1a1d96-b519-46ad-9422-5556e2d47b57' class='xr-var-data-in' type='checkbox'><label for='data-1e1a1d96-b519-46ad-9422-5556e2d47b57' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array(2021)</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="xr-section-item">
<input id='section-e54c51d6-085c-42af-9677-14675572314d' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-e54c51d6-085c-42af-9677-14675572314d' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<dl class="xr-attrs">
</dl>
</div>
</li>
</ul>
</div>
</div>
<div class="sourceCode" id="cb97"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">15</span>, <span class="dv">7</span>)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>anomaly2021.plot(ax<span class="op">=</span>ax)</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/06_mapping_gridded_datasets_files/06_mapping_gridded_datasets_12_0.png" /></p>
<p>We can customize the plot using Matplotlib’s options.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">15</span>, <span class="dv">7</span>)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>anomaly2021.plot(ax<span class="op">=</span>ax,</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>    vmin<span class="op">=-</span><span class="dv">3</span>, vmax<span class="op">=</span><span class="dv">3</span>, add_labels<span class="op">=</span><span class="va">False</span>, cmap<span class="op">=</span><span class="st">&#39;coolwarm&#39;</span>)</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">&#39;Temprature Anomaly in 2021 (°C)&#39;</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/06_mapping_gridded_datasets_files/06_mapping_gridded_datasets_14_0.png" /></p>
</div>
<div id="plotting-using-cartopy" class="section level2">
<h2>Plotting using CartoPy</h2>
<p>To create more informative map visualization, we need to reproject this grid to another projection. CartoPy supports a wide range of projections and can plot them using matplotlib. CartoPy creates a GeoAxes object and replaces the default Axes with it. This allows you to plot the data on a specified projection.</p>
<p>Reference: <a href="https://scitools.org.uk/cartopy/docs/latest/reference/crs.html?highlight=list#list-of-projections">CartoPy List of Projections</a></p>
<div class="sourceCode" id="cb99"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.axes(projection<span class="op">=</span>ccrs.Orthographic(<span class="dv">0</span>, <span class="dv">30</span>))</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>ax.coastlines()</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>anomaly2021.plot(ax<span class="op">=</span>ax,</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>    vmin<span class="op">=-</span><span class="dv">3</span>, vmax<span class="op">=</span><span class="dv">3</span>, cmap<span class="op">=</span><span class="st">&#39;coolwarm&#39;</span>,</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>    transform<span class="op">=</span>ccrs.PlateCarree())</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.gcf()</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">5</span>,<span class="dv">5</span>)</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/06_mapping_gridded_datasets_files/06_mapping_gridded_datasets_17_0.png" /></p>
<p>We can further customize the map by adjusting the colorbar.</p>
<p>Reference: <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.colorbar.html">matplotlib.pyplot.colorbar</a></p>
<div class="sourceCode" id="cb100"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>cbar_kwargs <span class="op">=</span> {</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;orientation&#39;</span>:<span class="st">&#39;horizontal&#39;</span>,</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;fraction&#39;</span>: <span class="fl">0.025</span>,</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;pad&#39;</span>: <span class="fl">0.05</span>,</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;extend&#39;</span>:<span class="st">&#39;neither&#39;</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> plt.axes(projection<span class="op">=</span>ccrs.Orthographic(<span class="dv">0</span>, <span class="dv">30</span>))</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>ax.coastlines()</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>anomaly2021.plot(</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>    vmin<span class="op">=-</span><span class="dv">3</span>, vmax<span class="op">=</span><span class="dv">3</span>, cmap<span class="op">=</span><span class="st">&#39;coolwarm&#39;</span>,</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>    transform<span class="op">=</span>ccrs.PlateCarree(),</span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>    add_labels<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>    cbar_kwargs<span class="op">=</span>cbar_kwargs)</span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.gcf()</span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">10</span>,<span class="dv">10</span>)</span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Temprature Anomaly in 2021 (°C)&#39;</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a>output_folder <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb100-22"><a href="#cb100-22" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(output_folder, <span class="st">&#39;anomaly.jpg&#39;</span>)</span>
<span id="cb100-23"><a href="#cb100-23" aria-hidden="true" tabindex="-1"></a>plt.savefig(output_path, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb100-24"><a href="#cb100-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/06_mapping_gridded_datasets_files/06_mapping_gridded_datasets_19_0.png" /></p>
</div>
<div id="exercise-4" class="section level2">
<h2>Exercise</h2>
<p>Display the map in the Robinson projection.</p>
<hr />
</div>
</div>
<div id="visualizing-rasters" class="section level1">
<h1>Visualizing Rasters</h1>
<p><a href="https://colab.research.google.com/github/spatialthoughts/python-dataviz-web/blob/main/07_visualizing_rasters.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab" /></a></p>
<div id="overview-5" class="section level2">
<h2>Overview</h2>
<p>In the previous notebook, we learnt how to use <a href="http://xarray.pydata.org/">Xarray</a> to work with gridded datasets. XArray is also well suited to work with georeferenced rasters - such as satellite imagery, population grids, or elevation data.<a href="https://corteva.github.io/rioxarray/stable/index.html">rioxarray</a> is an extension of xarray that makes it easy to work with geospatial rasters. You can install the <code>rioxarray</code> package from the <code>conda-forge</code> channel.</p>
<p>In this section, we will take 4 individual SRTM tiles around the Mt. Everest region and merge them to a single GeoTiff using RasterIO. We will also use <code>matplotlib</code> to visualize the result with some annonations.</p>
</div>
<div id="setup-and-data-download-5" class="section level2">
<h2>Setup and Data Download</h2>
<p>The following blocks of code will install the required packages and download the datasets to your Colab environment.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>capture</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">&#39;google.colab&#39;</span> <span class="kw">in</span> <span class="bu">str</span>(get_ipython()):</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>pip install <span class="op">--</span>quiet rioxarray</span></code></pre></div>
<p>By convention, <code>rioxarray</code> is imported as <code>rxr</code>.</p>
<blockquote>
<p>Remember to always import <code>rioxarray</code> even if you are using sub-modules such as <code>merge_arrays</code>. Importing <code>rioxarray</code> activates the <code>rio</code> accessor which is required for all operations.</p>
</blockquote>
<div class="sourceCode" id="cb102"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray <span class="im">as</span> rxr</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rioxarray.merge <span class="im">import</span> merge_arrays</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code></pre></div>
<div class="sourceCode" id="cb103"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>data_folder <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>output_folder <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(data_folder):</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>    os.mkdir(data_folder)</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(output_folder):</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>    os.mkdir(output_folder)</span></code></pre></div>
<div class="sourceCode" id="cb104"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> download(url):</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>    filename <span class="op">=</span> os.path.join(data_folder, os.path.basename(url))</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(filename):</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>        <span class="im">from</span> urllib.request <span class="im">import</span> urlretrieve</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>        local, _ <span class="op">=</span> urlretrieve(url, filename)</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;Downloaded &#39;</span> <span class="op">+</span> local)</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>srtm_tiles <span class="op">=</span> [</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;N27E086.hgt&#39;</span>,</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;N27E087.hgt&#39;</span>,</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;N28E086.hgt&#39;</span>,</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;N28E087.hgt&#39;</span></span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>data_url <span class="op">=</span> <span class="st">&#39;https://github.com/spatialthoughts/python-dataviz-web/raw/main/data/srtm/&#39;</span></span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> tile <span class="kw">in</span> srtm_tiles:</span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>  url <span class="op">=</span> <span class="st">&#39;</span><span class="sc">{}</span><span class="st">/</span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(data_url, tile)</span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a>  download(url)</span></code></pre></div>
</div>
<div id="rioxarray-basics" class="section level2">
<h2>Rioxarray Basics</h2>
<p>The <code>open_rasterio()</code> method from <code>rioxarray</code> is able to read any data source supported by. the <a href="https://rasterio.readthedocs.io/en/latest/"><code>rasterio</code></a> library. Let’s open a single SRTM tile using <code>rioxarray</code>.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">&#39;N28E087.hgt&#39;</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> os.path.join(data_folder, filename)</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>rds <span class="op">=</span> rxr.open_rasterio(file_path)</span></code></pre></div>
<p>The result is a <code>xarray.DataArray</code> object.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>rds</span></code></pre></div>
<div>
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs> <symbol id="icon-database" viewBox="0 0 32 32"> <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path> <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> </symbol> <symbol id="icon-file-text2" viewBox="0 0 32 32"> <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path> <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> </symbol> </defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style>
<pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (band: 1, y: 3601, x: 3601)&gt;
[12967201 values with dtype=int16]
Coordinates:
  * band         (band) int64 1
  * x            (x) float64 87.0 87.0 87.0 87.0 87.0 ... 88.0 88.0 88.0 88.0
  * y            (y) float64 29.0 29.0 29.0 29.0 29.0 ... 28.0 28.0 28.0 28.0
    spatial_ref  int64 0
Attributes:
    _FillValue:    -32768.0
    scale_factor:  1.0
    add_offset:    0.0
    units:         m</pre>
<div class="xr-wrap" style="display:none">
<div class="xr-header">
<div class="xr-obj-type">
xarray.DataArray
</div>
<div class="xr-array-name">

</div>
<ul class="xr-dim-list">
<li>
<span class="xr-has-index">band</span>: 1
</li>
<li>
<span class="xr-has-index">y</span>: 3601
</li>
<li>
<span class="xr-has-index">x</span>: 3601
</li>
</ul>
</div>
<ul class="xr-sections">
<li class="xr-section-item">
<div class="xr-array-wrap">
<input id='section-bb1fce70-13a9-4c1b-8798-f37f3193dcf7' class='xr-array-in' type='checkbox' checked><label for='section-bb1fce70-13a9-4c1b-8798-f37f3193dcf7' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-array-preview xr-preview">
<span>…</span>
</div>
<div class="xr-array-data">
<pre>[12967201 values with dtype=int16]</pre>
</div>
</div>
</li>
<li class="xr-section-item">
<input id='section-2371a21a-fa70-419f-b57f-36ad0131b66c' class='xr-section-summary-in' type='checkbox'  checked><label for='section-2371a21a-fa70-419f-b57f-36ad0131b66c' class='xr-section-summary' >Coordinates: <span>(4)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<ul class="xr-var-list">
<li class="xr-var-item">
<div class="xr-var-name">
<span class="xr-has-index">band</span>
</div>
<div class="xr-var-dims">
(band)
</div>
<div class="xr-var-dtype">
int64
</div>
<div class="xr-var-preview xr-preview">
1
</div>
<input id='attrs-668aab40-c993-46d0-92a8-e41053cb6e8f' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-668aab40-c993-46d0-92a8-e41053cb6e8f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6cb0e305-a3ba-42e4-9887-33a7752f20b0' class='xr-var-data-in' type='checkbox'><label for='data-6cb0e305-a3ba-42e4-9887-33a7752f20b0' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array([1])</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span class="xr-has-index">x</span>
</div>
<div class="xr-var-dims">
(x)
</div>
<div class="xr-var-dtype">
float64
</div>
<div class="xr-var-preview xr-preview">
87.0 87.0 87.0 … 88.0 88.0 88.0
</div>
<input id='attrs-1b02667c-be73-4940-a898-285dd955f3ba' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-1b02667c-be73-4940-a898-285dd955f3ba' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-45fd3fdc-e31e-4866-9c9c-2aafa9cea6a4' class='xr-var-data-in' type='checkbox'><label for='data-45fd3fdc-e31e-4866-9c9c-2aafa9cea6a4' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array([87.      , 87.000278, 87.000556, ..., 87.999444, 87.999722, 88.      ])</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span class="xr-has-index">y</span>
</div>
<div class="xr-var-dims">
(y)
</div>
<div class="xr-var-dtype">
float64
</div>
<div class="xr-var-preview xr-preview">
29.0 29.0 29.0 … 28.0 28.0 28.0
</div>
<input id='attrs-35c7ef99-ecd4-4cb6-98e9-7197dba27891' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-35c7ef99-ecd4-4cb6-98e9-7197dba27891' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9991a790-849a-4cb8-b388-7ce5287cc187' class='xr-var-data-in' type='checkbox'><label for='data-9991a790-849a-4cb8-b388-7ce5287cc187' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array([29.      , 28.999722, 28.999444, ..., 28.000556, 28.000278, 28.      ])</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>spatial_ref</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
int64
</div>
<div class="xr-var-preview xr-preview">
0
</div>
<input id='attrs-2eaa90e1-39a1-4fbe-868e-050b884ffc08' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-2eaa90e1-39a1-4fbe-868e-050b884ffc08' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-596fc947-551e-4029-ae41-7a193595049a' class='xr-var-data-in' type='checkbox'><label for='data-596fc947-551e-4029-ae41-7a193595049a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
<dt>
<span>crs_wkt :</span>
</dt>
<dd>
GEOGCS[“WGS 84”,DATUM[“WGS_1984”,SPHEROID[“WGS 84”,6378137,298.257223563,AUTHORITY[“EPSG”,“7030”]],AUTHORITY[“EPSG”,“6326”]],PRIMEM[“Greenwich”,0,AUTHORITY[“EPSG”,“8901”]],UNIT[“degree”,0.0174532925199433,AUTHORITY[“EPSG”,“9122”]],AXIS[“Latitude”,NORTH],AXIS[“Longitude”,EAST],AUTHORITY[“EPSG”,“4326”]]
</dd>
<dt>
<span>semi_major_axis :</span>
</dt>
<dd>
6378137.0
</dd>
<dt>
<span>semi_minor_axis :</span>
</dt>
<dd>
6356752.314245179
</dd>
<dt>
<span>inverse_flattening :</span>
</dt>
<dd>
298.257223563
</dd>
<dt>
<span>reference_ellipsoid_name :</span>
</dt>
<dd>
WGS 84
</dd>
<dt>
<span>longitude_of_prime_meridian :</span>
</dt>
<dd>
0.0
</dd>
<dt>
<span>prime_meridian_name :</span>
</dt>
<dd>
Greenwich
</dd>
<dt>
<span>geographic_crs_name :</span>
</dt>
<dd>
WGS 84
</dd>
<dt>
<span>grid_mapping_name :</span>
</dt>
<dd>
latitude_longitude
</dd>
<dt>
<span>spatial_ref :</span>
</dt>
<dd>
GEOGCS[“WGS 84”,DATUM[“WGS_1984”,SPHEROID[“WGS 84”,6378137,298.257223563,AUTHORITY[“EPSG”,“7030”]],AUTHORITY[“EPSG”,“6326”]],PRIMEM[“Greenwich”,0,AUTHORITY[“EPSG”,“8901”]],UNIT[“degree”,0.0174532925199433,AUTHORITY[“EPSG”,“9122”]],AXIS[“Latitude”,NORTH],AXIS[“Longitude”,EAST],AUTHORITY[“EPSG”,“4326”]]
</dd>
<dt>
<span>GeoTransform :</span>
</dt>
<dd>
86.99986111111112 0.0002777777777777778 0.0 29.000138888888888 0.0 -0.0002777777777777778
</dd>
</dl>
</div>
<div class="xr-var-data">
<pre>array(0)</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="xr-section-item">
<input id='section-895d967f-26dc-4715-b689-31670c98dee7' class='xr-section-summary-in' type='checkbox'  checked><label for='section-895d967f-26dc-4715-b689-31670c98dee7' class='xr-section-summary' >Attributes: <span>(4)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<dl class="xr-attrs">
<dt>
<span>_FillValue :</span>
</dt>
<dd>
-32768.0
</dd>
<dt>
<span>scale_factor :</span>
</dt>
<dd>
1.0
</dd>
<dt>
<span>add_offset :</span>
</dt>
<dd>
0.0
</dd>
<dt>
<span>units :</span>
</dt>
<dd>
m
</dd>
</dl>
</div>
</li>
</ul>
</div>
</div>
<p>You can access the pixel values using the <code>values</code> property which returns the array’s data as a numpy array.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>rds.values</span></code></pre></div>
<pre><code>array([[[5217, 5211, 5208, ..., 5097, 5098, 5089],
        [5206, 5201, 5200, ..., 5080, 5075, 5069],
        [5199, 5194, 5191, ..., 5063, 5055, 5048],
        ...,
        [5347, 5345, 5343, ..., 5747, 5750, 5757],
        [5338, 5338, 5336, ..., 5737, 5740, 5747],
        [5332, 5331, 5332, ..., 5734, 5736, 5744]]], dtype=int16)</code></pre>
<p>A <code>xarray.DataArray</code> object also contains 1 or more <code>coordinates</code>. Each coordinate is a 1-dimensional array representing values along one of the data axes. In case of the 1-band SRTM elevation data, we have 3 coordinates - <code>x</code>, <code>y</code> and <code>band</code>.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>rds.coords</span></code></pre></div>
<pre><code>Coordinates:
  * band         (band) int64 1
  * x            (x) float64 87.0 87.0 87.0 87.0 87.0 ... 88.0 88.0 88.0 88.0
  * y            (y) float64 29.0 29.0 29.0 29.0 29.0 ... 28.0 28.0 28.0 28.0
    spatial_ref  int64 0</code></pre>
<p>The raster metadata is stored in the <a href="https://corteva.github.io/rioxarray/stable/rioxarray.html#rioxarray-rio-accessors"><code>rio</code></a> accessor. This is enabled by the <code>rioxarray</code> library which provides geospatial functions on top of <code>xarray</code>.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;CRS:&#39;</span>, rds.rio.crs)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Resolution:&#39;</span>, rds.rio.resolution())</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Bounds:&#39;</span>, rds.rio.bounds())</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Width:&#39;</span>, rds.rio.width)</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Height:&#39;</span>, rds.rio.height)</span></code></pre></div>
<pre><code>CRS: EPSG:4326
Resolution: (0.0002777777777777778, -0.0002777777777777778)
Bounds: (86.99986111111112, 27.999861111111112, 88.00013888888888, 29.000138888888888)
Width: 3601
Height: 3601</code></pre>
<div class="sourceCode" id="cb113"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>band1 <span class="op">=</span> rds.sel(band<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>band1</span></code></pre></div>
<div>
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs> <symbol id="icon-database" viewBox="0 0 32 32"> <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path> <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> </symbol> <symbol id="icon-file-text2" viewBox="0 0 32 32"> <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path> <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> </symbol> </defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style>
<pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (y: 3601, x: 3601)&gt;
array([[5217, 5211, 5208, ..., 5097, 5098, 5089],
       [5206, 5201, 5200, ..., 5080, 5075, 5069],
       [5199, 5194, 5191, ..., 5063, 5055, 5048],
       ...,
       [5347, 5345, 5343, ..., 5747, 5750, 5757],
       [5338, 5338, 5336, ..., 5737, 5740, 5747],
       [5332, 5331, 5332, ..., 5734, 5736, 5744]], dtype=int16)
Coordinates:
    band         int64 1
  * x            (x) float64 87.0 87.0 87.0 87.0 87.0 ... 88.0 88.0 88.0 88.0
  * y            (y) float64 29.0 29.0 29.0 29.0 29.0 ... 28.0 28.0 28.0 28.0
    spatial_ref  int64 0
Attributes:
    _FillValue:    -32768.0
    scale_factor:  1.0
    add_offset:    0.0
    units:         m</pre>
<div class="xr-wrap" style="display:none">
<div class="xr-header">
<div class="xr-obj-type">
xarray.DataArray
</div>
<div class="xr-array-name">

</div>
<ul class="xr-dim-list">
<li>
<span class="xr-has-index">y</span>: 3601
</li>
<li>
<span class="xr-has-index">x</span>: 3601
</li>
</ul>
</div>
<ul class="xr-sections">
<li class="xr-section-item">
<div class="xr-array-wrap">
<input id='section-731efec0-b9d7-4735-ae27-cb7a0b1c7bf4' class='xr-array-in' type='checkbox' checked><label for='section-731efec0-b9d7-4735-ae27-cb7a0b1c7bf4' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-array-preview xr-preview">
<span>5217 5211 5208 5204 5201 5198 5193 … 5742 5735 5733 5734 5736 5744</span>
</div>
<div class="xr-array-data">
<pre>array([[5217, 5211, 5208, ..., 5097, 5098, 5089],
       [5206, 5201, 5200, ..., 5080, 5075, 5069],
       [5199, 5194, 5191, ..., 5063, 5055, 5048],
       ...,
       [5347, 5345, 5343, ..., 5747, 5750, 5757],
       [5338, 5338, 5336, ..., 5737, 5740, 5747],
       [5332, 5331, 5332, ..., 5734, 5736, 5744]], dtype=int16)</pre>
</div>
</div>
</li>
<li class="xr-section-item">
<input id='section-324bf4a5-b8b0-42c1-b3f9-833b2679159f' class='xr-section-summary-in' type='checkbox'  checked><label for='section-324bf4a5-b8b0-42c1-b3f9-833b2679159f' class='xr-section-summary' >Coordinates: <span>(4)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<ul class="xr-var-list">
<li class="xr-var-item">
<div class="xr-var-name">
<span>band</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
int64
</div>
<div class="xr-var-preview xr-preview">
1
</div>
<input id='attrs-29c2c85f-dc0e-452f-b0a5-b6810f860071' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-29c2c85f-dc0e-452f-b0a5-b6810f860071' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-49fa2ebf-5c51-4f9d-8caf-a1a40e30e42c' class='xr-var-data-in' type='checkbox'><label for='data-49fa2ebf-5c51-4f9d-8caf-a1a40e30e42c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array(1)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span class="xr-has-index">x</span>
</div>
<div class="xr-var-dims">
(x)
</div>
<div class="xr-var-dtype">
float64
</div>
<div class="xr-var-preview xr-preview">
87.0 87.0 87.0 … 88.0 88.0 88.0
</div>
<input id='attrs-0e9b041a-5255-4b14-857c-2e6e5d320aa1' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-0e9b041a-5255-4b14-857c-2e6e5d320aa1' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-096f2dc0-c683-4f32-a645-a3c7d70776e6' class='xr-var-data-in' type='checkbox'><label for='data-096f2dc0-c683-4f32-a645-a3c7d70776e6' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array([87.      , 87.000278, 87.000556, ..., 87.999444, 87.999722, 88.      ])</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span class="xr-has-index">y</span>
</div>
<div class="xr-var-dims">
(y)
</div>
<div class="xr-var-dtype">
float64
</div>
<div class="xr-var-preview xr-preview">
29.0 29.0 29.0 … 28.0 28.0 28.0
</div>
<input id='attrs-6d8035c7-4f0d-414b-a60a-80f0fc18b0fd' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-6d8035c7-4f0d-414b-a60a-80f0fc18b0fd' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-70636863-9e28-42a3-89aa-9645e672b1e6' class='xr-var-data-in' type='checkbox'><label for='data-70636863-9e28-42a3-89aa-9645e672b1e6' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array([29.      , 28.999722, 28.999444, ..., 28.000556, 28.000278, 28.      ])</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>spatial_ref</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
int64
</div>
<div class="xr-var-preview xr-preview">
0
</div>
<input id='attrs-425655a0-ec02-4f54-8fcd-c0f357e49c6e' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-425655a0-ec02-4f54-8fcd-c0f357e49c6e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-da1e7e17-1e8a-4035-a2a7-cfbf3f7789de' class='xr-var-data-in' type='checkbox'><label for='data-da1e7e17-1e8a-4035-a2a7-cfbf3f7789de' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
<dt>
<span>crs_wkt :</span>
</dt>
<dd>
GEOGCS[“WGS 84”,DATUM[“WGS_1984”,SPHEROID[“WGS 84”,6378137,298.257223563,AUTHORITY[“EPSG”,“7030”]],AUTHORITY[“EPSG”,“6326”]],PRIMEM[“Greenwich”,0,AUTHORITY[“EPSG”,“8901”]],UNIT[“degree”,0.0174532925199433,AUTHORITY[“EPSG”,“9122”]],AXIS[“Latitude”,NORTH],AXIS[“Longitude”,EAST],AUTHORITY[“EPSG”,“4326”]]
</dd>
<dt>
<span>semi_major_axis :</span>
</dt>
<dd>
6378137.0
</dd>
<dt>
<span>semi_minor_axis :</span>
</dt>
<dd>
6356752.314245179
</dd>
<dt>
<span>inverse_flattening :</span>
</dt>
<dd>
298.257223563
</dd>
<dt>
<span>reference_ellipsoid_name :</span>
</dt>
<dd>
WGS 84
</dd>
<dt>
<span>longitude_of_prime_meridian :</span>
</dt>
<dd>
0.0
</dd>
<dt>
<span>prime_meridian_name :</span>
</dt>
<dd>
Greenwich
</dd>
<dt>
<span>geographic_crs_name :</span>
</dt>
<dd>
WGS 84
</dd>
<dt>
<span>grid_mapping_name :</span>
</dt>
<dd>
latitude_longitude
</dd>
<dt>
<span>spatial_ref :</span>
</dt>
<dd>
GEOGCS[“WGS 84”,DATUM[“WGS_1984”,SPHEROID[“WGS 84”,6378137,298.257223563,AUTHORITY[“EPSG”,“7030”]],AUTHORITY[“EPSG”,“6326”]],PRIMEM[“Greenwich”,0,AUTHORITY[“EPSG”,“8901”]],UNIT[“degree”,0.0174532925199433,AUTHORITY[“EPSG”,“9122”]],AXIS[“Latitude”,NORTH],AXIS[“Longitude”,EAST],AUTHORITY[“EPSG”,“4326”]]
</dd>
<dt>
<span>GeoTransform :</span>
</dt>
<dd>
86.99986111111112 0.0002777777777777778 0.0 29.000138888888888 0.0 -0.0002777777777777778
</dd>
</dl>
</div>
<div class="xr-var-data">
<pre>array(0)</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="xr-section-item">
<input id='section-01907e58-f26f-4b17-8327-631cede53850' class='xr-section-summary-in' type='checkbox'  checked><label for='section-01907e58-f26f-4b17-8327-631cede53850' class='xr-section-summary' >Attributes: <span>(4)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<dl class="xr-attrs">
<dt>
<span>_FillValue :</span>
</dt>
<dd>
-32768.0
</dd>
<dt>
<span>scale_factor :</span>
</dt>
<dd>
1.0
</dd>
<dt>
<span>add_offset :</span>
</dt>
<dd>
0.0
</dd>
<dt>
<span>units :</span>
</dt>
<dd>
m
</dd>
</dl>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="merging-rasters" class="section level2">
<h2>Merging Rasters</h2>
<p>Now that you understand the basic data structure of <em>xarray</em> and the &amp;rio* extension, let’s use it to process some data. We will take 4 individual SRTM tiles and merge them to a single GeoTiff. You will note that <code>rioxarray</code> handles the CRS and transform much better - taking care of internal details and providing a simple API.</p>
<p>Open each source file using <code>open_rasterio()</code> method and store the resulting datasets in a list.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>datasets <span class="op">=</span> []</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> tile <span class="kw">in</span> srtm_tiles:</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>    path <span class="op">=</span> os.path.join(data_folder, tile)</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>    rds <span class="op">=</span> rxr.open_rasterio(path)</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>    band <span class="op">=</span> rds.sel(band<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>    datasets.append(band)</span></code></pre></div>
<p>Use the <code>merge_arrays()</code> method from the <code>rioxarray.merge</code> module to merge the rasters.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>merged <span class="op">=</span> merge_arrays(datasets)</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>merged</span></code></pre></div>
<div>
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs> <symbol id="icon-database" viewBox="0 0 32 32"> <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path> <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> </symbol> <symbol id="icon-file-text2" viewBox="0 0 32 32"> <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path> <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> </symbol> </defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style>
<pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (y: 7201, x: 7201)&gt;
array([[4916, 4926, 4931, ..., 5097, 5098, 5089],
       [4919, 4932, 4928, ..., 5080, 5075, 5069],
       [4919, 4928, 4935, ..., 5063, 5055, 5048],
       ...,
       [ 368,  368,  366, ..., 1905, 1919, 1937],
       [ 364,  364,  362, ..., 1913, 1930, 1944],
       [ 360,  359,  357, ..., 1918, 1930, 1942]], dtype=int16)
Coordinates:
  * x            (x) float64 86.0 86.0 86.0 86.0 86.0 ... 88.0 88.0 88.0 88.0
  * y            (y) float64 29.0 29.0 29.0 29.0 29.0 ... 27.0 27.0 27.0 27.0
    band         int64 1
    spatial_ref  int64 0
Attributes:
    _FillValue:    -32768
    scale_factor:  1.0
    add_offset:    0.0
    units:         m</pre>
<div class="xr-wrap" style="display:none">
<div class="xr-header">
<div class="xr-obj-type">
xarray.DataArray
</div>
<div class="xr-array-name">

</div>
<ul class="xr-dim-list">
<li>
<span class="xr-has-index">y</span>: 7201
</li>
<li>
<span class="xr-has-index">x</span>: 7201
</li>
</ul>
</div>
<ul class="xr-sections">
<li class="xr-section-item">
<div class="xr-array-wrap">
<input id='section-150d5364-dec3-4242-9438-be51f0f689fc' class='xr-array-in' type='checkbox' checked><label for='section-150d5364-dec3-4242-9438-be51f0f689fc' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-array-preview xr-preview">
<span>4916 4926 4931 4929 4929 4931 4934 … 1877 1887 1904 1918 1930 1942</span>
</div>
<div class="xr-array-data">
<pre>array([[4916, 4926, 4931, ..., 5097, 5098, 5089],
       [4919, 4932, 4928, ..., 5080, 5075, 5069],
       [4919, 4928, 4935, ..., 5063, 5055, 5048],
       ...,
       [ 368,  368,  366, ..., 1905, 1919, 1937],
       [ 364,  364,  362, ..., 1913, 1930, 1944],
       [ 360,  359,  357, ..., 1918, 1930, 1942]], dtype=int16)</pre>
</div>
</div>
</li>
<li class="xr-section-item">
<input id='section-740e1c2f-6040-4d6b-8af4-d9fabdbd5c35' class='xr-section-summary-in' type='checkbox'  checked><label for='section-740e1c2f-6040-4d6b-8af4-d9fabdbd5c35' class='xr-section-summary' >Coordinates: <span>(4)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<ul class="xr-var-list">
<li class="xr-var-item">
<div class="xr-var-name">
<span class="xr-has-index">x</span>
</div>
<div class="xr-var-dims">
(x)
</div>
<div class="xr-var-dtype">
float64
</div>
<div class="xr-var-preview xr-preview">
86.0 86.0 86.0 … 88.0 88.0 88.0
</div>
<input id='attrs-ccccd12e-2230-4b91-b133-29b12f2c6ea6' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-ccccd12e-2230-4b91-b133-29b12f2c6ea6' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8ac69960-7d5e-42aa-a917-f93853b2577c' class='xr-var-data-in' type='checkbox'><label for='data-8ac69960-7d5e-42aa-a917-f93853b2577c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array([86.      , 86.000278, 86.000556, ..., 87.999444, 87.999722, 88.      ])</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span class="xr-has-index">y</span>
</div>
<div class="xr-var-dims">
(y)
</div>
<div class="xr-var-dtype">
float64
</div>
<div class="xr-var-preview xr-preview">
29.0 29.0 29.0 … 27.0 27.0 27.0
</div>
<input id='attrs-d4d1d655-5522-4557-a976-73f94266e199' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-d4d1d655-5522-4557-a976-73f94266e199' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-0880491f-4433-459e-8a03-0d673da49dfa' class='xr-var-data-in' type='checkbox'><label for='data-0880491f-4433-459e-8a03-0d673da49dfa' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array([29.      , 28.999722, 28.999444, ..., 27.000556, 27.000278, 27.      ])</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>band</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
int64
</div>
<div class="xr-var-preview xr-preview">
1
</div>
<input id='attrs-3c29251c-fa2f-4a9d-b0fc-3718f3c3c245' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-3c29251c-fa2f-4a9d-b0fc-3718f3c3c245' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7c24e33e-91d8-4348-806b-46d0115a1358' class='xr-var-data-in' type='checkbox'><label for='data-7c24e33e-91d8-4348-806b-46d0115a1358' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array(1)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>spatial_ref</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
int64
</div>
<div class="xr-var-preview xr-preview">
0
</div>
<input id='attrs-0f20b528-3a8c-475d-b67c-5a2d1a4d86fa' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-0f20b528-3a8c-475d-b67c-5a2d1a4d86fa' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7dbb5000-4919-4b99-bc3e-a97b1e3b20bb' class='xr-var-data-in' type='checkbox'><label for='data-7dbb5000-4919-4b99-bc3e-a97b1e3b20bb' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
<dt>
<span>crs_wkt :</span>
</dt>
<dd>
GEOGCS[“WGS 84”,DATUM[“WGS_1984”,SPHEROID[“WGS 84”,6378137,298.257223563,AUTHORITY[“EPSG”,“7030”]],AUTHORITY[“EPSG”,“6326”]],PRIMEM[“Greenwich”,0,AUTHORITY[“EPSG”,“8901”]],UNIT[“degree”,0.0174532925199433,AUTHORITY[“EPSG”,“9122”]],AXIS[“Latitude”,NORTH],AXIS[“Longitude”,EAST],AUTHORITY[“EPSG”,“4326”]]
</dd>
<dt>
<span>semi_major_axis :</span>
</dt>
<dd>
6378137.0
</dd>
<dt>
<span>semi_minor_axis :</span>
</dt>
<dd>
6356752.314245179
</dd>
<dt>
<span>inverse_flattening :</span>
</dt>
<dd>
298.257223563
</dd>
<dt>
<span>reference_ellipsoid_name :</span>
</dt>
<dd>
WGS 84
</dd>
<dt>
<span>longitude_of_prime_meridian :</span>
</dt>
<dd>
0.0
</dd>
<dt>
<span>prime_meridian_name :</span>
</dt>
<dd>
Greenwich
</dd>
<dt>
<span>geographic_crs_name :</span>
</dt>
<dd>
WGS 84
</dd>
<dt>
<span>grid_mapping_name :</span>
</dt>
<dd>
latitude_longitude
</dd>
<dt>
<span>spatial_ref :</span>
</dt>
<dd>
GEOGCS[“WGS 84”,DATUM[“WGS_1984”,SPHEROID[“WGS 84”,6378137,298.257223563,AUTHORITY[“EPSG”,“7030”]],AUTHORITY[“EPSG”,“6326”]],PRIMEM[“Greenwich”,0,AUTHORITY[“EPSG”,“8901”]],UNIT[“degree”,0.0174532925199433,AUTHORITY[“EPSG”,“9122”]],AXIS[“Latitude”,NORTH],AXIS[“Longitude”,EAST],AUTHORITY[“EPSG”,“4326”]]
</dd>
<dt>
<span>GeoTransform :</span>
</dt>
<dd>
85.99986111111112 0.0002777777777777778 0.0 29.000138888888888 0.0 -0.0002777777777777778
</dd>
</dl>
</div>
<div class="xr-var-data">
<pre>array(0)</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="xr-section-item">
<input id='section-705167c3-85d8-43a2-a960-6c0d5f5a31f5' class='xr-section-summary-in' type='checkbox'  checked><label for='section-705167c3-85d8-43a2-a960-6c0d5f5a31f5' class='xr-section-summary' >Attributes: <span>(4)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<dl class="xr-attrs">
<dt>
<span>_FillValue :</span>
</dt>
<dd>
-32768
</dd>
<dt>
<span>scale_factor :</span>
</dt>
<dd>
1.0
</dd>
<dt>
<span>add_offset :</span>
</dt>
<dd>
0.0
</dd>
<dt>
<span>units :</span>
</dt>
<dd>
m
</dd>
</dl>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="plotting-multiple-rasters" class="section level2">
<h2>Plotting Multiple Rasters</h2>
<p>You can visualize any <code>DataArray</code> object by calling <code>plot()</code> method. Here we create a row of 4 plots and render each of the source SRTM rasters.</p>
<p>We can use the <code>cmap</code> option to specify a color ramp. Here we are using the built-in <em>Greys</em> ramp. Appending **_r** gives us the inverted ramp with blacks representing lower elevation values.</p>
<p>Reference : <a href="https://docs.xarray.dev/en/stable/generated/xarray.plot.imshow.html">xarray.plot.imshow</a></p>
<div class="sourceCode" id="cb116"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">15</span>,<span class="dv">3</span>)</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, da <span class="kw">in</span> <span class="bu">enumerate</span>(datasets):</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axes[index]</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>    im <span class="op">=</span> da.plot.imshow(ax<span class="op">=</span>ax, cmap<span class="op">=</span><span class="st">&#39;Greys_r&#39;</span>)</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>    filename <span class="op">=</span> srtm_tiles[index]</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>    ax.set_title(filename)</span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/07_visualizing_rasters_files/07_visualizing_rasters_27_0.png" /></p>
<p>Similarly, we can visualize the merged raster.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">12</span>, <span class="dv">10</span>)</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>merged.plot.imshow(ax<span class="op">=</span>ax, cmap<span class="op">=</span><span class="st">&#39;Greys_r&#39;</span>)</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">&#39;merged&#39;</span>)</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/07_visualizing_rasters_files/07_visualizing_rasters_29_0.png" /></p>
</div>
<div id="annotating-plots" class="section level2">
<h2>Annotating Plots</h2>
<p>Sometime it is helpful to add annotations on your plot to highlight a feature or add a text label. In this section we will learn how to use the annotate the DEM to show the location and elevation of Mt. Everest.</p>
<p>First, we locate the coordinates of the maximum elevation in the <code>merged</code> DataArray using the <code>max()</code> function. We can then use <code>where()</code> function to filter the elements where the value equals the maximum elevation. Lastly, we run <code>squeeze()</code> to remove the extra empty dimension from the result.</p>
<p>Refernces: * <a href="https://docs.xarray.dev/en/stable/generated/xarray.DataArray.max.html">xarray.DataArray.max</a> * <a href="https://docs.xarray.dev/en/stable/generated/xarray.DataArray.where.html">xarray.DataArray.where</a></p>
<div class="sourceCode" id="cb118"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>max_da <span class="op">=</span> merged.where(merged<span class="op">==</span>merged.<span class="bu">max</span>(), drop<span class="op">=</span><span class="va">True</span>).squeeze()</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>max_da</span></code></pre></div>
<div>
<svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs> <symbol id="icon-database" viewBox="0 0 32 32"> <path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path> <path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> <path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path> </symbol> <symbol id="icon-file-text2" viewBox="0 0 32 32"> <path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path> <path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> <path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path> </symbol> </defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style>
<pre class='xr-text-repr-fallback'>&lt;xarray.DataArray ()&gt;
array(8748.)
Coordinates:
    x            float64 86.93
    y            float64 27.99
    band         int64 1
    spatial_ref  int64 0
Attributes:
    _FillValue:    -32768
    scale_factor:  1.0
    add_offset:    0.0
    units:         m</pre>
<div class="xr-wrap" style="display:none">
<div class="xr-header">
<div class="xr-obj-type">
xarray.DataArray
</div>
<div class="xr-array-name">

</div>
</div>
<ul class="xr-sections">
<li class="xr-section-item">
<div class="xr-array-wrap">
<input id='section-6e3c509c-18c2-4dcc-a9dd-e459ddac871d' class='xr-array-in' type='checkbox' checked><label for='section-6e3c509c-18c2-4dcc-a9dd-e459ddac871d' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-array-preview xr-preview">
<span>8.748e+03</span>
</div>
<div class="xr-array-data">
<pre>array(8748.)</pre>
</div>
</div>
</li>
<li class="xr-section-item">
<input id='section-46b1c751-dbef-47ff-b9b7-b3e9468eb21c' class='xr-section-summary-in' type='checkbox'  checked><label for='section-46b1c751-dbef-47ff-b9b7-b3e9468eb21c' class='xr-section-summary' >Coordinates: <span>(4)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<ul class="xr-var-list">
<li class="xr-var-item">
<div class="xr-var-name">
<span>x</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
float64
</div>
<div class="xr-var-preview xr-preview">
86.93
</div>
<input id='attrs-88c395d8-a758-466d-bcc4-1c54bc404aeb' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-88c395d8-a758-466d-bcc4-1c54bc404aeb' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6a9648dc-3020-4a93-ad41-156c56b2da80' class='xr-var-data-in' type='checkbox'><label for='data-6a9648dc-3020-4a93-ad41-156c56b2da80' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array(86.92555556)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>y</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
float64
</div>
<div class="xr-var-preview xr-preview">
27.99
</div>
<input id='attrs-82053367-291a-4c54-afc7-59d169a0396f' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-82053367-291a-4c54-afc7-59d169a0396f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-931aad8e-b4f9-4cca-8eb9-2762b5635bf1' class='xr-var-data-in' type='checkbox'><label for='data-931aad8e-b4f9-4cca-8eb9-2762b5635bf1' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array(27.98888889)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>band</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
int64
</div>
<div class="xr-var-preview xr-preview">
1
</div>
<input id='attrs-299f253a-03e8-419a-9f70-d5a3034d0e41' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-299f253a-03e8-419a-9f70-d5a3034d0e41' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6d3f7c45-ff30-40b9-8603-4e2597dd9db7' class='xr-var-data-in' type='checkbox'><label for='data-6d3f7c45-ff30-40b9-8603-4e2597dd9db7' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
</dl>
</div>
<div class="xr-var-data">
<pre>array(1)</pre>
</div>
</li>
<li class="xr-var-item">
<div class="xr-var-name">
<span>spatial_ref</span>
</div>
<div class="xr-var-dims">
()
</div>
<div class="xr-var-dtype">
int64
</div>
<div class="xr-var-preview xr-preview">
0
</div>
<input id='attrs-f36fe02c-69fb-4bc3-b4ef-835edd810f03' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-f36fe02c-69fb-4bc3-b4ef-835edd810f03' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-301372c3-2a8d-4d75-aab2-8b3ec5bdef8d' class='xr-var-data-in' type='checkbox'><label for='data-301372c3-2a8d-4d75-aab2-8b3ec5bdef8d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label>
<div class="xr-var-attrs">
<dl class="xr-attrs">
<dt>
<span>crs_wkt :</span>
</dt>
<dd>
GEOGCS[“WGS 84”,DATUM[“WGS_1984”,SPHEROID[“WGS 84”,6378137,298.257223563,AUTHORITY[“EPSG”,“7030”]],AUTHORITY[“EPSG”,“6326”]],PRIMEM[“Greenwich”,0,AUTHORITY[“EPSG”,“8901”]],UNIT[“degree”,0.0174532925199433,AUTHORITY[“EPSG”,“9122”]],AXIS[“Latitude”,NORTH],AXIS[“Longitude”,EAST],AUTHORITY[“EPSG”,“4326”]]
</dd>
<dt>
<span>semi_major_axis :</span>
</dt>
<dd>
6378137.0
</dd>
<dt>
<span>semi_minor_axis :</span>
</dt>
<dd>
6356752.314245179
</dd>
<dt>
<span>inverse_flattening :</span>
</dt>
<dd>
298.257223563
</dd>
<dt>
<span>reference_ellipsoid_name :</span>
</dt>
<dd>
WGS 84
</dd>
<dt>
<span>longitude_of_prime_meridian :</span>
</dt>
<dd>
0.0
</dd>
<dt>
<span>prime_meridian_name :</span>
</dt>
<dd>
Greenwich
</dd>
<dt>
<span>geographic_crs_name :</span>
</dt>
<dd>
WGS 84
</dd>
<dt>
<span>grid_mapping_name :</span>
</dt>
<dd>
latitude_longitude
</dd>
<dt>
<span>spatial_ref :</span>
</dt>
<dd>
GEOGCS[“WGS 84”,DATUM[“WGS_1984”,SPHEROID[“WGS 84”,6378137,298.257223563,AUTHORITY[“EPSG”,“7030”]],AUTHORITY[“EPSG”,“6326”]],PRIMEM[“Greenwich”,0,AUTHORITY[“EPSG”,“8901”]],UNIT[“degree”,0.0174532925199433,AUTHORITY[“EPSG”,“9122”]],AXIS[“Latitude”,NORTH],AXIS[“Longitude”,EAST],AUTHORITY[“EPSG”,“4326”]]
</dd>
<dt>
<span>GeoTransform :</span>
</dt>
<dd>
85.99986111111112 0.0002777777777777778 0.0 29.000138888888888 0.0 -0.0002777777777777778
</dd>
</dl>
</div>
<div class="xr-var-data">
<pre>array(0)</pre>
</div>
</li>
</ul>
</div>
</li>
<li class="xr-section-item">
<input id='section-99c2c3cb-1aa8-4e9f-a06f-a06f28d23459' class='xr-section-summary-in' type='checkbox'  checked><label for='section-99c2c3cb-1aa8-4e9f-a06f-a06f28d23459' class='xr-section-summary' >Attributes: <span>(4)</span></label>
<div class="xr-section-inline-details">

</div>
<div class="xr-section-details">
<dl class="xr-attrs">
<dt>
<span>_FillValue :</span>
</dt>
<dd>
-32768
</dd>
<dt>
<span>scale_factor :</span>
</dt>
<dd>
1.0
</dd>
<dt>
<span>add_offset :</span>
</dt>
<dd>
0.0
</dd>
<dt>
<span>units :</span>
</dt>
<dd>
m
</dd>
</dl>
</div>
</li>
</ul>
</div>
</div>
<p>We now extract the x,y coordinates and the value of the maximum elevation.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>max_x <span class="op">=</span> max_da.x.values</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>max_y <span class="op">=</span> max_da.y.values</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>max_elev <span class="op">=</span> <span class="bu">int</span>(max_da.values)</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(max_x, max_y, max_elev)</span></code></pre></div>
<pre><code>86.92555555555556 27.988888888888887 8748</code></pre>
<p>Now we plot the <code>merged</code> raster and annotate it using the <code>annotate()</code> function.</p>
<p>Reference: <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.annotate.html">matplotlib.pyplot.annotate</a></p>
<div class="sourceCode" id="cb121"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">12</span>, <span class="dv">10</span>)</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>merged.plot.imshow(ax<span class="op">=</span>ax, cmap<span class="op">=</span><span class="st">&#39;viridis&#39;</span>, add_labels<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>ax.plot(max_x, max_y, <span class="st">&#39;^r&#39;</span>, markersize<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>ax.annotate(<span class="st">&#39;Mt. Everest (elevation:</span><span class="sc">{}</span><span class="st">m)&#39;</span>.<span class="bu">format</span>(max_elev),</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>            xy<span class="op">=</span>(max_x, max_y), xycoords<span class="op">=</span><span class="st">&#39;data&#39;</span>,</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>            xytext<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">20</span>), textcoords<span class="op">=</span><span class="st">&#39;offset points&#39;</span>,</span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>            arrowprops<span class="op">=</span><span class="bu">dict</span>(arrowstyle<span class="op">=</span><span class="st">&#39;-&gt;&#39;</span>, color<span class="op">=</span><span class="st">&#39;black&#39;</span>)</span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/07_visualizing_rasters_files/07_visualizing_rasters_36_0.png" /></p>
<p>Finally, save the merged array to disk as a GeoTiff file.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>output_filename <span class="op">=</span> <span class="st">&#39;merged.tif&#39;</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(data_folder, output_filename)</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>merged.rio.to_raster(output_path)</span></code></pre></div>
</div>
<div id="exercise-5" class="section level2">
<h2>Exercise</h2>
<p>Add contours to the elevation plot below. You can use the <a href="https://docs.xarray.dev/en/stable/generated/xarray.plot.contour.html"><code>xarray.plot.contour</code></a> function to create the contour plot.</p>
<p>Hint: Use the options <code>colors=black</code> and <code>levels=10</code>.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">12</span>, <span class="dv">10</span>)</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>merged.plot.imshow(ax<span class="op">=</span>ax, cmap<span class="op">=</span><span class="st">&#39;viridis&#39;</span>, add_labels<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<hr />
</div>
</div>
<div id="interactive-maps-with-folium" class="section level1">
<h1>Interactive Maps with Folium</h1>
<p><a href="https://colab.research.google.com/github/spatialthoughts/python-dataviz-web/blob/main/08_interactive_maps_folium.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab" /></a></p>
<div id="overview-6" class="section level2">
<h2>Overview</h2>
<p><a href="https://python-visualization.github.io/folium/">Folium</a> is a Python library that allows you to create interactive maps based on the popular <a href="https://leafletjs.com/">Leaflet</a> javascript library.</p>
<p>In this section, we will learn how to create an interactive map showing driving directions between two locations.</p>
</div>
<div id="setup-1" class="section level2">
<h2>Setup</h2>
<div class="sourceCode" id="cb124"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium</span></code></pre></div>
<div class="sourceCode" id="cb125"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>data_folder <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>output_folder <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(data_folder):</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>    os.mkdir(data_folder)</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(output_folder):</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>    os.mkdir(output_folder)</span></code></pre></div>
<p>We will be using <a href="https://openrouteservice.org/">OpenRouteService API</a> to calculate the directions. Please sign-up for a free account and create an API key. If you already have an account, the API key is obtained from the <a href="https://openrouteservice.org/dev/#/home">OpenRouteService Dashboard</a>. Enter your API key below.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>ORS_API_KEY <span class="op">=</span> <span class="st">&#39;&#39;</span></span></code></pre></div>
</div>
<div id="folium-basics" class="section level2">
<h2>Folium Basics</h2>
<div class="sourceCode" id="cb127"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>san_francisco <span class="op">=</span> (<span class="fl">37.7749</span>, <span class="op">-</span><span class="fl">122.4194</span>)</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>new_york <span class="op">=</span> (<span class="fl">40.661</span>, <span class="op">-</span><span class="fl">73.944</span>)</span></code></pre></div>
<div class="sourceCode" id="cb128"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> folium.Map()</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<div class="sourceCode" id="cb129"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> folium <span class="im">import</span> Figure</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> Figure(width<span class="op">=</span><span class="dv">800</span>, height<span class="op">=</span><span class="dv">400</span>)</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> folium.Map(location<span class="op">=</span>[<span class="fl">39.83</span>, <span class="op">-</span><span class="fl">98.58</span>], zoom_start<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>fig.add_child(m)</span></code></pre></div>
<div class="sourceCode" id="cb130"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>folium.Marker(san_francisco, popup<span class="op">=</span><span class="st">&#39;San Francisco&#39;</span>).add_to(m)</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>folium.Marker(new_york, popup<span class="op">=</span><span class="st">&#39;New York&#39;</span>).add_to(m)</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<ul>
<li><a href="https://python-visualization.github.io/folium/modules.html#folium.map.Marker">folium.map.Marker</a></li>
<li><a href="https://python-visualization.github.io/folium/modules.html#folium.map.Icon">folium.map.Icon</a></li>
<li><a href="https://fontawesome.com/search?m=free&amp;c=maps">fontawesome icons</a></li>
<li><a href="https://getbootstrap.com/docs/3.3/components/">bootstrap icons</a></li>
</ul>
<div class="sourceCode" id="cb131"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> folium <span class="im">import</span> Figure</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> Figure(width<span class="op">=</span><span class="dv">800</span>, height<span class="op">=</span><span class="dv">400</span>)</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> folium.Map(location<span class="op">=</span>[<span class="fl">39.83</span>, <span class="op">-</span><span class="fl">98.58</span>], zoom_start<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>folium.Marker(san_francisco, popup<span class="op">=</span><span class="st">&#39;San Francisco&#39;</span>,</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>              icon<span class="op">=</span>folium.Icon(</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>                  color<span class="op">=</span><span class="st">&#39;green&#39;</span>, icon<span class="op">=</span><span class="st">&#39;crosshairs&#39;</span>, prefix<span class="op">=</span><span class="st">&#39;fa&#39;</span>)</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>             ).add_to(m)</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>folium.Marker(new_york, popup<span class="op">=</span><span class="st">&#39;New York&#39;</span>, </span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>              icon<span class="op">=</span>folium.Icon(color<span class="op">=</span><span class="st">&#39;red&#39;</span>, icon<span class="op">=</span><span class="st">&#39;crosshairs&#39;</span>, prefix<span class="op">=</span><span class="st">&#39;fa&#39;</span>)</span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>             ).add_to(m)</span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>fig.add_child(m)</span></code></pre></div>
<div class="sourceCode" id="cb132"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>san_francisco <span class="op">=</span> (<span class="fl">37.7749</span>, <span class="op">-</span><span class="fl">122.4194</span>)</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>new_york <span class="op">=</span> (<span class="fl">40.661</span>, <span class="op">-</span><span class="fl">73.944</span>)</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">=</span> {</span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;api_key&#39;</span>: ORS_API_KEY,</span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;start&#39;</span> : <span class="st">&#39;</span><span class="sc">{}</span><span class="st">,</span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(san_francisco[<span class="dv">1</span>], san_francisco[<span class="dv">0</span>]),</span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;end&#39;</span> : <span class="st">&#39;</span><span class="sc">{}</span><span class="st">,</span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(new_york[<span class="dv">1</span>], new_york[<span class="dv">0</span>])</span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(</span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;https://api.openrouteservice.org/v2/directions/driving-car&#39;</span>, params<span class="op">=</span>parameters)</span>
<span id="cb132-14"><a href="#cb132-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-15"><a href="#cb132-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb132-16"><a href="#cb132-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;Request successful.&#39;</span>)</span>
<span id="cb132-17"><a href="#cb132-17" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> response.json()</span>
<span id="cb132-18"><a href="#cb132-18" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb132-19"><a href="#cb132-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;Request failed.&#39;</span>)</span></code></pre></div>
<p>Extract the coordinates for the driving directions.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>route<span class="op">=</span> data[<span class="st">&#39;features&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;geometry&#39;</span>][<span class="st">&#39;coordinates&#39;</span>]</span></code></pre></div>
<div class="sourceCode" id="cb134"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>route[:<span class="dv">5</span>]</span></code></pre></div>
<p>The coordinates returned by OpenRouteService API is in the order [X,Y] (i.e. [Longitude, Latitude]) whereas Folium requires the coordinates in [Y,X] (i.e. [Latitude, Longitude]) order. We can swap them before plotting.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>route_xy <span class="op">=</span> []</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x, y <span class="kw">in</span> route:</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>    route_xy.append((y,x))</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>route_xy[:<span class="dv">5</span>]</span></code></pre></div>
<p>An easier way to accomplish the same is by using a Python <a href="https://www.w3schools.com/python/python_lists_comprehension.asp">List Comprehension</a>.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>route_xy <span class="op">=</span> [(y, x) <span class="cf">for</span> x, y <span class="kw">in</span> route]</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>route_xy[:<span class="dv">5</span>]</span></code></pre></div>
<div class="sourceCode" id="cb137"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>summary <span class="op">=</span> data[<span class="st">&#39;features&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;properties&#39;</span>][<span class="st">&#39;summary&#39;</span>]</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>distance <span class="op">=</span> <span class="bu">round</span>(summary[<span class="st">&#39;distance&#39;</span>]<span class="op">/</span><span class="dv">1000</span>)</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>tooltip <span class="op">=</span> <span class="st">&#39;Driving Distance: </span><span class="sc">{}</span><span class="st">km&#39;</span>.<span class="bu">format</span>(distance)</span></code></pre></div>
<div class="sourceCode" id="cb138"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>folium.PolyLine(route_xy, tooltip<span class="op">=</span>tooltip).add_to(m)</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<div class="sourceCode" id="cb139"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>output_folder <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(output_folder):</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>    os.mkdir(output_folder)</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(output_folder, <span class="st">&#39;directions.html&#39;</span>)</span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>m.save(output_path)</span></code></pre></div>
</div>
<div id="exercise-6" class="section level2">
<h2>Exercise</h2>
<p>Below is the complete code to create an interactive map with the driving directions between two cities. Replace the origin and destination with your chosen cities and create an interactive map.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a><span class="co">###############################</span></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a><span class="co">### Replace Variables Below </span><span class="al">###</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a><span class="co">###############################</span></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>origin <span class="op">=</span> (<span class="fl">37.7749</span>, <span class="op">-</span><span class="fl">122.4194</span>)</span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>origin_name <span class="op">=</span> <span class="st">&#39;San Francisco&#39;</span></span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>destination <span class="op">=</span> (<span class="fl">40.661</span>, <span class="op">-</span><span class="fl">73.944</span>)</span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>destination_name <span class="op">=</span> <span class="st">&#39;New York&#39;</span></span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a>map_center <span class="op">=</span> (<span class="fl">39.83</span>, <span class="op">-</span><span class="fl">98.58</span>)</span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a>ORS_API_KEY <span class="op">=</span> <span class="st">&#39;&#39;</span></span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a><span class="co">###############################</span></span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">=</span> {</span>
<span id="cb140-15"><a href="#cb140-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;api_key&#39;</span>: ORS_API_KEY,</span>
<span id="cb140-16"><a href="#cb140-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;start&#39;</span> : <span class="st">&#39;</span><span class="sc">{}</span><span class="st">,</span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(origin[<span class="dv">1</span>], origin[<span class="dv">0</span>]),</span>
<span id="cb140-17"><a href="#cb140-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;end&#39;</span> : <span class="st">&#39;</span><span class="sc">{}</span><span class="st">,</span><span class="sc">{}</span><span class="st">&#39;</span>.<span class="bu">format</span>(destination[<span class="dv">1</span>], destination[<span class="dv">0</span>])</span>
<span id="cb140-18"><a href="#cb140-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb140-19"><a href="#cb140-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-20"><a href="#cb140-20" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(</span>
<span id="cb140-21"><a href="#cb140-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;https://api.openrouteservice.org/v2/directions/driving-car&#39;</span>, params<span class="op">=</span>parameters)</span>
<span id="cb140-22"><a href="#cb140-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-23"><a href="#cb140-23" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb140-24"><a href="#cb140-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;Request successful.&#39;</span>)</span>
<span id="cb140-25"><a href="#cb140-25" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> response.json()</span>
<span id="cb140-26"><a href="#cb140-26" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb140-27"><a href="#cb140-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;Request failed.&#39;</span>)</span>
<span id="cb140-28"><a href="#cb140-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-29"><a href="#cb140-29" aria-hidden="true" tabindex="-1"></a>route<span class="op">=</span> data[<span class="st">&#39;features&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;geometry&#39;</span>][<span class="st">&#39;coordinates&#39;</span>]</span>
<span id="cb140-30"><a href="#cb140-30" aria-hidden="true" tabindex="-1"></a>summary <span class="op">=</span> data[<span class="st">&#39;features&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;properties&#39;</span>][<span class="st">&#39;summary&#39;</span>]</span>
<span id="cb140-31"><a href="#cb140-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-32"><a href="#cb140-32" aria-hidden="true" tabindex="-1"></a>route_xy <span class="op">=</span> [(y, x) <span class="cf">for</span> x, y <span class="kw">in</span> route]</span>
<span id="cb140-33"><a href="#cb140-33" aria-hidden="true" tabindex="-1"></a>distance <span class="op">=</span> <span class="bu">round</span>(summary[<span class="st">&#39;distance&#39;</span>]<span class="op">/</span><span class="dv">1000</span>)</span>
<span id="cb140-34"><a href="#cb140-34" aria-hidden="true" tabindex="-1"></a>tooltip <span class="op">=</span> <span class="st">&#39;Driving Distance: </span><span class="sc">{}</span><span class="st">km&#39;</span>.<span class="bu">format</span>(distance)</span>
<span id="cb140-35"><a href="#cb140-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-36"><a href="#cb140-36" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> folium <span class="im">import</span> Figure</span>
<span id="cb140-37"><a href="#cb140-37" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> Figure(width<span class="op">=</span><span class="dv">800</span>, height<span class="op">=</span><span class="dv">400</span>)</span>
<span id="cb140-38"><a href="#cb140-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-39"><a href="#cb140-39" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> folium.Map(location<span class="op">=</span>map_center, zoom_start<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb140-40"><a href="#cb140-40" aria-hidden="true" tabindex="-1"></a>folium.Marker(origin, popup<span class="op">=</span>origin_name,</span>
<span id="cb140-41"><a href="#cb140-41" aria-hidden="true" tabindex="-1"></a>              icon<span class="op">=</span>folium.Icon(</span>
<span id="cb140-42"><a href="#cb140-42" aria-hidden="true" tabindex="-1"></a>                  color<span class="op">=</span><span class="st">&#39;green&#39;</span>, icon<span class="op">=</span><span class="st">&#39;crosshairs&#39;</span>, prefix<span class="op">=</span><span class="st">&#39;fa&#39;</span>)</span>
<span id="cb140-43"><a href="#cb140-43" aria-hidden="true" tabindex="-1"></a>             ).add_to(m)</span>
<span id="cb140-44"><a href="#cb140-44" aria-hidden="true" tabindex="-1"></a>folium.Marker(destination, popup<span class="op">=</span>destination_name, </span>
<span id="cb140-45"><a href="#cb140-45" aria-hidden="true" tabindex="-1"></a>              icon<span class="op">=</span>folium.Icon(color<span class="op">=</span><span class="st">&#39;red&#39;</span>, icon<span class="op">=</span><span class="st">&#39;crosshairs&#39;</span>, prefix<span class="op">=</span><span class="st">&#39;fa&#39;</span>)</span>
<span id="cb140-46"><a href="#cb140-46" aria-hidden="true" tabindex="-1"></a>             ).add_to(m)</span>
<span id="cb140-47"><a href="#cb140-47" aria-hidden="true" tabindex="-1"></a>folium.PolyLine(route_xy, tooltip<span class="op">=</span>tooltip).add_to(m)</span>
<span id="cb140-48"><a href="#cb140-48" aria-hidden="true" tabindex="-1"></a>fig.add_child(m)</span></code></pre></div>
<hr />
<hr />
</div>
</div>
<div id="multi-layer-interactive-maps" class="section level1">
<h1>Multi-layer Interactive Maps</h1>
<p><a href="https://colab.research.google.com/github/spatialthoughts/python-dataviz-web/blob/main/09_multilayer_maps.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab" /></a></p>
<p>Open the notebook named <code>09_multilayer_maps.ipynb</code>.</p>
<hr />
<div id="overview-7" class="section level2">
<h2>Overview</h2>
<p><a href="https://python-visualization.github.io/folium/">Folium</a> supports creating maps with multiple layers. Recent versions of GeoPandas have built-in support to create interactive folium maps from a GeoDataFrame.</p>
<p>In this section, we will create a multi-layer interactive map using 2 vector datasets.</p>
</div>
<div id="setup-and-data-download-6" class="section level2">
<h2>Setup and Data Download</h2>
<div class="sourceCode" id="cb141"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>capture</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">&#39;google.colab&#39;</span> <span class="kw">in</span> <span class="bu">str</span>(get_ipython()):</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">!</span>apt install libspatialindex<span class="op">-</span>dev</span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">!</span>pip install fiona shapely pyproj rtree mapclassify</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">!</span>pip install geopandas</span></code></pre></div>
<div class="sourceCode" id="cb142"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> folium <span class="im">import</span> Figure</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span></code></pre></div>
<div class="sourceCode" id="cb143"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>data_folder <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>output_folder <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(data_folder):</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>    os.mkdir(data_folder)</span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(output_folder):</span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>    os.mkdir(output_folder)</span></code></pre></div>
<div class="sourceCode" id="cb144"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> download(url):</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>    filename <span class="op">=</span> os.path.join(data_folder, os.path.basename(url))</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(filename):</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>        <span class="im">from</span> urllib.request <span class="im">import</span> urlretrieve</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>        local, _ <span class="op">=</span> urlretrieve(url, filename)</span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;Downloaded &#39;</span> <span class="op">+</span> local)</span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">&#39;karnataka.gpkg&#39;</span></span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a>data_url <span class="op">=</span> <span class="st">&#39;https://github.com/spatialthoughts/python-dataviz-web/raw/main/data/osm/&#39;</span></span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a>download(data_url <span class="op">+</span> filename)</span></code></pre></div>
</div>
<div id="using-geopandas-explore" class="section level2">
<h2>Using GeoPandas explore()</h2>
<div class="sourceCode" id="cb145"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>data_pkg_path <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">&#39;karnataka.gpkg&#39;</span></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> os.path.join(data_pkg_path, filename)</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>roads_gdf <span class="op">=</span> gpd.read_file(path, layer<span class="op">=</span><span class="st">&#39;karntaka_highways&#39;</span>)</span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>districts_gdf <span class="op">=</span> gpd.read_file(path, layer<span class="op">=</span><span class="st">&#39;karnataka_districts&#39;</span>)</span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>state_gdf <span class="op">=</span> gpd.read_file(path, layer<span class="op">=</span><span class="st">&#39;karnataka&#39;</span>)</span></code></pre></div>
<p>We can use the <a href="https://geopandas.org/en/stable/docs/reference/api/geopandas.GeoDataFrame.explore.html">explore()</a> method to create an interactive folium map from the GeoDataFrame. When you call <code>explore()</code> a folium object is created. You can save that object and use it to display or add more layers to the map.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> districts_gdf.explore()</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<p>The default output of the <code>explore()</code> method is a full-width folium map. If you need more control, a better approach is to create a <code>follium.Figure</code> object and add the map to it. For this approach we need to first compute the extent of the map.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>bounds <span class="op">=</span> districts_gdf.total_bounds</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>bounds</span></code></pre></div>
<p>Now we can create a figure of the required size, and add a folium map to it. The <code>explore()</code> function takes a <code>m</code> agrument where we can supply an existing folium map to which to render the GeoDataFrame.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> Figure(width<span class="op">=</span><span class="dv">800</span>, height<span class="op">=</span><span class="dv">400</span>)</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> folium.Map()</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>m.fit_bounds([[bounds[<span class="dv">1</span>],bounds[<span class="dv">0</span>]], [bounds[<span class="dv">3</span>],bounds[<span class="dv">2</span>]]])</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>districts_gdf.explore(m<span class="op">=</span>m)</span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a>fig.add_child(m)</span></code></pre></div>
<div class="sourceCode" id="cb149"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> Figure(width<span class="op">=</span><span class="dv">800</span>, height<span class="op">=</span><span class="dv">400</span>)</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> folium.Map(tiles<span class="op">=</span><span class="st">&#39;Stamen Terrain&#39;</span>)</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>m.fit_bounds([[bounds[<span class="dv">1</span>],bounds[<span class="dv">0</span>]], [bounds[<span class="dv">3</span>],bounds[<span class="dv">2</span>]]])</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>districts_gdf.explore(</span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>    m<span class="op">=</span>m,</span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">&#39;black&#39;</span>, </span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>    style_kwds<span class="op">=</span>{<span class="st">&#39;fillOpacity&#39;</span>: <span class="fl">0.3</span>, <span class="st">&#39;weight&#39;</span>: <span class="fl">0.5</span>},</span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a>fig.add_child(m)</span></code></pre></div>
<div class="sourceCode" id="cb150"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>roads_gdf</span></code></pre></div>
<div class="sourceCode" id="cb151"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_category(row):</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>    ref <span class="op">=</span> <span class="bu">str</span>(row[<span class="st">&#39;ref&#39;</span>])</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">&#39;NH&#39;</span> <span class="kw">in</span> ref:</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;NH&#39;</span></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> <span class="st">&#39;SH&#39;</span> <span class="kw">in</span> ref:</span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;SH&#39;</span></span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&#39;NA&#39;</span></span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>roads_gdf[<span class="st">&#39;category&#39;</span>] <span class="op">=</span> roads_gdf.<span class="bu">apply</span>(get_category, axis<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="sourceCode" id="cb152"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> Figure(width<span class="op">=</span><span class="dv">800</span>, height<span class="op">=</span><span class="dv">400</span>)</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> folium.Map()</span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>m.fit_bounds([[bounds[<span class="dv">1</span>],bounds[<span class="dv">0</span>]], [bounds[<span class="dv">3</span>],bounds[<span class="dv">2</span>]]])</span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>roads_gdf.explore(</span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a>    m<span class="op">=</span>m,</span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a>    column<span class="op">=</span><span class="st">&#39;category&#39;</span>, </span>
<span id="cb152-9"><a href="#cb152-9" aria-hidden="true" tabindex="-1"></a>    categories<span class="op">=</span>[<span class="st">&#39;NH&#39;</span>, <span class="st">&#39;SH&#39;</span>], </span>
<span id="cb152-10"><a href="#cb152-10" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span>[<span class="st">&#39;#1f78b4&#39;</span>, <span class="st">&#39;#e31a1c&#39;</span>],</span>
<span id="cb152-11"><a href="#cb152-11" aria-hidden="true" tabindex="-1"></a>    categorical<span class="op">=</span><span class="va">True</span></span>
<span id="cb152-12"><a href="#cb152-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb152-13"><a href="#cb152-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-14"><a href="#cb152-14" aria-hidden="true" tabindex="-1"></a>fig.add_child(m)</span></code></pre></div>
</div>
<div id="create-multi-layer-maps" class="section level2">
<h2>Create Multi-layer Maps</h2>
<p>When you call <code>explore()</code> a folium object is created. You can save that object and add more layers to the same object.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> Figure(width<span class="op">=</span><span class="dv">800</span>, height<span class="op">=</span><span class="dv">400</span>)</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> folium.Map(tiles<span class="op">=</span><span class="st">&#39;Stamen Terrain&#39;</span>)</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>m.fit_bounds([[bounds[<span class="dv">1</span>],bounds[<span class="dv">0</span>]], [bounds[<span class="dv">3</span>],bounds[<span class="dv">2</span>]]])</span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>districts_gdf.explore(</span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>    m<span class="op">=</span>m,</span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">&#39;black&#39;</span>, </span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a>    style_kwds<span class="op">=</span>{<span class="st">&#39;fillOpacity&#39;</span>: <span class="fl">0.3</span>, <span class="st">&#39;weight&#39;</span>:<span class="fl">0.5</span>},</span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">&#39;districts&#39;</span>,</span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb153-12"><a href="#cb153-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-13"><a href="#cb153-13" aria-hidden="true" tabindex="-1"></a>roads_gdf.explore(</span>
<span id="cb153-14"><a href="#cb153-14" aria-hidden="true" tabindex="-1"></a>    m<span class="op">=</span>m,</span>
<span id="cb153-15"><a href="#cb153-15" aria-hidden="true" tabindex="-1"></a>    column<span class="op">=</span><span class="st">&#39;category&#39;</span>, </span>
<span id="cb153-16"><a href="#cb153-16" aria-hidden="true" tabindex="-1"></a>    categories<span class="op">=</span>[<span class="st">&#39;NH&#39;</span>, <span class="st">&#39;SH&#39;</span>], </span>
<span id="cb153-17"><a href="#cb153-17" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span>[<span class="st">&#39;#1f78b4&#39;</span>, <span class="st">&#39;#e31a1c&#39;</span>],</span>
<span id="cb153-18"><a href="#cb153-18" aria-hidden="true" tabindex="-1"></a>    categorical<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb153-19"><a href="#cb153-19" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">&#39;highways&#39;</span></span>
<span id="cb153-20"><a href="#cb153-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb153-21"><a href="#cb153-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-22"><a href="#cb153-22" aria-hidden="true" tabindex="-1"></a>fig.add_child(m)</span></code></pre></div>
<p>To make our map easier to explore, we also add a <em>Layer Control</em> that displays the list of layers on the top-right corner and also allows the users to turn them on or off. The <code>name</code> parameter to the <code>explore()</code> function controls the name that will be displayed in the layer control.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>folium.LayerControl().add_to(m)</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
</div>
<div id="exercise-7" class="section level2">
<h2>Exercise</h2>
<p>Add the <code>state_gdf</code> layer to the folium map below with a thick blue border and no fill. Save the resulting map as a HTML file on your computer.</p>
<p>Hint: Use the <code>style_kwds</code> with <em>‘fill’</em> and <em>‘weight’</em> options.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> Figure(width<span class="op">=</span><span class="dv">800</span>, height<span class="op">=</span><span class="dv">400</span>)</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> folium.Map(tiles<span class="op">=</span><span class="st">&#39;Stamen Terrain&#39;</span>)</span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>m.fit_bounds([[bounds[<span class="dv">1</span>],bounds[<span class="dv">0</span>]], [bounds[<span class="dv">3</span>],bounds[<span class="dv">2</span>]]])</span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a>districts_gdf.explore(</span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a>    m<span class="op">=</span>m,</span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">&#39;black&#39;</span>, </span>
<span id="cb155-9"><a href="#cb155-9" aria-hidden="true" tabindex="-1"></a>    style_kwds<span class="op">=</span>{<span class="st">&#39;fillOpacity&#39;</span>: <span class="fl">0.3</span>, <span class="st">&#39;weight&#39;</span>:<span class="fl">0.5</span>},</span>
<span id="cb155-10"><a href="#cb155-10" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">&#39;districts&#39;</span>,</span>
<span id="cb155-11"><a href="#cb155-11" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb155-12"><a href="#cb155-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-13"><a href="#cb155-13" aria-hidden="true" tabindex="-1"></a>roads_gdf.explore(</span>
<span id="cb155-14"><a href="#cb155-14" aria-hidden="true" tabindex="-1"></a>    m<span class="op">=</span>m,</span>
<span id="cb155-15"><a href="#cb155-15" aria-hidden="true" tabindex="-1"></a>    column<span class="op">=</span><span class="st">&#39;category&#39;</span>, </span>
<span id="cb155-16"><a href="#cb155-16" aria-hidden="true" tabindex="-1"></a>    categories<span class="op">=</span>[<span class="st">&#39;NH&#39;</span>, <span class="st">&#39;SH&#39;</span>], </span>
<span id="cb155-17"><a href="#cb155-17" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span>[<span class="st">&#39;#1f78b4&#39;</span>, <span class="st">&#39;#e31a1c&#39;</span>],</span>
<span id="cb155-18"><a href="#cb155-18" aria-hidden="true" tabindex="-1"></a>    categorical<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb155-19"><a href="#cb155-19" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">&#39;highways&#39;</span></span>
<span id="cb155-20"><a href="#cb155-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb155-21"><a href="#cb155-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-22"><a href="#cb155-22" aria-hidden="true" tabindex="-1"></a>fig.add_child(m)</span>
<span id="cb155-23"><a href="#cb155-23" aria-hidden="true" tabindex="-1"></a>folium.LayerControl().add_to(m)</span>
<span id="cb155-24"><a href="#cb155-24" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
</div>
</div>
<div id="leafmap-basics" class="section level1">
<h1>Leafmap Basics</h1>
<p><a href="https://colab.research.google.com/github/spatialthoughts/python-dataviz-web/blob/main/10_leafmap_basics.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab" /></a></p>
<hr />
<div id="overview-8" class="section level2">
<h2>Overview</h2>
<p><a href="https://leafmap.org/">Leafmap</a> is a Python package for interactive mapping that supports a wide-variety of plotting backends.</p>
<p>We will explore the capabilities of Leafmap and create a map that includes vector and raster layers.</p>
</div>
<div id="setup-and-data-download-7" class="section level2">
<h2>Setup and Data Download</h2>
<div class="sourceCode" id="cb156"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>capture</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">&#39;google.colab&#39;</span> <span class="kw">in</span> <span class="bu">str</span>(get_ipython()):</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">!</span>apt install libspatialindex<span class="op">-</span>dev</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">!</span>pip install fiona shapely pyproj rtree mapclassify</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">!</span>pip install geopandas</span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">!</span>pip install leafmap</span></code></pre></div>
<div class="sourceCode" id="cb157"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> leafmap.foliumap <span class="im">as</span> leafmap</span></code></pre></div>
<div class="sourceCode" id="cb158"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>data_folder <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>output_folder <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(data_folder):</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>    os.mkdir(data_folder)</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(output_folder):</span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>    os.mkdir(output_folder)</span></code></pre></div>
<div class="sourceCode" id="cb159"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> download(url):</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>    filename <span class="op">=</span> os.path.join(data_folder, os.path.basename(url))</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(filename):</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>        <span class="im">from</span> urllib.request <span class="im">import</span> urlretrieve</span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>        local, _ <span class="op">=</span> urlretrieve(url, filename)</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&#39;Downloaded &#39;</span> <span class="op">+</span> local)</span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a>json_file <span class="op">=</span> <span class="st">&#39;bangalore_wards.json&#39;</span></span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a>gpkg_file <span class="op">=</span> <span class="st">&#39;bangalore_roads.gpkg&#39;</span></span>
<span id="cb159-10"><a href="#cb159-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-11"><a href="#cb159-11" aria-hidden="true" tabindex="-1"></a>data_url <span class="op">=</span> <span class="st">&#39;https://github.com/spatialthoughts/python-dataviz-web/raw/main/data/bangalore/&#39;</span></span>
<span id="cb159-12"><a href="#cb159-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-13"><a href="#cb159-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> f <span class="kw">in</span> json_file, gpkg_file:</span>
<span id="cb159-14"><a href="#cb159-14" aria-hidden="true" tabindex="-1"></a>  download(data_url <span class="op">+</span> f)</span></code></pre></div>
</div>
<div id="leafmap-basics-1" class="section level2">
<h2>Leafmap Basics</h2>
<p>Reference: <a href="https://leafmap.org/notebooks/00_key_features/">Leafmap Key Features</a></p>
<div class="sourceCode" id="cb160"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> leafmap.Map(width<span class="op">=</span><span class="dv">800</span>, height<span class="op">=</span><span class="dv">500</span>)</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<p>Leafmap’s <code>foliummap</code> module supports adding a variety of data types along with helper functions.</p>
<p>Reference: <a href="https://leafmap.org/foliumap/#leafmap.foliumap.Map.add_geojson">leafmap.foliumap.Map.add_geojson</a></p>
<div class="sourceCode" id="cb161"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> leafmap.Map(width<span class="op">=</span><span class="dv">800</span>, height<span class="op">=</span><span class="dv">500</span>)</span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>json_filepath <span class="op">=</span> os.path.join(data_folder, json_file)</span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a>m.add_geojson(json_filepath, layer_name<span class="op">=</span><span class="st">&#39;City&#39;</span>)</span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a>m.set_center(<span class="fl">77.59</span>, <span class="fl">12.97</span>, <span class="dv">10</span>)</span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<div class="sourceCode" id="cb162"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> leafmap.Map(width<span class="op">=</span><span class="dv">800</span>, height<span class="op">=</span><span class="dv">500</span>)</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>gpkg_filepath <span class="op">=</span> os.path.join(data_folder, gpkg_file)</span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>roads_gdf <span class="op">=</span> gpd.read_file(gpkg_filepath)</span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>m.add_gdf(roads_gdf, layer_name<span class="op">=</span><span class="st">&#39;Roads&#39;</span>, style<span class="op">=</span>{<span class="st">&#39;color&#39;</span>:<span class="st">&#39;blue&#39;</span>, <span class="st">&#39;weight&#39;</span>:<span class="fl">0.5</span>})</span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a>m.zoom_to_gdf(roads_gdf)</span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<div class="sourceCode" id="cb163"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> leafmap.Map(width<span class="op">=</span><span class="dv">800</span>, height<span class="op">=</span><span class="dv">500</span>)</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>cog_url <span class="op">=</span> os.path.join(data_url, <span class="st">&#39;bangalore_lulc.tif&#39;</span>)</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>bounds <span class="op">=</span> leafmap.cog_bounds(cog_url)</span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>m.add_cog_layer(cog_url, layer_name<span class="op">=</span><span class="st">&#39;Land Use Land Cover&#39;</span>)</span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>m.zoom_to_bounds(bounds)</span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
</div>
<div id="exercise-8" class="section level2">
<h2>Exercise</h2>
<p>Leafmap also supports adding custom legends. Below cell contains the color codes and labels for the land cover classes contained in the <code>bangalore_lulc.tif</code> image. Add a legend to the map using the <code>add_legend()</code> function.</p>
<p>Reference: <a href="https://leafmap.org/foliumap/#leafmap.foliumap.Map.add_legend">leafmap.foliumap.Map.add_legend</a></p>
<div class="sourceCode" id="cb164"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> leafmap.Map(width<span class="op">=</span><span class="dv">800</span>, height<span class="op">=</span><span class="dv">500</span>)</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>cog_url <span class="op">=</span> os.path.join(data_url, <span class="st">&#39;bangalore_lulc.tif&#39;</span>)</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>bounds <span class="op">=</span> leafmap.cog_bounds(cog_url)</span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>m.add_cog_layer(cog_url, layer_name<span class="op">=</span><span class="st">&#39;Land Use Land Cover&#39;</span>)</span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>m.zoom_to_bounds(bounds)</span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-9"><a href="#cb164-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a Legend</span></span>
<span id="cb164-10"><a href="#cb164-10" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [<span class="st">&#39;#006400&#39;</span>, <span class="st">&#39;#ffbb22&#39;</span>,<span class="st">&#39;#ffff4c&#39;</span>,<span class="st">&#39;#f096ff&#39;</span>,<span class="st">&#39;#fa0000&#39;</span>,</span>
<span id="cb164-11"><a href="#cb164-11" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;#b4b4b4&#39;</span>,<span class="st">&#39;#f0f0f0&#39;</span>,<span class="st">&#39;#0064c8&#39;</span>,<span class="st">&#39;#0096a0&#39;</span>,<span class="st">&#39;#00cf75&#39;</span>,<span class="st">&#39;#fae6a0&#39;</span>]</span>
<span id="cb164-12"><a href="#cb164-12" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> [<span class="st">&quot;Trees&quot;</span>,<span class="st">&quot;Shrubland&quot;</span>,<span class="st">&quot;Grassland&quot;</span>,<span class="st">&quot;Cropland&quot;</span>,<span class="st">&quot;Built-up&quot;</span>,</span>
<span id="cb164-13"><a href="#cb164-13" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;Barren / sparse vegetation&quot;</span>,<span class="st">&quot;Snow and ice&quot;</span>,<span class="st">&quot;Open water&quot;</span>,</span>
<span id="cb164-14"><a href="#cb164-14" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;Herbaceous wetland&quot;</span>,<span class="st">&quot;Mangroves&quot;</span>,<span class="st">&quot;Moss and lichen&quot;</span>]</span>
<span id="cb164-15"><a href="#cb164-15" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div id="streamlit-basics" class="section level1">
<h1>Streamlit Basics</h1>
<p>Streamlit is a Python library that allows you to create web-apps and dashboard by just writing Python code. It provides you with a wide range of UI widgets and layouts that can be used to build user=interfaces. Your streamlit app is just a regular Python file with a <code>.py</code> extension.</p>
<div id="installation-and-setting-up-the-environment" class="section level2">
<h2>Installation and Setting up the Environment</h2>
<p>You need to install the <code>streamlit</code> package to create the app. We will be using Anaconda to insteall <code>streamlit</code> and related packages on your machine. Please review the <a href="https://courses.spatialthoughts.com/python-foundation.html#installation-and-setting-up-the-environment">Anaconda Installation Guide</a> for step-by-step instructions.</p>
<p>Once you have installed Anaconda, open <em>Anaconda Prompt</em> or a <em>Terminal</em> and run the following commands.</p>
<pre><code>conda create --name streamlit -y
conda activate streamlit
conda install -c conda-forge streamlit leafmap geopandas -y</code></pre>
</div>
</div>
<div id="building-apps-and-dashboards-with-streamlit" class="section level1">
<h1>Building Apps and Dashboards with Streamlit</h1>
<p>The code below creates an interactive mapping dashboard that displays the statistics of the selected region.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> streamlit <span class="im">as</span> st</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> leafmap.foliumap <span class="im">as</span> leafmap</span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a>st.set_page_config(page_title<span class="op">=</span><span class="st">&quot;Dashboard&quot;</span>, layout<span class="op">=</span><span class="st">&quot;wide&quot;</span>)</span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-11"><a href="#cb166-11" aria-hidden="true" tabindex="-1"></a>st.title(<span class="st">&#39;National Highway Dashboard&#39;</span>)</span>
<span id="cb166-12"><a href="#cb166-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-13"><a href="#cb166-13" aria-hidden="true" tabindex="-1"></a>st.sidebar.title(<span class="st">&quot;About&quot;</span>)</span>
<span id="cb166-14"><a href="#cb166-14" aria-hidden="true" tabindex="-1"></a>st.sidebar.info(<span class="st">&#39;Explore the Roads&#39;</span>)</span>
<span id="cb166-15"><a href="#cb166-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-16"><a href="#cb166-16" aria-hidden="true" tabindex="-1"></a>data_url <span class="op">=</span> <span class="st">&#39;https://github.com/spatialthoughts/python-dataviz-web/raw/main/data/osm/&#39;</span></span>
<span id="cb166-17"><a href="#cb166-17" aria-hidden="true" tabindex="-1"></a>gpkg_file <span class="op">=</span> <span class="st">&#39;karnataka.gpkg&#39;</span></span>
<span id="cb166-18"><a href="#cb166-18" aria-hidden="true" tabindex="-1"></a>csv_file <span class="op">=</span> <span class="st">&#39;highway_lengths_by_district.csv&#39;</span></span>
<span id="cb166-19"><a href="#cb166-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-20"><a href="#cb166-20" aria-hidden="true" tabindex="-1"></a><span class="at">@st.cache</span></span>
<span id="cb166-21"><a href="#cb166-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_gdf(url, layer):</span>
<span id="cb166-22"><a href="#cb166-22" aria-hidden="true" tabindex="-1"></a>    gdf <span class="op">=</span> gpd.read_file(url, layer<span class="op">=</span>layer)</span>
<span id="cb166-23"><a href="#cb166-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> gdf</span>
<span id="cb166-24"><a href="#cb166-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-25"><a href="#cb166-25" aria-hidden="true" tabindex="-1"></a><span class="at">@st.cache</span></span>
<span id="cb166-26"><a href="#cb166-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_csv(url):</span>
<span id="cb166-27"><a href="#cb166-27" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(url)</span>
<span id="cb166-28"><a href="#cb166-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb166-29"><a href="#cb166-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb166-30"><a href="#cb166-30" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb166-31"><a href="#cb166-31" aria-hidden="true" tabindex="-1"></a>gpkg_url <span class="op">=</span> data_url <span class="op">+</span> gpkg_file</span>
<span id="cb166-32"><a href="#cb166-32" aria-hidden="true" tabindex="-1"></a>csv_url <span class="op">=</span> data_url <span class="op">+</span> csv_file</span>
<span id="cb166-33"><a href="#cb166-33" aria-hidden="true" tabindex="-1"></a>districts_gdf <span class="op">=</span> read_gdf(gpkg_url, <span class="st">&#39;karnataka_districts&#39;</span>)</span>
<span id="cb166-34"><a href="#cb166-34" aria-hidden="true" tabindex="-1"></a>roads_gdf <span class="op">=</span> read_gdf(gpkg_url, <span class="st">&#39;karnataka_highways&#39;</span>)</span>
<span id="cb166-35"><a href="#cb166-35" aria-hidden="true" tabindex="-1"></a>lengths_df <span class="op">=</span> read_csv(csv_url)</span>
<span id="cb166-36"><a href="#cb166-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-37"><a href="#cb166-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-38"><a href="#cb166-38" aria-hidden="true" tabindex="-1"></a>districts <span class="op">=</span> districts_gdf.DISTRICT.values</span>
<span id="cb166-39"><a href="#cb166-39" aria-hidden="true" tabindex="-1"></a>district <span class="op">=</span> st.sidebar.selectbox(<span class="st">&#39;Select a District&#39;</span>, districts)</span>
<span id="cb166-40"><a href="#cb166-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-41"><a href="#cb166-41" aria-hidden="true" tabindex="-1"></a>district_lengths <span class="op">=</span> lengths_df[lengths_df[<span class="st">&#39;DISTRICT&#39;</span>] <span class="op">==</span> district]</span>
<span id="cb166-42"><a href="#cb166-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-43"><a href="#cb166-43" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb166-44"><a href="#cb166-44" aria-hidden="true" tabindex="-1"></a>district_lengths.plot(kind<span class="op">=</span><span class="st">&#39;bar&#39;</span>, ax<span class="op">=</span>ax, color<span class="op">=</span>[<span class="st">&#39;blue&#39;</span>, <span class="st">&#39;red&#39;</span>],</span>
<span id="cb166-45"><a href="#cb166-45" aria-hidden="true" tabindex="-1"></a>    ylabel<span class="op">=</span><span class="st">&#39;Kilometers&#39;</span>, xlabel<span class="op">=</span><span class="st">&#39;Category&#39;</span>)</span>
<span id="cb166-46"><a href="#cb166-46" aria-hidden="true" tabindex="-1"></a>ax.get_xaxis().set_ticklabels([])</span>
<span id="cb166-47"><a href="#cb166-47" aria-hidden="true" tabindex="-1"></a>stats <span class="op">=</span> st.sidebar.pyplot(fig)</span>
<span id="cb166-48"><a href="#cb166-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-49"><a href="#cb166-49" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> leafmap.Map(</span>
<span id="cb166-50"><a href="#cb166-50" aria-hidden="true" tabindex="-1"></a>    layers_control<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb166-51"><a href="#cb166-51" aria-hidden="true" tabindex="-1"></a>    draw_control<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb166-52"><a href="#cb166-52" aria-hidden="true" tabindex="-1"></a>    measure_control<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb166-53"><a href="#cb166-53" aria-hidden="true" tabindex="-1"></a>    fullscreen_control<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb166-54"><a href="#cb166-54" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb166-55"><a href="#cb166-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-56"><a href="#cb166-56" aria-hidden="true" tabindex="-1"></a>m.add_gdf(</span>
<span id="cb166-57"><a href="#cb166-57" aria-hidden="true" tabindex="-1"></a>    gdf<span class="op">=</span>districts_gdf,</span>
<span id="cb166-58"><a href="#cb166-58" aria-hidden="true" tabindex="-1"></a>    layer_name<span class="op">=</span><span class="st">&#39;districts&#39;</span>,</span>
<span id="cb166-59"><a href="#cb166-59" aria-hidden="true" tabindex="-1"></a>    zoom_to_layer<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb166-60"><a href="#cb166-60" aria-hidden="true" tabindex="-1"></a>    info_mode<span class="op">=</span><span class="st">&#39;on_click&#39;</span>,</span>
<span id="cb166-61"><a href="#cb166-61" aria-hidden="true" tabindex="-1"></a>    style<span class="op">=</span>{<span class="st">&#39;color&#39;</span>: <span class="st">&#39;black&#39;</span>, <span class="st">&#39;fillOpacity&#39;</span>: <span class="fl">0.3</span>, <span class="st">&#39;weight&#39;</span>: <span class="fl">0.5</span>},</span>
<span id="cb166-62"><a href="#cb166-62" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb166-63"><a href="#cb166-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-64"><a href="#cb166-64" aria-hidden="true" tabindex="-1"></a>selected_gdf <span class="op">=</span> districts_gdf[districts_gdf[<span class="st">&#39;DISTRICT&#39;</span>] <span class="op">==</span> district]</span>
<span id="cb166-65"><a href="#cb166-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-66"><a href="#cb166-66" aria-hidden="true" tabindex="-1"></a>m.add_gdf(</span>
<span id="cb166-67"><a href="#cb166-67" aria-hidden="true" tabindex="-1"></a>    gdf<span class="op">=</span>selected_gdf,</span>
<span id="cb166-68"><a href="#cb166-68" aria-hidden="true" tabindex="-1"></a>    layer_name<span class="op">=</span><span class="st">&#39;selected&#39;</span>,</span>
<span id="cb166-69"><a href="#cb166-69" aria-hidden="true" tabindex="-1"></a>    zoom_to_layer<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb166-70"><a href="#cb166-70" aria-hidden="true" tabindex="-1"></a>    info_mode<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb166-71"><a href="#cb166-71" aria-hidden="true" tabindex="-1"></a>    style<span class="op">=</span>{<span class="st">&#39;color&#39;</span>: <span class="st">&#39;yellow&#39;</span>, <span class="st">&#39;fill&#39;</span>: <span class="va">None</span>, <span class="st">&#39;weight&#39;</span>: <span class="dv">2</span>}</span>
<span id="cb166-72"><a href="#cb166-72" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb166-73"><a href="#cb166-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-74"><a href="#cb166-74" aria-hidden="true" tabindex="-1"></a>m_streamlit <span class="op">=</span> m.to_streamlit(<span class="dv">500</span>, <span class="dv">500</span>)</span></code></pre></div>
</div>
<div id="supplement" class="section level1">
<h1>Supplement</h1>
<div id="elevation-profile-plot-from-a-gps-track" class="section level2">
<h2>Elevation Profile Plot from a GPS Track</h2>
<div class="sourceCode" id="cb167"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.dates <span class="im">as</span> mdates</span></code></pre></div>
<div class="sourceCode" id="cb168"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>data_pkg_path <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>gpx_path <span class="op">=</span> os.path.join(data_pkg_path, <span class="st">&#39;gps&#39;</span>, <span class="st">&#39;summit.gpx&#39;</span>)</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a><span class="co"># GPX files contain many layers. Read the &#39;track_points&#39; layer</span></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gpd.read_file(gpx_path, layer<span class="op">=</span><span class="st">&#39;track_points&#39;</span>)</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gdf[[<span class="st">&#39;track_fid&#39;</span>,<span class="st">&#39;ele&#39;</span>, <span class="st">&#39;time&#39;</span>, <span class="st">&#39;geometry&#39;</span>]]</span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>gdf</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
track_fid
</th>
<th>
ele
</th>
<th>
time
</th>
<th>
geometry
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
0
</td>
<td>
3187.3
</td>
<td>
2022-04-04 00:07:42+00:00
</td>
<td>
POINT (78.56758 30.82669)
</td>
</tr>
<tr>
<th>
1
</th>
<td>
0
</td>
<td>
3194.4
</td>
<td>
2022-04-04 00:07:54+00:00
</td>
<td>
POINT (78.56747 30.82667)
</td>
</tr>
<tr>
<th>
2
</th>
<td>
0
</td>
<td>
3196.6
</td>
<td>
2022-04-04 00:07:59+00:00
</td>
<td>
POINT (78.56743 30.82670)
</td>
</tr>
<tr>
<th>
3
</th>
<td>
0
</td>
<td>
3196.8
</td>
<td>
2022-04-04 00:08:04+00:00
</td>
<td>
POINT (78.56741 30.82671)
</td>
</tr>
<tr>
<th>
4
</th>
<td>
0
</td>
<td>
3198.2
</td>
<td>
2022-04-04 00:08:14+00:00
</td>
<td>
POINT (78.56739 30.82668)
</td>
</tr>
<tr>
<th>
…
</th>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
</tr>
<tr>
<th>
2305
</th>
<td>
0
</td>
<td>
3150.8
</td>
<td>
2022-04-04 06:05:58+00:00
</td>
<td>
POINT (78.56878 30.82703)
</td>
</tr>
<tr>
<th>
2306
</th>
<td>
0
</td>
<td>
3150.5
</td>
<td>
2022-04-04 06:06:01+00:00
</td>
<td>
POINT (78.56879 30.82704)
</td>
</tr>
<tr>
<th>
2307
</th>
<td>
0
</td>
<td>
3150.3
</td>
<td>
2022-04-04 06:06:06+00:00
</td>
<td>
POINT (78.56883 30.82707)
</td>
</tr>
<tr>
<th>
2308
</th>
<td>
0
</td>
<td>
3150.3
</td>
<td>
2022-04-04 06:06:11+00:00
</td>
<td>
POINT (78.56878 30.82710)
</td>
</tr>
<tr>
<th>
2309
</th>
<td>
0
</td>
<td>
3150.5
</td>
<td>
2022-04-04 06:06:16+00:00
</td>
<td>
POINT (78.56877 30.82709)
</td>
</tr>
</tbody>
</table>
<p>
2310 rows × 4 columns
</p>
</div>
<p>Let’s use the timestamp contained in the ‘time’ column as the index. This will allow us to filter and plot the time-series data easily. We must first convert the time column to datetime type with an appropriate timezone.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>gdf[<span class="st">&#39;time&#39;</span>] <span class="op">=</span> pd.to_datetime(gdf[<span class="st">&#39;time&#39;</span>])</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gdf.set_index(<span class="st">&#39;time&#39;</span>)</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>gdf.index <span class="op">=</span> gdf.index.tz_convert(<span class="st">&#39;Asia/Kolkata&#39;</span>)</span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>gdf</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
track_fid
</th>
<th>
ele
</th>
<th>
geometry
</th>
</tr>
<tr>
<th>
time
</th>
<th>
</th>
<th>
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
2022-04-04 05:37:42+05:30
</th>
<td>
0
</td>
<td>
3187.3
</td>
<td>
POINT (78.56758 30.82669)
</td>
</tr>
<tr>
<th>
2022-04-04 05:37:54+05:30
</th>
<td>
0
</td>
<td>
3194.4
</td>
<td>
POINT (78.56747 30.82667)
</td>
</tr>
<tr>
<th>
2022-04-04 05:37:59+05:30
</th>
<td>
0
</td>
<td>
3196.6
</td>
<td>
POINT (78.56743 30.82670)
</td>
</tr>
<tr>
<th>
2022-04-04 05:38:04+05:30
</th>
<td>
0
</td>
<td>
3196.8
</td>
<td>
POINT (78.56741 30.82671)
</td>
</tr>
<tr>
<th>
2022-04-04 05:38:14+05:30
</th>
<td>
0
</td>
<td>
3198.2
</td>
<td>
POINT (78.56739 30.82668)
</td>
</tr>
<tr>
<th>
…
</th>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
</tr>
<tr>
<th>
2022-04-04 11:35:58+05:30
</th>
<td>
0
</td>
<td>
3150.8
</td>
<td>
POINT (78.56878 30.82703)
</td>
</tr>
<tr>
<th>
2022-04-04 11:36:01+05:30
</th>
<td>
0
</td>
<td>
3150.5
</td>
<td>
POINT (78.56879 30.82704)
</td>
</tr>
<tr>
<th>
2022-04-04 11:36:06+05:30
</th>
<td>
0
</td>
<td>
3150.3
</td>
<td>
POINT (78.56883 30.82707)
</td>
</tr>
<tr>
<th>
2022-04-04 11:36:11+05:30
</th>
<td>
0
</td>
<td>
3150.3
</td>
<td>
POINT (78.56878 30.82710)
</td>
</tr>
<tr>
<th>
2022-04-04 11:36:16+05:30
</th>
<td>
0
</td>
<td>
3150.5
</td>
<td>
POINT (78.56877 30.82709)
</td>
</tr>
</tbody>
</table>
<p>
2310 rows × 3 columns
</p>
</div>
<p>Using time as index allows us to filter the data as follows</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>gdf_subset <span class="op">=</span> gdf[<span class="st">&#39;2022-04-04T09:00:00&#39;</span>:<span class="st">&#39;2022-04-04T09:30:00&#39;</span>]</span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>gdf_subset</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
track_fid
</th>
<th>
ele
</th>
<th>
geometry
</th>
</tr>
<tr>
<th>
time
</th>
<th>
</th>
<th>
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
2022-04-04 09:08:44+05:30
</th>
<td>
0
</td>
<td>
3626.1
</td>
<td>
POINT (78.54941 30.83630)
</td>
</tr>
<tr>
<th>
2022-04-04 09:10:01+05:30
</th>
<td>
0
</td>
<td>
3625.7
</td>
<td>
POINT (78.54940 30.83636)
</td>
</tr>
<tr>
<th>
2022-04-04 09:10:06+05:30
</th>
<td>
0
</td>
<td>
3625.7
</td>
<td>
POINT (78.54940 30.83636)
</td>
</tr>
<tr>
<th>
2022-04-04 09:11:25+05:30
</th>
<td>
0
</td>
<td>
3626.4
</td>
<td>
POINT (78.54939 30.83628)
</td>
</tr>
<tr>
<th>
2022-04-04 09:11:30+05:30
</th>
<td>
0
</td>
<td>
3626.4
</td>
<td>
POINT (78.54940 30.83629)
</td>
</tr>
<tr>
<th>
…
</th>
<td>
…
</td>
<td>
…
</td>
<td>
…
</td>
</tr>
<tr>
<th>
2022-04-04 09:29:38+05:30
</th>
<td>
0
</td>
<td>
3539.5
</td>
<td>
POINT (78.55257 30.83533)
</td>
</tr>
<tr>
<th>
2022-04-04 09:29:41+05:30
</th>
<td>
0
</td>
<td>
3539.9
</td>
<td>
POINT (78.55259 30.83532)
</td>
</tr>
<tr>
<th>
2022-04-04 09:29:46+05:30
</th>
<td>
0
</td>
<td>
3539.1
</td>
<td>
POINT (78.55261 30.83530)
</td>
</tr>
<tr>
<th>
2022-04-04 09:29:51+05:30
</th>
<td>
0
</td>
<td>
3539.0
</td>
<td>
POINT (78.55265 30.83529)
</td>
</tr>
<tr>
<th>
2022-04-04 09:29:56+05:30
</th>
<td>
0
</td>
<td>
3538.4
</td>
<td>
POINT (78.55269 30.83528)
</td>
</tr>
</tbody>
</table>
<p>
166 rows × 3 columns
</p>
</div>
<p>We can now plot the elevation against the timestamp using Matplotlib. Since we have a large number of timestamps, we can use <code>set_major_locator()</code> to define what labels will be present on the axis.</p>
<p>Since our timestamps are timezone aware, we can also plot a timezone name (i.e. IST) along with the label.</p>
<p>We can also use a different style for our plot. You can run <code>plt.style.available</code> to see all available styles.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">&#39;ggplot&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb172"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">15</span>,<span class="dv">7</span>)</span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>gdf[<span class="st">&#39;ele&#39;</span>].plot(kind<span class="op">=</span><span class="st">&#39;line&#39;</span>, ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">&#39;#2b8cbe&#39;</span>)</span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Elevation Profile&#39;</span>, fontsize <span class="op">=</span> <span class="dv">18</span>)</span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Elevation (meters)&#39;</span>, size <span class="op">=</span> <span class="dv">15</span>)</span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="va">None</span>)</span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Show a tick every 30 minute</span></span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true" tabindex="-1"></a>xlocator <span class="op">=</span> mdates.MinuteLocator(interval<span class="op">=</span><span class="dv">30</span>)</span>
<span id="cb172-10"><a href="#cb172-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-11"><a href="#cb172-11" aria-hidden="true" tabindex="-1"></a>xformat <span class="op">=</span> mdates.DateFormatter(<span class="st">&#39;%H:%M %Z&#39;</span>, tz<span class="op">=</span>gdf.index.tz)  <span class="co"># adds some extra formatting, but not required</span></span>
<span id="cb172-12"><a href="#cb172-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-13"><a href="#cb172-13" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_major_locator(xlocator)</span>
<span id="cb172-14"><a href="#cb172-14" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_major_formatter(xformat)</span>
<span id="cb172-15"><a href="#cb172-15" aria-hidden="true" tabindex="-1"></a>ax.set_ylim([<span class="dv">3200</span>, <span class="dv">3700</span>])</span>
<span id="cb172-16"><a href="#cb172-16" aria-hidden="true" tabindex="-1"></a>ax.fill_between(gdf.index, gdf[<span class="st">&#39;ele&#39;</span>].values, color<span class="op">=</span><span class="st">&#39;grey&#39;</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb172-17"><a href="#cb172-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/supplement_elevation_profile_plot_files/supplement_elevation_profile_plot_10_0.png" /></p>
<div class="sourceCode" id="cb173"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">&#39;default&#39;</span>)</span></code></pre></div>
</div>
<div id="creating-a-stacked-bar-chart" class="section level2">
<h2>Creating A Stacked Bar Chart</h2>
<div class="sourceCode" id="cb174"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob</span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code></pre></div>
<p>We have 12 different CSV files containing crime data for each month of 2020. We can use the <code>glob</code> module to find all files matching a pattern.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>data_pkg_path <span class="op">=</span> <span class="st">&#39;data&#39;</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>folder <span class="op">=</span> <span class="st">&#39;crime&#39;</span></span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>file_pattern <span class="op">=</span> <span class="st">&#39;2020-*.csv&#39;</span></span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>file_path_pattern <span class="op">=</span> os.path.join(data_pkg_path, folder, file_pattern)</span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a>dataframe_list <span class="op">=</span> [pd.read_csv(f) <span class="cf">for</span> f <span class="kw">in</span> glob.glob(file_path_pattern)]</span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a>merged_df <span class="op">=</span> pd.concat(dataframe_list)</span></code></pre></div>
<p>We want to chart a stacked chart with information about crime type in each bar.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>counts_by_type <span class="op">=</span> merged_df.groupby([<span class="st">&#39;Month&#39;</span>, <span class="st">&#39;Crime type&#39;</span>]).size()</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>counts_by_type</span></code></pre></div>
<pre><code>Month    Crime type                  
2020-01  Anti-social behaviour           17548
         Bicycle theft                    1172
         Burglary                         6889
         Criminal damage and arson        4374
         Drugs                            4282
                                         ...  
2020-12  Robbery                          2021
         Shoplifting                      2690
         Theft from the person            3075
         Vehicle crime                    7758
         Violence and sexual offences    17836
Length: 168, dtype: int64</code></pre>
<p>The result is not in a suitable format for plotting. We call <code>unstack()</code> to create a dataframe.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>counts_df <span class="op">=</span> counts_by_type.unstack()</span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>counts_df</span></code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
Crime type
</th>
<th>
Anti-social behaviour
</th>
<th>
Bicycle theft
</th>
<th>
Burglary
</th>
<th>
Criminal damage and arson
</th>
<th>
Drugs
</th>
<th>
Other crime
</th>
<th>
Other theft
</th>
<th>
Possession of weapons
</th>
<th>
Public order
</th>
<th>
Robbery
</th>
<th>
Shoplifting
</th>
<th>
Theft from the person
</th>
<th>
Vehicle crime
</th>
<th>
Violence and sexual offences
</th>
</tr>
<tr>
<th>
Month
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
2020-01
</th>
<td>
17548
</td>
<td>
1172
</td>
<td>
6889
</td>
<td>
4374
</td>
<td>
4282
</td>
<td>
832
</td>
<td>
9497
</td>
<td>
562
</td>
<td>
4025
</td>
<td>
3263
</td>
<td>
3853
</td>
<td>
4256
</td>
<td>
11975
</td>
<td>
18451
</td>
</tr>
<tr>
<th>
2020-02
</th>
<td>
16975
</td>
<td>
1044
</td>
<td>
6216
</td>
<td>
4220
</td>
<td>
3818
</td>
<td>
757
</td>
<td>
9729
</td>
<td>
452
</td>
<td>
3842
</td>
<td>
3152
</td>
<td>
3845
</td>
<td>
4570
</td>
<td>
10405
</td>
<td>
17959
</td>
</tr>
<tr>
<th>
2020-03
</th>
<td>
23014
</td>
<td>
1078
</td>
<td>
5362
</td>
<td>
4392
</td>
<td>
3657
</td>
<td>
813
</td>
<td>
7531
</td>
<td>
483
</td>
<td>
3966
</td>
<td>
2711
</td>
<td>
2996
</td>
<td>
3414
</td>
<td>
9621
</td>
<td>
18371
</td>
</tr>
<tr>
<th>
2020-04
</th>
<td>
62763
</td>
<td>
1060
</td>
<td>
3661
</td>
<td>
3496
</td>
<td>
4978
</td>
<td>
751
</td>
<td>
3884
</td>
<td>
460
</td>
<td>
3464
</td>
<td>
1101
</td>
<td>
1691
</td>
<td>
677
</td>
<td>
6327
</td>
<td>
15638
</td>
</tr>
<tr>
<th>
2020-05
</th>
<td>
58502
</td>
<td>
1768
</td>
<td>
3886
</td>
<td>
3906
</td>
<td>
6427
</td>
<td>
823
</td>
<td>
4443
</td>
<td>
533
</td>
<td>
4250
</td>
<td>
1293
</td>
<td>
1956
</td>
<td>
795
</td>
<td>
7277
</td>
<td>
18149
</td>
</tr>
<tr>
<th>
2020-06
</th>
<td>
39584
</td>
<td>
2548
</td>
<td>
4320
</td>
<td>
4353
</td>
<td>
4665
</td>
<td>
882
</td>
<td>
5387
</td>
<td>
463
</td>
<td>
4966
</td>
<td>
1705
</td>
<td>
2400
</td>
<td>
1194
</td>
<td>
8102
</td>
<td>
19629
</td>
</tr>
<tr>
<th>
2020-07
</th>
<td>
35588
</td>
<td>
2833
</td>
<td>
4928
</td>
<td>
4692
</td>
<td>
4569
</td>
<td>
892
</td>
<td>
6977
</td>
<td>
453
</td>
<td>
5584
</td>
<td>
2168
</td>
<td>
3099
</td>
<td>
2072
</td>
<td>
8811
</td>
<td>
20991
</td>
</tr>
<tr>
<th>
2020-08
</th>
<td>
35842
</td>
<td>
3019
</td>
<td>
4995
</td>
<td>
4710
</td>
<td>
3534
</td>
<td>
780
</td>
<td>
7647
</td>
<td>
451
</td>
<td>
5490
</td>
<td>
2530
</td>
<td>
3006
</td>
<td>
2542
</td>
<td>
8919
</td>
<td>
21317
</td>
</tr>
<tr>
<th>
2020-09
</th>
<td>
30863
</td>
<td>
3078
</td>
<td>
5195
</td>
<td>
4274
</td>
<td>
3541
</td>
<td>
964
</td>
<td>
7516
</td>
<td>
503
</td>
<td>
5167
</td>
<td>
2599
</td>
<td>
3060
</td>
<td>
2696
</td>
<td>
9829
</td>
<td>
20348
</td>
</tr>
<tr>
<th>
2020-10
</th>
<td>
31186
</td>
<td>
2619
</td>
<td>
5618
</td>
<td>
4214
</td>
<td>
4124
</td>
<td>
812
</td>
<td>
7248
</td>
<td>
500
</td>
<td>
4577
</td>
<td>
2440
</td>
<td>
3222
</td>
<td>
3225
</td>
<td>
10148
</td>
<td>
19538
</td>
</tr>
<tr>
<th>
2020-11
</th>
<td>
33863
</td>
<td>
1985
</td>
<td>
5209
</td>
<td>
4205
</td>
<td>
4410
</td>
<td>
981
</td>
<td>
5734
</td>
<td>
511
</td>
<td>
4239
</td>
<td>
2286
</td>
<td>
2770
</td>
<td>
2568
</td>
<td>
9172
</td>
<td>
18981
</td>
</tr>
<tr>
<th>
2020-12
</th>
<td>
29377
</td>
<td>
1313
</td>
<td>
4765
</td>
<td>
4087
</td>
<td>
3624
</td>
<td>
779
</td>
<td>
6331
</td>
<td>
392
</td>
<td>
3888
</td>
<td>
2021
</td>
<td>
2690
</td>
<td>
3075
</td>
<td>
7758
</td>
<td>
17836
</td>
</tr>
</tbody>
</table>
</div>
<p>Now we can create the stacked bar chart. Instead of the default legend, we create a horizontal legend with a frame using the <code>legend()</code> function.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">20</span>,<span class="dv">10</span>)</span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a>counts_df.plot(kind<span class="op">=</span><span class="st">&#39;bar&#39;</span>, stacked<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax, colormap<span class="op">=</span><span class="st">&#39;tab20&#39;</span>)</span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">&#39;upper center&#39;</span>, ncol<span class="op">=</span><span class="dv">5</span>, frameon<span class="op">=</span><span class="va">True</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">0.5</span>, <span class="fl">1.1</span>), fancybox<span class="op">=</span><span class="va">True</span>, shadow<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb179-5"><a href="#cb179-5" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">&#39;right&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb179-6"><a href="#cb179-6" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">&#39;top&#39;</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb179-7"><a href="#cb179-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;Year&#39;</span>, size <span class="op">=</span> <span class="dv">15</span>)</span>
<span id="cb179-8"><a href="#cb179-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;Number of Incidents&#39;</span>, size <span class="op">=</span> <span class="dv">15</span>)</span>
<span id="cb179-9"><a href="#cb179-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;Crime in London (2020)&#39;</span>, size <span class="op">=</span> <span class="dv">18</span>, y<span class="op">=</span><span class="fl">1.1</span>)</span>
<span id="cb179-10"><a href="#cb179-10" aria-hidden="true" tabindex="-1"></a>output_folder <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb179-11"><a href="#cb179-11" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(output_folder, <span class="st">&#39;stacked_chart.jpg&#39;</span>)</span>
<span id="cb179-12"><a href="#cb179-12" aria-hidden="true" tabindex="-1"></a>plt.savefig(output_path)</span>
<span id="cb179-13"><a href="#cb179-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p><img src="python-dataviz-output/supplement_stacked_barcharts_files/supplement_stacked_barcharts_9_0.png" /></p>
</div>
<div id="animations-with-matplotlib" class="section level2">
<h2>Animations with Matplotlib</h2>
<p>This notebook shows how to use the <code>FuncAnimation</code> function from the <code>matplotlib.animation</code> module to create animated plots.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.animation <span class="im">import</span> FuncAnimation, PillowWriter</span></code></pre></div>
<p>Let’s understand the basics of matplotlib animation with a simple example. We will define 3 positions and we will create an animation of a point moving between them.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>points <span class="op">=</span> [(<span class="fl">0.1</span>, <span class="fl">0.5</span>), (<span class="fl">0.5</span>, <span class="fl">0.5</span>), (<span class="fl">0.9</span>, <span class="fl">0.5</span>)]</span></code></pre></div>
<p>Then we use the <code>FuncAnimation</code> class which makes an animation by repeatedly calling a function and saving the output as a frame in the animation.</p>
<p>We need to define a function that takes the frame number and generates a plot from it. Here we define a function <code>animation</code> that takes the frame index and creates a plot from the point at the same index in the <code>points</code> list. So at frame 0, it will display the first point, frame 1 the second point and so on.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>fig.set_size_inches(<span class="dv">5</span>,<span class="dv">5</span>)</span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>fig.tight_layout(rect<span class="op">=</span>[<span class="dv">0</span>, <span class="fl">0.03</span>, <span class="dv">1</span>, <span class="fl">0.95</span>])</span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> animate(i):</span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a>    ax.clear()</span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the point from the points list at index i</span></span>
<span id="cb182-8"><a href="#cb182-8" aria-hidden="true" tabindex="-1"></a>    point <span class="op">=</span> points[i]</span>
<span id="cb182-9"><a href="#cb182-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot that point using the x and y coordinates</span></span>
<span id="cb182-10"><a href="#cb182-10" aria-hidden="true" tabindex="-1"></a>    ax.plot(point[<span class="dv">0</span>], point[<span class="dv">1</span>], color<span class="op">=</span><span class="st">&#39;green&#39;</span>, </span>
<span id="cb182-11"><a href="#cb182-11" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span><span class="st">&#39;original&#39;</span>, marker<span class="op">=</span><span class="st">&#39;o&#39;</span>)</span>
<span id="cb182-12"><a href="#cb182-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set the x and y axis to display a fixed range</span></span>
<span id="cb182-13"><a href="#cb182-13" aria-hidden="true" tabindex="-1"></a>    ax.set_xlim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb182-14"><a href="#cb182-14" aria-hidden="true" tabindex="-1"></a>    ax.set_ylim([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb182-15"><a href="#cb182-15" aria-hidden="true" tabindex="-1"></a>ani <span class="op">=</span> FuncAnimation(fig, animate, frames<span class="op">=</span><span class="bu">len</span>(points),</span>
<span id="cb182-16"><a href="#cb182-16" aria-hidden="true" tabindex="-1"></a>                    interval<span class="op">=</span><span class="dv">500</span>, repeat<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb182-17"><a href="#cb182-17" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code></pre></div>
<p>The animation is now contained in the <code>ani</code> object. We can call <code>save()</code> and save the result as an animated GIF. We need to specify a <code>writer</code> that supports the output format.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>output_folder <span class="op">=</span> <span class="st">&#39;output&#39;</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> os.path.join(output_folder, <span class="st">&#39;simple_animation.gif&#39;</span>)</span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>ani.save(output_path, dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>         writer<span class="op">=</span>PillowWriter(fps<span class="op">=</span><span class="dv">1</span>))</span></code></pre></div>
<p>We can also use the <code>to_jshtml()</code> function to create an HTML representation of the animation and display in a Jupyter notebook.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co">#from IPython.display import HTML</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a><span class="co">#HTML(ani.to_jshtml())</span></span></code></pre></div>
</div>
</div>
<div id="resources" class="section level1">
<h1>Resources</h1>
<ul>
<li><a href="https://jakevdp.github.io/PythonDataScienceHandbook/04.00-introduction-to-matplotlib.html">Visualization with Matplotlib</a>. Python Data Science Handbook by Jake VanderPlas</li>
</ul>
</div>
<div id="data-credits" class="section level1">
<h1>Data Credits</h1>
<ul>
<li>London Crime Statistics: ASB Incidents, Crime and Outcome - UK Home Office. Retrieved 2022-01-20. <a href="https://data.police.uk/about/" class="uri">https://data.police.uk/about/</a></li>
<li>California Census Data: U.S. Census Bureau, 2019 American Community Survey 5-Year Estimates and Cartographic Boundary Files - Shapefile: 2019</li>
<li>Eclipse Shapefiles: NASA’s Scientific Visualization Studio Downloaded from <a href="https://svs.gsfc.nasa.gov/4518" class="uri">https://svs.gsfc.nasa.gov/4518</a></li>
<li>NASA Shuttle Radar Topography Mission (SRTM) Elevation Dataset. Downloaded from <a href="https://dwtkns.com/srtm30m/%5D">30m SRTM Tile Downloader</a>.</li>
<li>Temperature Anomalies: GISTEMP Team, 2022: GISS Surface Temperature Analysis (GISTEMP), version 4. NASA Goddard Institute for Space Studies. Dataset accessed 2022-01-26 at <a href="https://data.giss.nasa.gov/gistemp/" class="uri">https://data.giss.nasa.gov/gistemp/</a>.</li>
</ul>
</div>
<div id="license" class="section level1">
<h1>License</h1>
<p>This course material is licensed under a <a href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>. You are free to use the material for any non-commercial purpose. Kindly give appropriate credit to the original author.</p>
<p>If you would like to utilize these materials as part of a commercial offering, you can purchase a <em>Trainer License</em> for a small fee.</p>
<p>Please <a href="https://spatialthoughts.com/contact/">contact us</a> for pricing and terms. <!--
This material is part of the *Trainer's Package* and the buyer gets a non-exclusive, non-transferable, perpetual license to the material. You can fully customise and brand the materials to your requirements.
--></p>
<p>© 2022 Ujaval Gandhi <a href="https://spatialthoughts.com">www.spatialthoughts.com</a></p>
<hr />
<p><strong>This course is offered as an instructor-led online class. Visit <a href="https://spatialthoughts.com/events/">Spatial Thoughts</a> to know details of upcoming sessions.</strong></p>
</div>

<div id="disqus_thread" class="standardPadding"></div>

<!-- disqus -->
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = 'https://courses.spatialthoughts.com' + location.pathname;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://spatialthoughts.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
